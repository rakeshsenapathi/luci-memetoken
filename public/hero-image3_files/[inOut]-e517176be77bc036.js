(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4364,4566],{39694:function(e,t,n){var i="__lodash_hash_undefined__",s="[object Function]",r="[object GeneratorFunction]",o=/^\[object .+?Constructor\]$/,l="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,a="object"==typeof self&&self&&self.Object===Object&&self,c=l||a||Function("return this")();var u=Array.prototype,d=Function.prototype,x=Object.prototype,p=c["__core-js_shared__"],f=function(){var e=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),m=d.toString,h=x.hasOwnProperty,v=x.toString,g=RegExp("^"+m.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),b=u.splice,w=_(c,"Map"),j=_(Object,"create");function y(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function N(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function k(e,t){for(var n,i,s=e.length;s--;)if((n=e[s][0])===(i=t)||n!==n&&i!==i)return s;return-1}function S(e){if(!T(e)||(t=e,f&&f in t))return!1;var t,n=function(e){var t=T(e)?v.call(e):"";return t==s||t==r}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?g:o;return n.test(function(e){if(null!=e){try{return m.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}function O(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function _(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return S(n)?n:void 0}function C(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,s=t?t.apply(this,i):i[0],r=n.cache;if(r.has(s))return r.get(s);var o=e.apply(this,i);return n.cache=r.set(s,o),o};return n.cache=new(C.Cache||P),n}function T(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}y.prototype.clear=function(){this.__data__=j?j(null):{}},y.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},y.prototype.get=function(e){var t=this.__data__;if(j){var n=t[e];return n===i?void 0:n}return h.call(t,e)?t[e]:void 0},y.prototype.has=function(e){var t=this.__data__;return j?void 0!==t[e]:h.call(t,e)},y.prototype.set=function(e,t){return this.__data__[e]=j&&void 0===t?i:t,this},N.prototype.clear=function(){this.__data__=[]},N.prototype.delete=function(e){var t=this.__data__,n=k(t,e);return!(n<0)&&(n==t.length-1?t.pop():b.call(t,n,1),!0)},N.prototype.get=function(e){var t=this.__data__,n=k(t,e);return n<0?void 0:t[n][1]},N.prototype.has=function(e){return k(this.__data__,e)>-1},N.prototype.set=function(e,t){var n=this.__data__,i=k(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},P.prototype.clear=function(){this.__data__={hash:new y,map:new(w||N),string:new y}},P.prototype.delete=function(e){return O(this,e).delete(e)},P.prototype.get=function(e){return O(this,e).get(e)},P.prototype.has=function(e){return O(this,e).has(e)},P.prototype.set=function(e,t){return O(this,e).set(e,t),this},C.Cache=P,e.exports=C},54566:function(e,t,n){"use strict";n.r(t);var i=n(93981),s=n(13838),r=n(72215),o=n(25546),l=n(29541);t.default=function(e){var t,n=e.tokenInfo,a=e.amount,c=e.maxDecimals,u=e.prefix,d=(0,r.y6)(),x=d.tokenPriceMap,p=d.getUSDValue,f=n.address;(0,i.useEffect)((function(){f&&p([f])}),[f,p]);var m=f&&(null===(t=x[f])||void 0===t?void 0:t.usd)||0,h=new s.Z(a||0).mul(m);return!h||h.lte(0)?(0,l.jsx)(l.Fragment,{children:""}):c&&new s.Z(h).lte(.1)?(0,l.jsxs)(l.Fragment,{children:[u,"$",parseFloat(o.uf.format(h,c))]}):(0,l.jsxs)(l.Fragment,{children:[u,"$",o.uf.format(h,2)]})}},80751:function(e,t,n){"use strict";var i=n(25224),s=n(93981),r=n(29541);t.Z=function(e){var t=e.open,n=e.onClose,o=e.children,l=(0,i.Gc)(),a=((0,s.useMemo)((function(){return"xs"===l||"sm"===l||"md"===l}),[l]),(0,s.useRef)(null));(0,i.O3)(a,(function(){var e;return null===(e=a.current)||void 0===e?void 0:e.close()}));var c=(0,s.useCallback)((function(){var e;null===(e=a.current)||void 0===e||e.close(),n()}),[n,a]);return(0,s.useEffect)((function(){if(a.current&&(t?a.current.open||a.current.show():a.current.close()),t){var e=a.current;return null===e||void 0===e||e.addEventListener("close",c),function(){null===e||void 0===e||e.removeEventListener("close",c)}}}),[c,t]),(0,r.jsx)("dialog",{ref:a,className:"fixed z-40 top-0 rounded-lg bg-black/30 backdrop-blur-sm animate-fade-in flex items-center justify-center",children:o})}},71130:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(93981),s=n(50269),r=n(24201),o=n(29541),l=function(e){var t=e.children,n=e.className,s=void 0===n?"":n,l=e.height,a=e.maxHeight,c=e.expanded,u=(0,i.useState)(l),d=u[0],x=u[1];(0,i.useEffect)((function(){x(c?a:l)}),[l,a,c]);var p=c?"animate-fade-in":"animate-fade-out";return(0,o.jsx)("div",{className:(0,r.cn)("transition-all duration-200 overflow-hidden",p,s),style:{height:d,maxHeight:a},children:t})},a=function(e){var t=e.message,n=e.iconSize,i=void 0===n?20:n,a=e.className;return(0,o.jsx)(l,{height:0,maxHeight:"auto",expanded:Boolean(t),children:(0,o.jsxs)("div",{className:(0,r.cn)("md:px-6 mt-1 flex items-center text-xs fill-current text-black-50 dark:text-white font-semibold",a),children:[(0,o.jsx)(s.Z,{width:i,style:{minWidth:i},height:i}),(0,o.jsx)("span",{className:"ml-2",children:t})]})})}},32529:function(e,t,n){"use strict";n.d(t,{Y:function(){return l}});var i=n(70107),s=n(27177),r=n(93981);function o(e,t){return Array(t-e+1).fill(void 0).map((function(t,n){return e+n}))}function l(e){var t=e.pageIndex,n=void 0===t?0:t,l=e.pageCount,a=void 0===l?0:l,c=e.setPageIndex,u=(0,s.XA)(),d=r.useMemo((function(){var e=n+1;return u?a<=5?o(1,a):e<=2?[].concat((0,i.Z)(o(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,i.Z)(o(a-2,a))):[1,"...",e,"...",a]:a<=8?o(1,a):e<=2?[].concat((0,i.Z)(o(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,i.Z)(o(a-2,a))):[1,"..."].concat((0,i.Z)(o(e,e+2)),["...",a])}),[n,u,a]),x=(0,r.useMemo)((function(){return n>0}),[n]),p=(0,r.useMemo)((function(){return n<a-1}),[n,a]),f=(0,r.useCallback)((function(e){return c(e)}),[c]);return{pager:d,canPreviousPage:x,canNextPage:p,gotoPage:f}}},30825:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var i=n(7761),s=(n(93981),n(63956)),r=n(54423),o=n(29541),l=["className"];function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=function(e){e.className;var t=(0,r.Z)(e,l);return(0,o.jsx)("svg",c(c({width:"53",height:"52",viewBox:"0 0 53 52",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:(0,o.jsx)("path",{d:"M17.3336 23.8334H43.7062V28.1667H17.3336L28.9555 39.7887L25.8919 42.8524L9.03955 26L25.8919 9.14771L28.9555 12.2114L17.3336 23.8334Z",fill:"currentColor"})}))},d=n(11017),x=n(24201),p=function(e){var t=e.canPreviousPage,n=e.gotoPage,s=e.pageIndex,r=e.pager,l=e.canNextPage;return(0,o.jsxs)("div",{className:"flex flex-row justify-between px-2 py-5 lg:px-6 mb-20",children:[(0,o.jsxs)("button",{type:"button",disabled:!t,onClick:function(){return n(s-1)},className:"flex flex-row items-center text-[#E8F9FF] cursor-pointer disabled:cursor-not-allowed text-opacity-50 hover:text-opacity-100",children:[(0,o.jsx)(u,{width:12,height:12}),(0,o.jsx)("span",{className:"ml-2 text-xs",children:i.ag._("Previous")})]}),(0,o.jsx)("div",{className:"flex-row space-x-2 flex",children:r.map((function(e,t){var i=e===s+1,r="".concat(e,"-").concat(t);return"string"===typeof e?(0,o.jsx)("div",{className:"flex flex-row items-center justify-center text-xs",children:e},r):(0,o.jsx)("div",{onClick:function(){return n(e-1)},className:(0,x.cn)("h-10 w-10 text-xs rounded-lg flex flex-row items-center justify-center text-[#E8F9FF]/50 hover:text-v2-primary cursor-pointer",{"!text-v2-primary border bg-v2-primary/10 border-v2-primary/50 font-semibold":i}),children:e},r)}))}),(0,o.jsxs)("button",{type:"button",disabled:!l,onClick:function(){return n(s+1)},className:"flex flex-row items-center text-[#E8F9FF] cursor-pointer disabled:cursor-not-allowed text-opacity-50 hover:text-opacity-100",children:[(0,o.jsx)("span",{className:"mr-2 text-xs",children:i.ag._("Next")}),(0,o.jsx)(d.Z,{width:12,height:12})]})]})}},19424:function(e,t,n){"use strict";n(93981);var i=n(12869),s=n(24201),r=n(29541);t.Z=function(e){var t=e.children;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{product:"perps",className:"sm:max-w-[90vw] md:w-[460px] w-full z-10",activeClassName:"my-2 lg:my-4"}),(0,r.jsx)("div",{className:(0,s.cn)("flex flex-1 min-h-full w-full max-w-[100vw] bg-v2-perps"),children:t})]})}},50944:function(e,t,n){"use strict";n.d(t,{Y8:function(){return g},hb:function(){return N},zu:function(){return b}});var i=n(63956),s=n(73360),r=n(7761),o=n(93981),l=n(40558),a=n(13838),c=n(64508),u=n.n(c),d=n(56100),x=n(50269),p=n(24201),f=n(25546),m=n(29541);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=(0,o.memo)((function(e){var t=e.collateralInput,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,m.jsx)("span",{className:"text-xs text-white/50 ",children:r.ag._("Collateral")}),(0,m.jsx)(l.Z,{variant:"dark",content:(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)("p",{className:"text-xs",children:r.ag._("When opening a position, a snapshot will be taken and collateral will be calculated in USD.")}),(0,m.jsx)("p",{className:"text-xs",children:r.ag._("Depending on the token selection, token may be swapped via Jupiter's best possible rate.")})]}),children:(0,m.jsx)("div",{translate:"no",className:"text-xs text-white/75 mt-0.5",children:t&&!n?(0,m.jsxs)("span",{children:[f.uf.format(t,2)," USD"]}):!t||null!==t&&void 0!==t&&t.eq(0)?(0,m.jsx)("span",{className:"text-white/75 text-xs h-[14px]",children:"-"}):(0,m.jsx)(d.O,{className:"h-[14px] !w-20"})})})]})})),b=(0,o.memo)((function(e){var t=e.sizeUsd,n=e.collateralInput,i=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,m.jsx)("span",{className:"text-xs text-white/50 leading-none",children:r.ag._("Size in USD")}),(0,m.jsx)("div",{translate:"no",className:"text-xs text-white/75 mt-0.5",children:t&&!i?(0,m.jsx)("span",{translate:"no",className:"text-xs h-[14px] text-white/75",children:(0,m.jsxs)("span",{children:[f.uf.format(t,2)," USD"]})}):!n||null!==n&&void 0!==n&&n.eq(0)?(0,m.jsx)("span",{className:"text-white/75 text-xs h-[14px]",children:"-"}):(0,m.jsx)(d.O,{className:"h-[14px] !w-20"})})]})})),w=(0,o.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,m.jsx)("span",{className:"text-xs text-white/50",children:r.ag._("Entry price")}),(0,m.jsx)("span",{className:"text-xs text-white/75",children:t.entryPriceTextWithShifting&&!n?t.entryPriceTextWithShifting:(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),j=(0,o.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,m.jsxs)("span",{className:"flex items-center leading-none",children:[(0,m.jsx)("span",{className:(0,p.cn)("inline-block lg:hidden text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:r.ag._("Liquidation")}),(0,m.jsx)("span",{className:(0,p.cn)("hidden lg:inline-block text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:r.ag._("Liquidation price")}),t.isNewLiquidationWorse&&!n?(0,m.jsx)(l.Z,{buttonContentClassName:"ml-1 inline-block",content:r.ag._("Your new order and outstanding borrow fees is resulting in a worse liquidation price, try increasing your collateral, or reduce your leverage."),children:(0,m.jsx)(x.Z,{width:12,height:12,className:"text-warning fill-current"})}):null]}),(0,m.jsx)("span",{className:(0,p.cn)("text-xs mt-1",t.isNewLiquidationWorse?"text-warning":"text-white/75"),children:t.liquidationPriceTextWithShifting&&!n?t.liquidationPriceTextWithShifting:(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),y=(0,o.memo)((function(e){var t=e.pool,n=e.orderInfo,i=e.orderInfoLoading,s=t?new a.Z(t.fees.increasePositionBps.toString()).div(100):null;return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[t?(0,m.jsx)("span",{className:"text-xs text-white/50 whitespace-nowrap",children:r.ag._("Open fee ({openFeePct}%)",{openFeePct:s})}):(0,m.jsx)(d.O,{className:"!h-4 !w-20"}),(0,m.jsx)("span",{className:"text-xs text-white/75",children:n.openFeeUsdText&&!i?"".concat(n.openFeeUsdText):(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),N=(0,o.memo)((function(e){var t=e.impactPct,n=e.impactFeeUsdText,i=e.orderInfoLoading,s=e.breakline;return(0,m.jsxs)("div",{className:(0,p.cn)("!w-full flex lg:flex-row justify-between lg:items-center text-xs text-white/50",[null!==t&&void 0!==t&&t.gte(.15)?"text-red-400":"",null!==t&&void 0!==t&&t.gte(.1)?"text-warning":"",s?"flex-col":""]),children:[(0,m.jsxs)("span",{className:"inline-block lg:flex lg:flex-row lg:items-center leading-none fill-current",children:[r.ag._("Price impact")," ",t?"(".concat(null===t||void 0===t?void 0:t.toFixed(2),"%)"):"",(0,m.jsx)("div",{className:"ml-1 inline-block fill-current",children:(0,m.jsx)(l.Z,{content:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{children:"Price impact is calculated based on your order size, you can reduce your price impact by splitting your orders."}),(0,m.jsx)(u(),{href:"https://www.jupresear.ch/t/jupiter-perpetuals-price-impact-fee-mechanism/17140",target:"_blank",className:"underline",children:(0,m.jsx)("p",{className:"mt-2",children:r.ag._("Learn More")})})]}),children:(0,m.jsx)(x.Z,{width:12,height:12,className:"inline-block mb-0.5 md:mb-0"})})})]}),(0,m.jsx)("span",{className:(0,p.cn)("text-xs text-white/75",[null!==t&&void 0!==t&&t.gte(.15)?"text-red-400":"",null!==t&&void 0!==t&&t.gte(.1)?"text-warning":""]),children:n&&!i?n:(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),P=(0,o.memo)((function(e){var t=e.positionInfo,n=e.orderInfo,i=e.orderInfoLoading;return(0,m.jsxs)("div",{className:(0,p.cn)("flex flex-col lg:flex-row justify-between lg:items-center text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/50"),children:[(0,m.jsxs)("span",{className:"inline-block lg:flex lg:flex-row lg:items-center leading-none",children:[r.ag._("Borrow fees due"),(0,m.jsx)("div",{className:"ml-1 inline-block fill-current",children:(0,m.jsx)(l.Z,{content:r.ag._("Borrow fees due are settled when you make changes to your existing position."),children:(0,m.jsx)(x.Z,{width:12,height:12,className:"inline-block mb-0.5 md:mb-0"})})})]}),(0,m.jsx)("span",{className:(0,p.cn)("text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/75"),children:n.outstandingFundingFeeUsdText&&!i?"".concat(n.outstandingFundingFeeUsdText):(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),k=(0,o.memo)((function(e){var t=e.positionInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center gap-x-4",children:[(0,m.jsxs)("div",{className:"flex items-center text-xs text-white/50 !h-4 fill-current",children:[(0,m.jsx)("span",{className:"text-xs text-white/50 mr-1",children:r.ag._("Borrow rate")}),(0,m.jsx)(l.Z,{variant:"dark",placement:"top",content:(0,m.jsx)("p",{className:"flex items-center text-xs",children:(0,m.jsx)(s.cC,{id:"The borrow rate is calculated as (assets borrowed) / (total assets in pool) * {0}% per hour * position size.",values:{0:t.hourlyFundingDbps.div(1e3).toString()}})}),children:(0,m.jsx)(x.Z,{width:12,height:12})})]}),(0,m.jsx)("span",{className:"flex items-center text-xs text-white/75",children:t.borrowFeeText&&!n?t.borrowFeeText:(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),S=(0,o.memo)((function(e){var t=e.positionInfo,n=(e.orderInfo,e.orderInfoLoading);return(0,m.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center gap-x-4",children:[(0,m.jsx)("span",{className:"block lg:hidden text-xs text-white/50",children:r.ag._("Available liq.")}),(0,m.jsx)("span",{className:"hidden lg:block text-xs text-white/50",children:r.ag._("Available liquidity")}),(0,m.jsx)("span",{className:"text-xs text-white/75",children:t.availableLiquidityText&&!n?t.availableLiquidityText:(0,m.jsx)(d.O,{className:"!w-16 !h-4"})})]})})),O=(0,o.memo)((function(e){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"hidden lg:block rounded-lg p-3 w-full",children:(0,m.jsx)("div",{className:"border border-white/5 rounded-lg p-3 w-full",children:(0,m.jsxs)("div",{className:"space-y-1",children:[(0,m.jsx)(w,v({},e)),(0,m.jsx)(j,v({},e)),(0,m.jsx)(y,v({},e)),(0,m.jsx)(N,{impactPct:e.orderInfo.impactPct,impactFeeUsdText:e.orderInfo.impactFeeUsdText,orderInfoLoading:e.orderInfoLoading}),e.orderInfo.outstandingFundingFeeUsdText?(0,m.jsx)(P,v({},e)):null,(0,m.jsx)(k,v({},e)),(0,m.jsx)(S,v({},e))]})})}),(0,m.jsx)("div",{className:"block lg:hidden px-1.5 pt-3 min-h-full bg-[#1E2A36] w-full !min-w-[110px] max-w-[30vw]",children:(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsx)(g,v({},e)),(0,m.jsx)(b,v({},e)),(0,m.jsx)(w,v({},e)),(0,m.jsx)(j,v({},e)),(0,m.jsx)(y,v({},e)),(0,m.jsx)(N,{impactPct:e.orderInfo.impactPct,impactFeeUsdText:e.orderInfo.impactFeeUsdText,orderInfoLoading:e.orderInfoLoading,breakline:!0}),e.orderInfo.outstandingFundingFeeUsdText?(0,m.jsx)(P,v({},e)):null,(0,m.jsx)(k,v({},e)),(0,m.jsx)(S,v({},e))]})})]})}));t.ZP=O},13020:function(e,t,n){"use strict";n.d(t,{M:function(){return m}});var i=n(63956),s=n(7761),r=n(93981),o=n(13838),l=n(9319),a=n.n(l),c=n(25224),u=n(72215),d=n(80989),x=n(13486);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=function(e){var t=(0,x.tc)(),n=t.perpsTokens,i=t.custodies,s=(0,u.Bn)().getTokenInfo;return(0,r.useMemo)((function(){return n.stableTokens?n.stableTokens.map((function(t){var n=i.find((function(e){return e.account.mint.toString()===t.address}));if(!n)return null;if(e&&new o.Z(n.account.assets.owned.sub(n.account.assets.locked).toString()).div(1e6).lt(e))return null;var s=n.account.assets.owned.gtn(0)&&n.account.assets.locked.gtn(0)?new o.Z(n.account.assets.locked.toString()).div(n.account.assets.owned.toString()).mul(1e4):new o.Z(0);return{mint:n.account.mint.toString(),utilizationBps:s}})).filter(Boolean).sort((function(e,t){return e.utilizationBps.toNumber()-t.utilizationBps.toNumber()})).map((function(e){return f(f({},e),{},{tokenInfo:s(e.mint)})})):[]}),[n.stableTokens,i,e,s])};t.Z=function(e){var t=e.fromPairTokenInfo,n=e.toPairTokenInfo,i=e.fromPairValue,l=(0,x.tc)().slippage,u=(0,r.useMemo)((function(){return!(!t||!n)&&t.address!==n.address}),[t,n]),p=(0,r.useMemo)((function(){return(0,c.Hd)(i)&&t?a().BigInt(new o.Z(i).mul(Math.pow(10,t.decimals)).round().toFixed()||0):a().BigInt(0)}),[i,t]),f=(0,d.Z)({disabled:!u,amount:p,fromTokenInfo:t,toTokenInfo:n,slippage:l}),m=f.isLoading,h=f.outAmount,v=f.otherAmountThreshold,g=f.quoteResponseMeta,b=f.useJupError,w=f.refresh,j=f.lastRefreshTimestamp,y=(0,r.useMemo)((function(){if(u&&b)return s.ag._("We're having trouble finding route for this trade. Please try again with different amount or other token.")}),[b,u]);return{isLoading:!!u&&m,isTokenSwapRequired:u,outAmount:h,otherAmountThreshold:v,quoteResponseMeta:g,hasJupiterError:y,refresh:w,lastRefreshTimestamp:j}}},6340:function(e,t,n){"use strict";var i,s=n(70107),r=n(63956),o=n(97620),l=n(27195),a=n(8857),c=n.n(a),u=n(7761),d=n(97175),x=n(18849),p=n(57281),f=n(32532),m=n(72215),h=n(27177),v=n(40993),g=n(25224),b=n(7744),w=n(91551),j=n.n(w),y=n(3011),N=n(93981),P=n(2485),k=n(59394),S=n(85948),O=n(90342),_=n(24628),C=n(59890),T=n(57917),Z=n(11421),D=n(13486),E=n(55540),M=n(34166),L=n(29541),A=n(795).Buffer;function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.MAX_ATTEMPTS="MAX_ATTEMPTS",e.FAILED_TO_CLOSE_REQUEST="FAILED_TO_CLOSE_REQUEST",e.COLLATERAL_REFUNDED="COLLATERAL_REFUNDED"}(i||(i={}));function F(e,t,n){return q.apply(this,arguments)}function q(){return q=(0,l.Z)(c().mark((function e(t,n,i){var s,r,o,l,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.length>3&&void 0!==a[3]?a[3]:5,e.prev=1,e.next=4,t.getTransactions(n,{commitment:"confirmed",maxSupportedTransactionVersion:0});case 4:if(o=e.sent,l=null===(r=o[0])||void 0===r?void 0:r.slot,o&&l&&!(l<i)){e.next=15;break}return e.next=9,(0,g.gw)(1e3);case 9:if(console.log("retrying",l,i),!(s>0)){e.next=14;break}return e.abrupt("return",F(t,n,i,s-1));case 14:case 23:return e.abrupt("return",null);case 15:return e.abrupt("return",o);case 18:if(e.prev=18,e.t0=e.catch(1),!e.t0||!e.t0.message.includes(M.VU)){e.next=23;break}return console.log("retrying due to error"),e.abrupt("return",F(t,n,i,s-1));case 24:case"end":return e.stop()}}),e,null,[[1,18]])}))),q.apply(this,arguments)}t.Z=function(){var e=(0,D.tc)(),t=e.refreshPositionInfo,n=e.maxRequestExecutionSec,i=(0,T.SR)(),r=i.addNotificationTx,a=i.updateNotificationTxStatus,g=(0,h.lm)(),w=g.toast,M=g.close,I=(0,m.Os)(),q=I.wallet,U=I.signTransaction,K=I.signAllTransactions,V=(0,m.Bn)().connection,B=(0,m.C9)(),z=(0,O.gs)(),$=z.modifyComputeUnitPriceAndLimit,H=z.priorityLevel,W=(0,y.KO)(v.yz),G=(0,o.Z)(W,1)[0],Q=(0,y.KO)(C.J),Y=(0,o.Z)(Q,2),X=(Y[0].lastSubmissionSlot,Y[1]),J=(0,N.useMemo)((function(){return new b.Connection(V._rpcEndpoint,"confirmed")}),[V]),ee=(0,N.useMemo)((function(){var e=new d.Y7(J,{},d.Y7.defaultOptions());return[e,new d.$r(E.x,D.KX,e)]}),[J]),te=(ee[0],ee[1]),ne=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t,i,s,r,o,d,f){var m,h,v,g,y,N,S,O,C,T,Z,E;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(V,[i],f);case 2:if(m=e.sent,(h=null===m||void 0===m?void 0:m[0])&&h.blockTime){e.next=6;break}throw"Transaction not found";case 6:return v=function(){setTimeout((function(){M(t)}),1e4),o&&o(!0)},g=h.blockTime,y=1e3*(g+(n||45)),N=void 0,S="",O="",C=function(){var e=(0,l.Z)(c().mark((function e(t){var n,i,s,r,o,l,a,u,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(V,t,h.slot);case 2:if(i=e.sent){e.next=5;break}throw new Error("Failed to retrieve transaction status for ".concat(t));case 5:if(null!==(n=i[0])&&void 0!==n&&n.slot&&X({lastSubmissionSlot:null===(s=i[0])||void 0===s?void 0:s.slot}),r=i.flatMap((function(e){var t,n,i=null===e||void 0===e?void 0:e.transaction.message.staticAccountKeys.findIndex((function(e){return e.equals(D.KX)}));return null===e||void 0===e||null===(t=e.meta)||void 0===t||null===(n=t.innerInstructions)||void 0===n?void 0:n.flatMap((function(t){return t.instructions.map((function(t){if(t.programIdIndex===i){var n=j().decode(t.data),s=x.base64.encode(n.subarray(8));return{event:te.coder.events.decode(s),tx:e}}}))}))})),o=r.find((function(e){var t,n;return"IncreasePositionEvent"===(null===e||void 0===e||null===(t=e.event)||void 0===t?void 0:t.name)||"DecreasePositionEvent"===(null===e||void 0===e||null===(n=e.event)||void 0===n?void 0:n.name)})),l=r.find((function(e){var t;return"ClosePositionRequestEvent"===(null===e||void 0===e||null===(t=e.event)||void 0===t?void 0:t.name)})),!o){e.next=13;break}return N=!0,S=o.tx.transaction.signatures[0],e.abrupt("return");case 13:if("undefined"!==typeof o||!l){e.next=25;break}if(N=!1,S=l.tx.transaction.signatures[0],a=l.tx.transaction.message.staticAccountKeys,u=a.findIndex((function(e){return e.equals(new b.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"))}))){e.next=20;break}return e.abrupt("return");case 20:if(d=l.tx.transaction.message.compiledInstructions.find((function(e){return e.programIdIndex===u}))){e.next=23;break}return e.abrupt("return");case 23:return O=A.from(d.data).toString(),e.abrupt("return");case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=(0,l.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof N){e.next=19;break}return e.next=3,(0,p.Dc)(5e3);case 3:if(!(Date.now()>y)){e.next=7;break}return N=!1,O="Failed to retrieve transaction status",e.abrupt("break",19);case 7:return e.next=9,J.getSignaturesForAddress(new b.PublicKey(s),{until:i});case 9:if(t=e.sent,0!==(n=t.filter((function(e){return null===e.err})).map((function(e){return e.signature}))).length){e.next=13;break}return e.abrupt("continue",0);case 13:if("undefined"===typeof N){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,C(n);case 17:e.next=0;break;case 19:console.log("pollForEvent done");case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,l.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){Z=J.onLogs(new b.PublicKey(s),function(){var t=(0,l.Z)(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.err){t.next=6;break}if("undefined"===typeof N){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,C([n.signature]);case 5:e();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 2:console.log("listenToEvent done");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=17,Promise.any([T(),E()]).finally((function(){Z&&J.removeOnLogsListener(Z)}));case 17:return N?(a(t,{status:"success",stepText:"",txid:S}),w({duration:5e3,id:t,render:function(e){return(0,L.jsx)(P.x,R({customTitle:"open"===r?u.ag._("Position opened"):"partial-close"===r?u.ag._("Position reduced"):"close"===r?u.ag._("Position closed"):"increase-collateral"===r?u.ag._("Collateral increased"):void 0},e))}}),v()):(w({duration:1e4,id:t,render:function(e){var t=S?"open"===r?u.ag._("Failed to open position"):"partial-close"===r?u.ag._("Failed to reduce position"):"close"===r?u.ag._("Failed to close position"):"increase-collateral"===r?u.ag._("Failed increase collateral"):void 0:u.ag._("Transaction timed-out");return(0,L.jsx)(P.x,R({customTitle:t},e))}}),S?a(t,{txid:void 0,status:"fail",stepText:O||"Failed to execute request"},{shouldShowFeedbackLink:!1,hasAdditionalPendingSteps:!1,additionalSteps:["open"===r||"increase-collateral"===r?(0,L.jsxs)("p",{className:"mt-3 ml-7 flex items-center space-x-1",children:[(0,L.jsx)("span",{children:u.ag._("Collateral refunded:")}),(0,L.jsx)(k.Z,{txid:S}),(0,L.jsx)(_.Z,{})]},"additionalSteps-1"):null].filter(Boolean)}):a(t,{txid:S,status:"unknown",stepText:u.ag._("Note: Your transaction might be successfully executed.")},{hasAdditionalPendingSteps:!1,additionalSteps:[(0,L.jsxs)("p",{className:"ml-7",children:[(0,L.jsx)("p",{className:"mt-2",children:u.ag._("You may try:")}),(0,L.jsxs)("ul",{className:"mt-2 text-v2-lily/50 list-disc list-outside w-full px-3 space-y-1.5",children:[(0,L.jsx)("li",{className:"list-outside",children:u.ag._("Refresh the page")}),(0,L.jsx)("li",{className:"list-outside",children:u.ag._("Change your RPC")}),(0,L.jsx)("li",{className:"list-outside",children:u.ag._("Check Expired Orders tab")}),(0,L.jsx)("li",{className:"list-outside",children:(0,L.jsx)("div",{className:"flex items-center gap-x-2",children:(0,L.jsx)("span",{children:u.ag._("Or, open a Discord ticket")})})})]})]},"additionalSteps-1")].filter(Boolean)}),d(!0),v()),e.abrupt("return",{success:N,txId:S,error:O});case 19:case"end":return e.stop()}}),e)})));return function(t,n,i,s,r,o,l){return e.apply(this,arguments)}}(),[M,J,V,n,te.coder.events,X,w,a]),ie=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t){var n,i,r,o,a,u,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,q&&K){e.next=3;break}throw new Error("Wallet not connected, or signAllTransactions not found");case 3:return e.next=5,V.getLatestBlockhashAndContext("confirmed");case 5:return n=e.sent,i=n.context,r=n.value,o=r.blockhash,a=r.lastValidBlockHeight,e.next=12,Promise.all(t.map(function(){var e=(0,l.Z)(c().mark((function e(t){var n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(n=new b.Transaction({blockhash:o,lastValidBlockHeight:a,feePayer:q.adapter.publicKey})).add.apply(n,(0,s.Z)(t)),e.next=3,$(i,{requestComputeBudgetLimit:3e5,referenceFee:"MEDIUM"===H?G.perps.m:"HIGH"===H?G.perps.h:"VERY_HIGH"===H?G.perps.vh:void 0,minimumFee:v.uo});case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:return u=e.sent,e.next=15,K(u);case 15:return d=e.sent,e.abrupt("return",d.map((function(e){return{txid:(0,f.o$)(e),signedTransaction:e,blockhash:o,lastValidBlockHeight:a,context:i}})));case 19:throw e.prev=19,e.t0=e.catch(0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),[V,K,q,$,H,G]),se=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t,n,i,s){var l,a,d,x,p,m,h,v,g,b,j,y,N=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=N.length>4&&void 0!==N[4]?N[4]:{},q&&U){e.next=3;break}return e.abrupt("return");case 3:return x=String(Math.floor(1e4*Math.random())),e.prev=4,(0,Z.Kz)(S.Ll.INCREASE_POSITION_REQUEST,R({},l)),e.next=8,ie([t]);case 8:return p=e.sent,m=(0,o.Z)(p,1),h=m[0],v=h.signedTransaction,g=h.blockhash,b=h.lastValidBlockHeight,h.context,d=Date.now(),r(x,{status:"loading",txid:"",stepText:"Opening Position"}),w({duration:12e4,id:x,render:function(e){return(0,L.jsx)(P.x,R({customTitle:u.ag._("Requesting open position")},e))},closeOnClick:!1}),e.next=20,(0,f.ie)({signedTransaction:v,blockhash:g,connection:V,lastValidBlockHeight:b,idl:E.x,idlProgramId:D.KX,skipPreflight:!0});case 20:if(!("error"in(j=e.sent))){e.next=24;break}throw(0,Z.Kz)(S.Ll.INCREASE_POSITION_REQUEST_FAILED,R({ping:(Date.now()-d)/1e3},l)),j.error;case 24:return r(x,{status:"loading",txid:"",stepText:u.ag._("Position request sent")}),a=j.txid,e.next=28,ne(x,a,n.toString(),"open",i,(function(){(0,Z.Kz)(S.Ll.INCREASE_POSITION_FAILED,R({txid:a,ping:d?(Date.now()-d)/1e3:void 0},l)),s(!0)}),j.transactionResponse.slot);case 28:(0,Z.Kz)(S.Ll.INCREASE_POSITION_SUCCESS,R({ping:(Date.now()-d)/1e3,txid:a},l)),e.next=39;break;case 31:e.prev=31,e.t0=e.catch(4),y=e.t0.message||u.ag._("There was an error trying to open your position."),console.log("handleSendTransaction error",y),s(!0),w({title:"Failed to perform transaction",description:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:y}),(0,L.jsx)("div",{children:a?(0,L.jsx)(k.Z,{txid:a}):null})]}),variant:"ERROR"}),M(x),(0,Z.Kz)(d?S.Ll.INCREASE_POSITION_FAILED:S.Ll.INCREASE_POSITION_REQUEST_FAILED,R({ping:d?(Date.now()-d)/1e3:void 0,txid:a},l));case 39:case"end":return e.stop()}}),e,null,[[4,31]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[q,U,ie,r,w,V,ne,M]),re=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t,n,i,s,o,l,a,d,x){var p,m,h,v,g=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=g.length>9&&void 0!==g[9]?g[9]:{},m=Date.now(),e.prev=2,(0,Z.Kz)(S.Ll.DECREASE_POSITION_REQUEST,R({},p)),r(t,{status:"loading",txid:"",stepText:u.ag._("Closing Position...")}),w({duration:12e4,id:t,render:function(e){return(0,L.jsx)(P.x,R({customTitle:u.ag._("Requesting close position")},e))},closeOnClick:!1}),e.next=8,(0,f.ie)({signedTransaction:n,blockhash:i,connection:V,lastValidBlockHeight:s,idl:E.x,idlProgramId:D.KX,skipPreflight:!0});case 8:if(!("error"in(h=e.sent))){e.next=12;break}throw(0,Z.Kz)(S.Ll.DECREASE_POSITION_REQUEST_FAILED,R({ping:(Date.now()-m)/1e3},p)),h.error;case 12:return r(t,{status:"loading",txid:"",stepText:u.ag._("Close position request sent")}),x=h.txid,e.next=16,ne(t,x,l.toString(),"close",a,(function(){(0,Z.Kz)(S.Ll.DECREASE_POSITION_FAILED,R({txid:x,ping:(Date.now()-m)/1e3},p)),d(!0)}),h.transactionResponse.slot);case 16:(0,Z.Kz)(S.Ll.DECREASE_POSITION_SUCCESS,R({ping:(Date.now()-m)/1e3,txid:x},p)),e.next=27;break;case 19:e.prev=19,e.t0=e.catch(2),v=e.t0.message||u.ag._("There was an error trying to close your position."),console.error(e.t0),d(!0),w({title:"Failed to perform transaction",description:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:v}),(0,L.jsx)("div",{children:x?(0,L.jsx)(k.Z,{txid:x}):null})]}),variant:"ERROR"}),M(t),(0,Z.Kz)(S.Ll.DECREASE_POSITION_FAILED,R({txid:x},p));case 27:case"end":return e.stop()}}),e,null,[[2,19]])})));return function(t,n,i,s,r,o,l,a,c){return e.apply(this,arguments)}}(),[r,M,V,ne,w]),oe=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t,n,i,s){var r,l,a,d,x,p,f,m,h,v,g,b=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=b.length>4&&void 0!==b[4]?b[4]:{},e.prev=1,l=String(Math.floor(1e4*Math.random())),e.next=5,ie([t]);case 5:if(a=e.sent,d=(0,o.Z)(a,1),x=d[0]){e.next=10;break}throw new Error("Failed to craft transaction");case 10:return p=x.txid,f=x.signedTransaction,m=x.blockhash,h=x.lastValidBlockHeight,v=x.context,e.next=13,re(l,f,m,h,v,n,i,s,p,r);case 13:e.next=21;break;case 15:e.prev=15,e.t0=e.catch(1),g=e.t0.message||u.ag._("There was an error trying to close your position."),console.error(e.t0),s(!0),w({title:"Failed to perform transaction",description:(0,L.jsx)("div",{children:(0,L.jsx)("p",{children:g})}),variant:"ERROR"});case 21:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[ie,re,w]),le=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t){var n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.instructions})),e.next=3,ie(n);case 3:if(i=e.sent,t.length===i.length){e.next=6;break}throw new Error("Failed to craft transaction");case 6:return e.next=8,Promise.allSettled(i.map((function(e,n){return new Promise(function(){var i=(0,l.Z)(c().mark((function i(s,r){var o,l,a,u,d,x,p;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=String(Math.floor(1e4*Math.random())),l=e.txid,a=e.signedTransaction,u=e.blockhash,d=e.lastValidBlockHeight,x=e.context,p=t[n].positionRequestKey,i.abrupt("return",re(o,a,u,d,x,p,s,r,l));case 4:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}())})));case 8:return s=e.sent,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[ie,re]),ae=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t,n,i,s){var l,d,x,p,m,h,v,g,b,j,y,N,O=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=O.length>4&&void 0!==O[4]?O[4]:{},q&&U){e.next=3;break}return e.abrupt("return");case 3:return d="",p=String(Math.floor(1e4*Math.random())),e.prev=5,(0,Z.Kz)(S.Ll.DECREASE_POSITION_REQUEST,R({},l)),e.next=9,ie([t]);case 9:return m=e.sent,h=(0,o.Z)(m,1),v=h[0],g=v.signedTransaction,b=v.blockhash,j=v.lastValidBlockHeight,v.context,x=Date.now(),r(p,{status:"loading",txid:"",stepText:"Reducing Position"},{customTitle:u.ag._("Reducing position...")}),w({duration:12e4,id:p,render:function(e){return(0,L.jsx)(P.x,R({customTitle:u.ag._("Requesting reduce position")},e))},closeOnClick:!1}),e.next=21,(0,f.ie)({signedTransaction:g,blockhash:b,connection:V,lastValidBlockHeight:j,idl:E.x,idlProgramId:D.KX,skipPreflight:!0});case 21:if(y=e.sent,a(p,{status:"loading",stepText:u.ag._("Position request sent")}),!("error"in y)){e.next=26;break}throw(0,Z.Kz)(S.Ll.DECREASE_POSITION_REQUEST_FAILED,R({ping:(Date.now()-x)/1e3},l)),y.error;case 26:return e.next=28,ne(p,y.txid,n.toString(),"partial-close",i,(function(){(0,Z.Kz)(S.Ll.DECREASE_POSITION_FAILED,R({txid:d,ping:x?(Date.now()-x)/1e3:void 0},l)),s(!0)}),y.transactionResponse.slot);case 28:(0,Z.Kz)(S.Ll.DECREASE_POSITION_SUCCESS,R({ping:(Date.now()-x)/1e3,txid:d},l)),e.next=39;break;case 31:e.prev=31,e.t0=e.catch(5),N=e.t0.message||u.ag._("There was an error trying to close your position."),console.error(e.t0),s(!0),w({title:"Failed to perform transaction",description:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:N}),(0,L.jsx)("div",{children:d?(0,L.jsx)(k.Z,{txid:d}):null})]}),variant:"ERROR"}),M(p),(0,Z.Kz)(x?S.Ll.DECREASE_POSITION_FAILED:S.Ll.DECREASE_POSITION_REQUEST_FAILED,R({ping:x?(Date.now()-x)/1e3:void 0,txid:d},l));case 39:case"end":return e.stop()}}),e,null,[[5,31]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[q,U,ie,r,w,V,a,ne,M]),ce=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(t,n,i,s){var l,a,d,x,p,m,h,v,g,b,j,y,N=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=N.length>4&&void 0!==N[4]?N[4]:{},q&&U){e.next=3;break}return e.abrupt("return");case 3:return a="",x=String(Math.floor(1e4*Math.random())),e.prev=5,(0,Z.Kz)(S.Ll.INCREASE_POSITION_REQUEST,R({},l)),d=Date.now(),e.next=10,ie([t]);case 10:return p=e.sent,m=(0,o.Z)(p,1),h=m[0],v=h.signedTransaction,g=h.blockhash,b=h.lastValidBlockHeight,h.context,r(x,{status:"loading",txid:"",stepText:"Increasing Collateral"},{customTitle:u.ag._("Increasing collateral...")}),w({duration:12e4,id:x,render:function(e){return(0,L.jsx)(P.x,R({customTitle:u.ag._("Requesting to increase collateral"),className:"w-[95vw] lg:w-[420px]"},e))},closeOnClick:!1}),e.next=21,(0,f.ie)({signedTransaction:v,blockhash:g,connection:V,lastValidBlockHeight:b,idl:E.x,idlProgramId:D.KX,skipPreflight:!0});case 21:if(!("error"in(j=e.sent))){e.next=25;break}throw(0,Z.Kz)(S.Ll.INCREASE_POSITION_REQUEST_FAILED,R({ping:(Date.now()-d)/1e3},l)),j.error;case 25:return e.next=27,ne(x,j.txid,n.toString(),"increase-collateral",i,(function(){(0,Z.Kz)(S.Ll.INCREASE_POSITION_FAILED,R({txid:a,ping:d?(Date.now()-d)/1e3:void 0},l)),s(!0)}),j.transactionResponse.slot);case 27:(0,Z.Kz)(S.Ll.INCREASE_POSITION_SUCCESS,R({ping:(Date.now()-d)/1e3,txid:a},l)),e.next=37;break;case 30:e.prev=30,e.t0=e.catch(5),y=e.t0.message||u.ag._("There was an error trying to increase your collateral."),s(!0),w({title:"Failed to perform transaction",description:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:y}),(0,L.jsx)("div",{children:a?(0,L.jsx)(k.Z,{txid:a}):null})]}),variant:"ERROR"}),M(x),(0,Z.Kz)(d?S.Ll.INCREASE_POSITION_FAILED:S.Ll.INCREASE_POSITION_REQUEST_FAILED,R({ping:d?(Date.now()-d)/1e3:void 0,txid:a},l));case 37:case"end":return e.stop()}}),e,null,[[5,30]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[q,U,ie,r,w,V,ne,M]),ue=(0,N.useCallback)(function(){var e=(0,l.Z)(c().mark((function e(n,i,s,l){var d,x,p,m,h,v,g,b,j,y,N=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=N.length>4&&void 0!==N[4]?N[4]:{},q&&U){e.next=3;break}return e.abrupt("return");case 3:return x="",m=String(Math.floor(1e4*Math.random())),h=[n.doveInstructions].filter((function(e){return e.length>0})),e.prev=6,(0,Z.Kz)(S.Ll.UPDATE_TPSL_REQUEST,R({},d)),e.next=10,ie(h);case 10:return v=e.sent,g=(0,o.Z)(v,1),b=g[0],p=Date.now(),r(m,{status:"loading",txid:"",stepText:"Adjusting TPSL"},{customTitle:l}),w({duration:12e4,id:m,render:function(e){return(0,L.jsx)(P.x,R({customTitle:u.ag._("Adjusting TPSL")},e))},closeOnClick:!1}),e.next=18,(0,f.ie)({signedTransaction:b.signedTransaction,blockhash:b.blockhash,connection:V,lastValidBlockHeight:b.lastValidBlockHeight,idl:E.x,idlProgramId:D.KX,skipPreflight:!0});case 18:if(!("error"in(j=e.sent))){e.next=22;break}throw(0,Z.Kz)(S.Ll.UPDATE_TPSL_REQUEST_FAILED,R({ping:(Date.now()-p)/1e3},d)),j.error;case 22:a(m,{status:"success"}),i(!0),(0,Z.Kz)(S.Ll.UPDATE_TPSL_SUCCESS,R({ping:(Date.now()-p)/1e3,txid:x},d)),e.next=35;break;case 27:e.prev=27,e.t0=e.catch(6),y=e.t0.message||u.ag._("There was an error trying to create your TP or SL."),console.error(e.t0),a(m,{status:"fail"}),s(!0),w({title:"Failed to perform transaction",description:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:y}),(0,L.jsx)("div",{children:x?(0,L.jsx)(k.Z,{txid:x}):null})]}),variant:"ERROR"}),(0,Z.Kz)(p?S.Ll.UPDATE_TPSL_FAILED:S.Ll.UPDATE_TPSL_REQUEST_FAILED,R({ping:p?(Date.now()-p)/1e3:void 0,txid:x},d));case 35:return e.prev=35,t(),B(),setTimeout((function(){M(m)}),1e4),e.finish(35);case 40:case"end":return e.stop()}}),e,null,[[6,27,35,40]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[q,U,ie,r,w,V,a,t,B,M]);return{promptKeeperOpenPositionNotification:se,promptKeeperClosePositionNotification:oe,promptKeeperCloseAllPositionNotification:le,promptKeeperPartialClosePositionNotification:ae,promptKeeperIncreaseCollateralNotification:ce,promptKeeperCreateTPSLNotification:ue}}},80989:function(e,t,n){"use strict";var i=n(7744),s=n(93981),r=n(1517);t.Z=function(e){var t=e.disabled,n=e.amount,o=e.fromTokenInfo,l=e.toTokenInfo,a=e.slippage,c=(0,s.useMemo)((function(){return Math.ceil(100*Number(a))}),[a]),u=(0,s.useMemo)((function(){return{amount:n,inputMint:t||null===o||void 0===o||!o.address?void 0:new i.PublicKey(o.address),outputMint:t||null===l||void 0===l||!l.address?void 0:new i.PublicKey(l.address),slippageBps:c,maxAccounts:45,disabledProgramIds:["jupoNjAxXgZ4rjzxzPMP4oxduvQsQtZzyknqvzYNrNu"]}}),[n,t,o,l,c]),d=(0,r.OO)(u),x=d.quoteResponseMeta,p=d.loading,f=d.refresh,m=d.error,h=d.lastRefreshTimestamp,v=(0,s.useMemo)((function(){return{outAmount:null===x||void 0===x?void 0:x.quoteResponse.outAmount,otherAmountThreshold:null===x||void 0===x?void 0:x.quoteResponse.otherAmountThreshold,isLoading:!t&&p}}),[t,p,x]),g=v.outAmount,b=v.otherAmountThreshold;return{isLoading:v.isLoading,outAmount:g,otherAmountThreshold:b,quoteResponseMeta:x,useJupError:m,refresh:f,lastRefreshTimestamp:h}}},21039:function(e,t,n){"use strict";n.d(t,{Ne:function(){return u},QY:function(){return c}});var i=n(97620),s=n(3082),r=n(93981),o=n(72215),l=n(6397),a=[l.Zt,l.ih,l.Eo],c=function(){var e=(0,o.Bn)().topTokenByVolume;return(0,r.useMemo)((function(){var t=a.map((function(e){return e.address})),n=e.map((function(e){return e.address})).concat(t),i=new Set;return n.forEach((function(e){return i.add(e)})),Array.from(i)}),[e])},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SOL-SOL",t="perps",n=(0,s.useRouter)(),l=n.isReady,a=n.query,c=n.replace,u=(0,o.Bn)(),d=u.getTokenSlug;return r.useCallback((function(n,s,r){if(l)if(n&&s){var o=d(n),u=d(s);if("string"===typeof a.inOut){var x=a.inOut.split("-"),p=(0,i.Z)(x,2),f=p[0],m=p[1],h=a.direction;f===o&&m===u&&h===r||c({pathname:"/".concat(t,"/").concat(r,"/").concat(o,"-").concat(u)},void 0,{scroll:!1,shallow:!0})}}else c({pathname:"/".concat(t,"/").concat(r,"/").concat(e)},void 0,{scroll:!1,shallow:!0})}),[l,d,a.inOut,a.direction,c,e])}},38756:function(e,t,n){"use strict";n.d(t,{w:function(){return g}});var i=n(97620),s=n(63956),r=n(27195),o=n(8857),l=n.n(o),a=n(97175),c=n(75206),u=n(7744),d=n(13486),x=n(13170),p=n(8770),f=n(32532),m=n(795).Buffer;function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(v(v({},t),{},{requestType:"market",triggerAboveThreshold:null,triggerPrice:null})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return j.apply(this,arguments)}function j(){return(j=(0,r.Z)(l().mark((function e(t){var n,s,r,o,h,v,g,b,w,j,y,N,P,k,S,O,_,C,T,Z,D,E,M,L;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,s=t.connection,r=t.side,o=t.collateralCustody,h=t.positionCustody,v=t.inputMint,g=t.requestType,b=t.sizeUsdDelta,w=t.collateralTokenDelta,j=t.priceSlippage,t.triggerAboveThreshold,y=t.jupiterMinimumOut,t.triggerPrice,N=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return P=(0,p.h)(n,s),e.next=7,(0,f.c1)(v,N,s);case 7:if(k=e.sent,S=(0,i.Z)(k,2),O=S[0],_=S[1],C=u.PublicKey.findProgramAddressSync([m.from("position"),N.toBuffer(),d.FW.toBuffer(),h.publicKey.toBuffer(),o.publicKey.toBuffer(),"long"===r?[1]:[2]],P.programId)[0],T=new a.BN(Math.floor(1e9*Math.random())),Z=u.PublicKey.findProgramAddressSync([m.from("position_request"),C.toBuffer(),T.toArrayLike(m,"le",8),[1]],P.programId)[0],D=u.PublicKey.findProgramAddressSync([Z.toBuffer(),c.TOKEN_PROGRAM_ID.toBuffer(),v.toBuffer()],c.ASSOCIATED_TOKEN_PROGRAM_ID)[0],E=[],M=[],e.prev=17,v.equals(x.W4)&&(_&&E.push(_),E.push(u.SystemProgram.transfer({fromPubkey:N,toPubkey:O,lamports:BigInt(w.toString())})),E.push(c.Token.createSyncNativeInstruction(c.TOKEN_PROGRAM_ID,O)),M.push(c.Token.createCloseAccountInstruction(c.TOKEN_PROGRAM_ID,O,N,N,[]))),"market"!==g){e.next=27;break}if(j){e.next=22;break}throw"Slippage not set";case 22:return e.next=24,P.methods.createIncreasePositionMarketRequest({sizeUsdDelta:b,collateralTokenDelta:w,side:"long"===r?{long:{}}:{short:{}},priceSlippage:j,jupiterMinimumOut:y,counter:T}).accounts({owner:N,fundingAccount:O,perpetuals:d.TJ,pool:d.FW,position:C,positionRequest:Z,positionRequestAta:D,custody:h.publicKey,collateralCustody:o.publicKey,inputMint:v,referral:null}).instruction();case 24:L=e.sent,e.next=28;break;case 27:throw"Limit Order not supported";case 28:return e.abrupt("return",{instructions:[].concat(E,[L],M),positionRequestKey:Z});case 31:throw e.prev=31,e.t0=e.catch(17),console.log(e.t0),e.t0;case 35:case"end":return e.stop()}}),e,null,[[17,31]])})))).apply(this,arguments)}},8770:function(e,t,n){"use strict";n.d(t,{h:function(){return o}});var i=n(97175),s=n(55540),r=n(13486),o=function(e,t){var n=new i.Y7(t,e,{commitment:"processed",skipPreflight:!0});return new i.$r(s.x,r.KX,n)}},51232:function(e,t,n){"use strict";n.d(t,{w_:function(){return o}});var i=n(63956);n(65558),n(13838),n(11421);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e){return Object.keys(e).reduce((function(t,n){var s=e[n];return s?r(r({},t),{},(0,i.Z)({},n,"string"===typeof s?s:"function"===typeof s.toString?s.toString():"")):t}),{})}},44710:function(e,t,n){"use strict";n.r(t),n.d(t,{ToggleV2Mini:function(){return c}});var i=n(63956),s=n(24201),r=n(29541);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a=function(e){var t=e.active,n=e.onClick,i=e.className,o=e.dotClassName,l=e.activeClassName,a=e.inactiveClassName,c=(0,s.cn)("bg-white transform translate-x-full",l),u=(0,s.cn)("bg-white dark:bg-white-35",a);return(0,r.jsx)("button",{type:"button",className:(0,s.cn)("w-9 h-5 flex items-center rounded-full p-0.5 cursor-pointer",{"bg-[#71E5EC]":t,"bg-[#010101]":!t},i),onClick:function(){return n(!t)},children:(0,r.jsx)("div",{className:(0,s.cn)("h-4 w-4 rounded-full shadow-md transform duration-300 ease-in-out",t?c:u,o)})})},c=function(e){return(0,r.jsx)(a,l(l({},e),{},{className:"w-6 h-3",dotClassName:"w-3 h-3"}))};t.default=a},99384:function(e,t,n){"use strict";var i=n(29541);t.Z=function(e){var t=e.width,n=void 0===t?12:t,s=e.height,r=void 0===s?12:s;return(0,i.jsxs)("svg",{width:n,height:r,viewBox:"0 0 12 12",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("g",{clipPath:"url(#clip0_841_4053)",children:(0,i.jsx)("path",{d:"M11.6466 4.23513V0.706082L10.4111 1.94156C9.3173 0.741165 7.72912 0 6 0C2.6827 0 0 2.6827 0 6C0 9.3173 2.68203 12 6 12C7.69405 12 9.21142 11.2939 10.3059 10.165L9.31797 9.14128C8.50601 10.0234 7.30561 10.5879 6 10.5879C3.45892 10.5879 1.41216 8.5411 1.41216 6.00002C1.41216 3.45894 3.45892 1.41218 6 1.41218C7.34135 1.41218 8.57615 2.01238 9.42317 2.92954L8.11757 4.23515L11.6466 4.23513Z",fill:"inherit"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_841_4053",children:(0,i.jsx)("rect",{width:"12",height:"12",fill:"white"})})})]})}},11017:function(e,t,n){"use strict";n(93981);var i=n(29541);t.Z=function(e){var t=e.className,n=void 0===t?"":t,s=e.width,r=void 0===s?8:s,o=e.height,l=void 0===o?7:o;return(0,i.jsx)("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:r,height:l,fill:"none",viewBox:"0 0 8 7",children:(0,i.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M5.647 3.674H.69c-.91 0-.91-1.38 0-1.38h4.957L3.89.537c-.659-.659.314-1.631.973-.972l2.949 2.949c.25.25.25.69 0 .972l-2.95 2.95c-.658.627-1.63-.346-.972-.973l1.757-1.788z",clipRule:"evenodd"})})}},94223:function(e,t,n){"use strict";n(93981);var i=n(29541);t.Z=function(e){var t=e.width,n=void 0===t?32:t,s=e.height,r=void 0===s?32:s;return(0,i.jsx)("svg",{width:n,height:r,viewBox:"0 0 32 32",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.1425 8.45597H5.22047L5.22025 8.45592C4.66944 8.40838 4.15821 8.1496 3.79392 7.73368C3.52351 7.52371 3.34106 7.22064 3.28188 6.88329C3.24718 5.65089 4.6625 4.79883 5.9425 4.79883H22.3996C23.1264 4.80107 23.8229 5.09067 24.3368 5.60455C24.8507 6.11843 25.1403 6.81496 25.1425 7.54168V8.45597ZM26.0564 10.2846H5.02779C4.54289 10.2846 4.07777 10.092 3.73473 9.74912C3.39187 9.40605 3.19922 8.94094 3.19922 8.45605V25.8275C3.19922 26.555 3.4882 27.2526 4.00248 27.7671C4.51698 28.2814 5.21451 28.5703 5.94208 28.5703H26.0564C26.7839 28.5703 27.4814 28.2814 27.996 27.7671C28.5102 27.2526 28.7992 26.555 28.7992 25.8275V23.0846H24.2278C22.9213 23.0846 21.7139 22.3875 21.0607 21.2561C20.4074 20.1246 20.4074 18.7303 21.0607 17.5989C21.7139 16.4675 22.9213 15.7703 24.2278 15.7703H28.7992V13.0275C28.7992 12.2999 28.5102 11.6024 27.996 11.0879C27.4815 10.5736 26.7839 10.2846 26.0564 10.2846ZM22.4014 19.4277C22.4014 19.9126 22.594 20.3777 22.9369 20.7208C23.2799 21.0636 23.7451 21.2563 24.2299 21.2563H28.8014V17.5991H24.2299C23.745 17.5991 23.2799 17.7918 22.9369 18.1346C22.594 18.4777 22.4014 18.9428 22.4014 19.4277Z",fill:"currentColor"})})}},56769:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return Sn},default:function(){return On}});var i=n(93981),s=n(19424),r=n(97620),o=n(27195),l=n(8857),a=n.n(l),c=n(7761),u=n(35682),d=n(72215),x=n(27177),p=n(25224),f=n(45009),m=n(13838),h=n(3011),v=n(68586),g=n(39268),b=n.n(g),w=n(72997),j=n(56100),y=n(24201),N=n(25546),P=n(11352),k=n(29541),S=function(e){var t=e.price,n=e.precision,s=e.children,r=(0,i.useState)(""),o=r[0],l=r[1],a=(0,N.D9)(null===t||void 0===t?void 0:t.toDP(n)),c=(0,i.useRef)(Date.now());return(0,i.useEffect)((function(){var e=null===t||void 0===t?void 0:t.toDP(n);if(a)return null!==e&&void 0!==e&&e.gt(a)?(l("text-perps-green"),void(c.current=Date.now())):null!==e&&void 0!==e&&e.lt(a)?(l("text-red-500"),void(c.current=Date.now())):void(null!==e&&void 0!==e&&e.eq(a)&&Date.now()-c.current>1e3&&l(""));Date.now()-c.current>1e3&&l("")}),[t]),(0,k.jsx)("span",{className:(0,y.cn)("transition-all duration-100 text-white",o),children:s})},O=n(6397),_=n(13486),C=n(31900),T=n(63956),Z=n(7763),D=n(40993),E=n(79989),M=n(44495);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(e){var t=(0,E.Z)();(0,M.Z)((function(){var n=function(){var i=(0,o.Z)(a().mark((function i(){var s;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.online||!e){i.next=14;break}return i.prev=1,i.next=4,Z.chaosWebsocket.createSocket();case 4:null===(s=i.sent)||void 0===s||s.send(JSON.stringify(Z.CHAOS_SUBSCRIPTION_MESSAGE)),null===s||void 0===s||s.addEventListener("message",(function(e){var t=JSON.parse(e.data),n=t.p,i=t.e,s=parseFloat(n)*Math.pow(10,i);D.e_.set(D.iw,A(A({},t),{},{p:s.toString()}))})),null===s||void 0===s||s.addEventListener("error",(function(){Z.chaosWebsocket.closeSocket(),n()})),i.next=14;break;case 10:i.prev=10,i.t0=i.catch(1),Z.chaosWebsocket.closeSocket(),n();case 14:case"end":return i.stop()}}),i,null,[[1,10]])})));return function(){return i.apply(this,arguments)}}();return n(),function(){Z.chaosWebsocket.closeSocket()}}),[t.online,e])},R=n(21039);var F=n(73360),q=n(3380),U=n(99384),K=function(e){var t=e.loading,n=e.emptyText,i=e.className,s=(0,d.Os)().wallet;return(0,k.jsx)("div",{className:(0,y.cn)("flex flex-col items-center space-y-2 rounded-lg mt-4 bg-white-5 py-[60px] justify-start dark:border-white-10 mx-5 lg:mx-0",i),children:null!==s&&void 0!==s&&s.adapter.publicKey?(0,k.jsx)(k.Fragment,{children:t?(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"mr-2 fill-current animate-spin",children:(0,k.jsx)(U.Z,{width:8,height:8})}),(0,k.jsx)("div",{className:"text-sm dark:text-white/50",children:(0,k.jsx)(F.cC,{id:"Loading data"})})]}):(0,k.jsx)("div",{className:"text-sm dark:text-white/50",children:n})}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"text-sm dark:text-white/50",children:(0,k.jsx)(F.cC,{id:"Connect your wallet to see your Trades"})}),(0,k.jsx)(q.T,{})]})})},V=n(14518),B=n(40558),z=n(88381),$=n(36872),H=n(44710),W=n(59978),G=function(e){var t=e.width,n=void 0===t?15:t,i=e.height,s=void 0===i?15:i;return(0,k.jsx)("svg",{width:n,height:s,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,k.jsx)("path",{id:"Icon",d:"M11.9999 6.66665L9.33319 3.99998M1.6665 14.3333L3.92275 14.0826C4.19841 14.052 4.33624 14.0367 4.46507 13.995C4.57936 13.958 4.68814 13.9057 4.78843 13.8396C4.90147 13.765 4.99953 13.6669 5.19565 13.4708L13.9999 4.66665C14.7362 3.93027 14.7362 2.73636 13.9999 1.99998C13.2635 1.2636 12.0696 1.2636 11.3332 1.99998L2.52899 10.8042C2.33287 11.0003 2.23481 11.0983 2.16026 11.2114C2.09413 11.3117 2.04185 11.4205 2.00485 11.5347C1.96314 11.6636 1.94783 11.8014 1.9172 12.0771L1.6665 14.3333Z",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},Q=n(86150),Y=function(e){var t=e.width,n=void 0===t?12:t,i=e.height,s=void 0===i?12:i;return(0,k.jsx)("svg",{width:n,height:s,viewBox:"0 0 12 12",fill:"inherit",fillOpacity:0,xmlns:"http://www.w3.org/2000/svg",children:(0,k.jsx)("path",{d:"M5 1.5H8M2 3H11M10 3L9.64936 8.25964C9.59675 9.04877 9.57044 9.44333 9.40001 9.7425C9.24996 10.0059 9.02362 10.2176 8.75083 10.3498C8.44098 10.5 8.04555 10.5 7.25467 10.5H5.74533C4.95445 10.5 4.55902 10.5 4.24917 10.3498C3.97638 10.2176 3.75004 10.0059 3.59999 9.7425C3.42956 9.44333 3.40325 9.04877 3.35064 8.25965L3 3M5.5 5.25V7.75M7.5 5.25V7.75",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},X={isClosingAllPositions:(0,n(9364).cn)(!1)},J=n(54423),ee=n(13215),te=n(69825),ne=n(85394),ie=n(6340),se=n(12866),re=n(7744),oe=n(70107),le=n(97175),ae=n(8770),ce=n(8862);function ue(e){return de.apply(this,arguments)}function de(){return(de=(0,o.Z)(a().mark((function e(t){var n,i,s,r,o,l,c,u,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,r=t.positionRequestAccount,o=t.sizeUsdDelta,l=t.triggerPrice,c=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return u=(0,ae.h)(n,i),d=ce.zC[s.custody.publicKey.toString()],e.prev=6,e.next=9,u.methods.updateDecreasePositionRequest2({sizeUsdDelta:o,triggerPrice:l}).accounts({owner:c,perpetuals:_.TJ,pool:_.FW,position:s.publicKey,positionRequest:r,custody:s.custody.publicKey,custodyDovesPriceAccount:d.dovesOracle,custodyPythnetPriceAccount:d.pythnetOracle}).instruction();case 9:return e.abrupt("return",e.sent);case 12:throw e.prev=12,e.t0=e.catch(6),console.log(e.t0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)}var xe=n(75206),pe=n(13170),fe=n(32532),me=n(795).Buffer;function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ge(e){return be.apply(this,arguments)}function be(){return be=(0,o.Z)(a().mark((function e(t){var n,i,s,l,c,u,d,x,p,f,m,h,v,g,b,w,j,y,N,P;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,l=t.desiredMint,c=t.tpPrice,u=t.tpCounter,d=t.slPrice,x=t.slCounter,p=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return f=[],m=[],h=(0,ae.h)(n,i),e.next=9,(0,fe.c1)(l,p,i);case 9:return v=e.sent,g=(0,r.Z)(v,2),b=g[0],(w=g[1])&&f.push(w),e.next=16,Promise.all([{price:c,counter:u},{price:d,counter:x}].map(function(){var e=(0,o.Z)(a().mark((function e(t){var n,i,r,o,u,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.price,i=t.counter,n){e.next=3;break}return e.abrupt("return",null);case 3:return r=re.PublicKey.findProgramAddressSync([me.from("position_request"),s.publicKey.toBuffer(),i.toArrayLike(me,"le",8),[2]],h.programId)[0],o=re.PublicKey.findProgramAddressSync([r.toBuffer(),xe.TOKEN_PROGRAM_ID.toBuffer(),l.toBuffer()],xe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],u=ce.zC[s.custody.publicKey.toString()],e.next=8,h.methods.createDecreasePositionRequest2({entirePosition:!0,triggerPrice:n,counter:i,sizeUsdDelta:new le.BN(0),collateralUsdDelta:new le.BN(0),requestType:{trigger:{}},triggerAboveThreshold:"long"===s.side?n===c:n!==c,priceSlippage:null,jupiterMinimumOut:null}).accounts({owner:p,receivingAccount:b,perpetuals:_.TJ,pool:_.FW,position:s.publicKey,positionRequest:r,positionRequestAta:o,custody:s.custody.publicKey,custodyDovesPriceAccount:u.dovesOracle,custodyPythnetPriceAccount:u.pythnetOracle,collateralCustody:s.collateralCustody.publicKey,desiredMint:l,tokenProgram:xe.TOKEN_PROGRAM_ID,associatedTokenProgram:xe.ASSOCIATED_TOKEN_PROGRAM_ID,systemProgram:re.SystemProgram.programId,referral:null}).instruction();case 8:return d=e.sent,e.abrupt("return",d);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:return j=e.sent,y=(0,r.Z)(j,2),N=y[0],P=y[1],N&&m.push(N),P&&m.push(P),e.abrupt("return",{preInstructions:f,instructions:m});case 23:case"end":return e.stop()}}),e)}))),be.apply(this,arguments)}function we(e,t,n){return je.apply(this,arguments)}function je(){return(je=(0,o.Z)(a().mark((function e(t,n,i){var s,r,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return s="long"===i.side?new le.BN(0):new le.BN("18446744073709551615"),e.prev=3,e.next=6,ye({wallet:t,connection:n,position:i,priceSlippage:s,collateralUsdDelta:new le.BN(0),sizeUsdDelta:new le.BN(i.sizeUsd.toFixed(0)),desiredMint:i.collateralCustody.account.mint,jupiterMinimumOut:null});case 6:return r=e.sent,o=r.instructions,l=r.positionRequestKey,e.abrupt("return",{instructions:o,positionRequestKey:l});case 12:return e.prev=12,e.t0=e.catch(3),console.log("Failed to close position!",e.t0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[3,12]])})))).apply(this,arguments)}function ye(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,o.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pe(ve(ve({},t),{},{requestType:"market",triggerPrice:null,entirePosition:null,triggerAboveThreshold:null}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e){return ke.apply(this,arguments)}function ke(){return(ke=(0,o.Z)(a().mark((function e(t){var n,i,s,o,l,c,u,d,x,p,f,m,h,v,g,b,w,j,y,N,P,k;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.position,o=t.collateralUsdDelta,l=t.sizeUsdDelta,c=t.desiredMint,u=t.requestType,d=t.priceSlippage,x=t.jupiterMinimumOut,t.triggerPrice,t.triggerAboveThreshold,p=t.entirePosition,f=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return m=(0,ae.h)(n,i),e.next=7,(0,fe.c1)(c,f,i);case 7:if(h=e.sent,v=(0,r.Z)(h,2),g=v[0],b=v[1],w=new le.BN(Math.floor(1e9*Math.random())),j=re.PublicKey.findProgramAddressSync([me.from("position_request"),s.publicKey.toBuffer(),w.toArrayLike(me,"le",8),[2]],m.programId)[0],y=re.PublicKey.findProgramAddressSync([j.toBuffer(),xe.TOKEN_PROGRAM_ID.toBuffer(),c.toBuffer()],xe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],N=[],b&&N.push(b),P=[],c.equals(pe.W4)&&P.push(xe.Token.createCloseAccountInstruction(xe.TOKEN_PROGRAM_ID,g,f,f,[])),e.prev=18,"market"!==u){e.next=27;break}if(d){e.next=22;break}throw"Slippage not set";case 22:return e.next=24,m.methods.createDecreasePositionMarketRequest({collateralUsdDelta:o,sizeUsdDelta:l,priceSlippage:d,jupiterMinimumOut:x,counter:w,entirePosition:p}).accounts({owner:f,receivingAccount:g,perpetuals:_.TJ,pool:_.FW,position:s.publicKey,positionRequest:j,positionRequestAta:y,custody:s.custody.publicKey,collateralCustody:s.collateralCustody.publicKey,desiredMint:c,tokenProgram:xe.TOKEN_PROGRAM_ID,associatedTokenProgram:xe.ASSOCIATED_TOKEN_PROGRAM_ID,systemProgram:re.SystemProgram.programId,referral:null}).instruction();case 24:k=e.sent,e.next=28;break;case 27:throw"Wrong Ix";case 28:return e.abrupt("return",{instructions:[].concat(N,[k],P),positionRequestKey:j});case 31:throw e.prev=31,e.t0=e.catch(18),console.log(e.t0),e.t0;case 35:case"end":return e.stop()}}),e,null,[[18,31]])})))).apply(this,arguments)}function Se(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,o.Z)(a().mark((function e(t){var n,i,s,o,l,c,u,d,x,p,f,m,h,v,g,b,w,j,y,N;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.cancelTP,o=t.cancelSL,e.prev=1,l=n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(c=(0,ae.h)(n,i),u=[],d=[],!s){e.next=21;break}return e.next=11,(0,fe.c1)(s.positionRequestMint,l,i);case 11:return x=e.sent,p=(0,r.Z)(x,2),f=p[0],m=p[1],h=re.PublicKey.findProgramAddressSync([s.positionRequestPubkey.toBuffer(),xe.TOKEN_PROGRAM_ID.toBuffer(),s.positionRequestMint.toBuffer()],xe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],m&&u.push(m),e.next=19,c.methods.closePositionRequest({}).accounts({keeper:null,owner:l,ownerAta:f,pool:_.FW,positionRequest:s.positionRequestPubkey,positionRequestAta:h,position:s.positionPubkey}).instruction();case 19:v=e.sent,d.push(v);case 21:if(!o){e.next=34;break}return e.next=24,(0,fe.c1)(o.positionRequestMint,l,i);case 24:return g=e.sent,b=(0,r.Z)(g,2),w=b[0],j=b[1],y=re.PublicKey.findProgramAddressSync([o.positionRequestPubkey.toBuffer(),xe.TOKEN_PROGRAM_ID.toBuffer(),o.positionRequestMint.toBuffer()],xe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],j&&u.push(j),e.next=32,c.methods.closePositionRequest({}).accounts({keeper:null,owner:l,ownerAta:w,pool:_.FW,positionRequest:o.positionRequestPubkey,positionRequestAta:y,position:o.positionPubkey}).instruction();case 32:N=e.sent,d.push(N);case 34:return e.abrupt("return",{preInstructions:u,instructions:d});case 37:throw e.prev=37,e.t0=e.catch(1),console.log(e.t0),e.t0;case 41:case"end":return e.stop()}}),e,null,[[1,37]])})))).apply(this,arguments)}function _e(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,o.Z)(a().mark((function e(t){var n,i,s,r,o,l,c,u,d,x,p,f,m,h,v,g,b,w,j,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,t.custody,r=t.desiredMint,o=t.tpPrice,l=t.slPrice,c=t.updateTPPrice,u=t.updateSLPrice,d=t.cancelTP,x=t.cancelSL,e.prev=1,n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(!([o,l,c,u,d,x].filter(Boolean).length>2)){e.next=7;break}throw new Error("Only two actions can be performed at a time");case 7:if(p=[],f=[],!o&&!l){e.next=17;break}return e.next=12,ge({wallet:n,connection:i,positionAccount:s,desiredMint:r,tpPrice:o,tpCounter:new le.BN(Math.floor(1e9*Math.random())),slPrice:l,slCounter:new le.BN(Math.floor(1e9*Math.random()))});case 12:m=e.sent,h=m.preInstructions,v=m.instructions,h&&p.push.apply(p,(0,oe.Z)(h)),v&&f.push.apply(f,(0,oe.Z)(v));case 17:if(!c){e.next=22;break}return e.next=20,ue({wallet:n,connection:i,positionAccount:s,positionRequestAccount:c.positionRequestAccount,sizeUsdDelta:new le.BN(0),triggerPrice:c.triggerPrice});case 20:g=e.sent,f.push(g);case 22:if(!u){e.next=27;break}return e.next=25,ue({wallet:n,connection:i,positionAccount:s,positionRequestAccount:u.positionRequestAccount,sizeUsdDelta:new le.BN(0),triggerPrice:u.triggerPrice});case 25:b=e.sent,f.push(b);case 27:if(!d&&!x){e.next=35;break}return e.next=30,Se({wallet:n,connection:i,cancelTP:d,cancelSL:x});case 30:w=e.sent,j=w.preInstructions,y=w.instructions,j&&p.push.apply(p,(0,oe.Z)(j)),y&&f.push.apply(f,(0,oe.Z)(y));case 35:return e.abrupt("return",[].concat(p,f));case 38:throw e.prev=38,e.t0=e.catch(1),console.log(e.t0),e.t0;case 42:case"end":return e.stop()}}),e,null,[[1,38]])})))).apply(this,arguments)}var Te=n(39694),Ze=n.n(Te)()((function(e){var t,n,i,s;return{hasTp:null!==(t=e.takeProfitPositionRequest)&&void 0!==t&&t.account.triggerPrice?new m.Z(null===(n=e.takeProfitPositionRequest)||void 0===n?void 0:n.account.triggerPrice.toString()).div(1e6):null,hasSl:null!==(i=e.stopLossPositionRequest)&&void 0!==i&&i.account.triggerPrice?new m.Z(null===(s=e.stopLossPositionRequest)||void 0===s?void 0:s.account.triggerPrice.toString()).div(1e6):null}})),De=function(e){var t,n,s=e.positionAccount,r=e.tpPrice,o=e.slPrice,l=(0,_.tc)().oraclePrices,a=(0,i.useMemo)((function(){return"long"===s.side}),[s.side]),c=(0,i.useMemo)((function(){var e=s.custody.account.mint.toString();return l&&l[e]}),[s.custody.account.mint,l]),u=(0,i.useMemo)((function(){return c?c.toNearest(.01,m.Z.ROUND_DOWN):null}),[c]),d=(0,i.useMemo)((function(){var e,t;return c&&null!==(e=s.accounting)&&void 0!==e&&e.liquidationPrice?(a?new m.Z(null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)):c).toNearest(.01,m.Z.ROUND_DOWN):null}),[c,null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice,a]),x=(0,i.useMemo)((function(){var e,t;return c&&null!==(e=s.accounting)&&void 0!==e&&e.liquidationPrice?(a?c:new m.Z(null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2))).toNearest(.01,m.Z.ROUND_DOWN):null}),[c,null===(n=s.accounting)||void 0===n?void 0:n.liquidationPrice,a]),p=(0,i.useMemo)((function(){return!(!r.floatValue||!u)&&(a?new m.Z(r.floatValue).gte(u):new m.Z(r.floatValue).lte(u))}),[u,a,r.floatValue]),f=(0,i.useMemo)((function(){return!!(o.floatValue&&d&&x)&&(a?new m.Z(o.floatValue).gte(d)&&new m.Z(o.floatValue).lte(x):new m.Z(o.floatValue).lte(x)&&new m.Z(o.floatValue).gte(d))}),[x,d,a,o]),h=(0,i.useCallback)((function(e){if(!s.accounting)return null;var t=e.sub(s.price).mul(a?1:-1),n=new m.Z(s.sizeUsd.toString()).div(new m.Z(s.price.toString())).mul(t),i=new m.Z(n).minus(s.accounting.totalFeeUsd);return{positionValue:new m.Z(s.sizeUsd.toString()).add(i),pnlRate:i.div(new m.Z(s.accounting.initialCollateral.toString())).mul(100),pnl:i}}),[a,s.accounting,s.price,s.sizeUsd]),v=(0,i.useMemo)((function(){return r.floatValue&&p?h(new m.Z(r.floatValue).mul(1e6)):null}),[r.floatValue,p,h]),g=(0,i.useMemo)((function(){return o.floatValue&&f?h(new m.Z(o.floatValue).mul(1e6)):null}),[o.floatValue,f,h]),b=Ze(s),w=b.hasTp,j=b.hasSl;return{showTPChanged:(0,i.useMemo)((function(){return!(null===w||void 0===w||!w.gt(0)||!r.floatValue||new m.Z(r.floatValue).eq(w)||!p)}),[w,p,r.floatValue]),showTPRemoved:(0,i.useMemo)((function(){return!(null===w||void 0===w||!w.gt(0)||r.floatValue)}),[w,r.floatValue]),showSLChanged:(0,i.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||!o.floatValue||new m.Z(o.floatValue).eq(j)||!f)}),[j,f,o.floatValue]),showSLRemoved:(0,i.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||o.floatValue)}),[j,o.floatValue]),minimumTPPrice:u,minimumSLPrice:d,maximumSLPrice:x,isWithinTPRange:p,isWithinSLRange:f,expectedPositionValueAtSL:g,expectedPositionValueAtTP:v}},Ee=function(e){var t=e.changePct,n=e.pnl;if(!t||!n)return(0,k.jsx)(j.O,{className:"!w-12 !h-4"});var i=n.abs().div(1e6).toFixed(2),s=t.toDP(2).abs().toFixed(2);return(0,k.jsx)("p",{className:(0,y.cn)("text-xs",n.gt(0)?"text-perps-green":"text-perps-red"),children:n.gt(0)?"+$".concat(i," (+").concat(s,"%)"):"-$".concat(i," (-").concat(s,"%)")})},Me=n(80751),Le=n(51232),Ae=["positionAccount","custody"];function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e){var t,n,i;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(i=null===e||void 0===e?void 0:e.toString())&&void 0!==i?i:""}:{floatValue:void 0,formattedValue:"",value:""}}var qe=function(e){var t=e.open,n=e.onClose,s=e.positionAccount,r=e.type,l=(0,_.tc)(),u=l.viewClient,x=l.oraclePrices,f=l.isAnyFormSubmitting,m=(0,d.Bn)(),h=m.connection,v=m.getTokenInfo,g=m.tokenMap,b=(0,d.Os)().wallet,w=(0,ie.Z)().promptKeeperCreateTPSLNotification,j=(0,i.useMemo)((function(){return v(s.custody.account.mint.toString())}),[v,s.custody.account.mint]),N=i.useRef(null);(0,p.O3)(N,(function(){var e;return null===(e=N.current)||void 0===e?void 0:e.close()}));var P=(0,i.useCallback)((function(){var e;null===(e=N.current)||void 0===e||e.close(),n()}),[n,N]);(0,i.useEffect)((function(){if(N.current&&(t?N.current.open||N.current.show():N.current.close()),t){var e=N.current;return null===e||void 0===e||e.addEventListener("close",P),function(){null===e||void 0===e||e.removeEventListener("close",P)}}}),[P,t]);var S=(0,i.useMemo)((function(){return v(s.collateralCustody.account.mint.toString())}),[v,s.collateralCustody.account.mint]),O=Ze(s),C=O.hasTp,T=O.hasSl,Z=(0,ee.cI)({defaultValues:{tpPrice:Fe(C),slPrice:Fe(T)}}),D=Z.control,E=Z.handleSubmit,M=Z.watch,L=(Z.setValue,Z.formState),A=M("tpPrice"),I=M("slPrice"),R=De({positionAccount:s,tpPrice:A,slPrice:I}),q=R.expectedPositionValueAtSL,U=R.expectedPositionValueAtTP,K=(0,i.useState)(null),V=K[0],B=K[1],z=(0,i.useMemo)((function(){var e=s.takeProfitPositionRequest||s.stopLossPositionRequest;if(e)return e}),[s.stopLossPositionRequest,s.takeProfitPositionRequest]);(0,i.useEffect)((function(){z&&B(g.get(z.account.mint.toString())||null),!V&&S&&B(S)}),[S,z,V,g]);var $=(0,i.useMemo)((function(){var e=s.custody.account.mint.toString();return x&&x[e]?x[e]:null}),[x,s.custody.account.mint]),H=(0,i.useMemo)((function(){return L.isSubmitting}),[L.isSubmitting]),W=(0,i.useCallback)((0,o.Z)(a().mark((function e(){var t,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&b.adapter.publicKey&&j&&u&&$&&V){e.next=2;break}return e.abrupt("return");case 2:if(t={positionAccount:s,custody:s.custody.account,desiredMint:new re.PublicKey(V.address),tpPrice:null,slPrice:null,updateTPPrice:null,updateSLPrice:null},e.prev=3,n="tp"===r&&s.takeProfitPositionRequest?{cancelTP:{positionPubkey:s.publicKey,positionRequestPubkey:s.takeProfitPositionRequest.publicKey,positionRequestMint:s.takeProfitPositionRequest.account.mint},cancelSL:null}:"sl"===r&&s.stopLossPositionRequest?{cancelTP:null,cancelSL:{positionPubkey:s.publicKey,positionRequestPubkey:s.stopLossPositionRequest.publicKey,positionRequestMint:s.stopLossPositionRequest.account.mint}}:void 0){e.next=7;break}throw new Error("No cancel action found!");case 7:return e.next=9,_e(Re(Re({wallet:b,connection:h},t),n));case 9:return i=e.sent,e.next=12,new Promise(function(){var e=(0,o.Z)(a().mark((function e(n,s){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w({doveInstructions:i},(function(e){P(),n(e)}),(function(e){s(e)}),"tp"===r?c.ag._("Removing Take Profit..."):c.ag._("Removing Stop Loss..."),function(){var e=t.positionAccount,n=(t.custody,(0,J.Z)(t,Ae));return Re({wallet:b.adapter.name,positionAccount:e.publicKey.toString()},(0,Le.w_)(n))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t0=e.catch(3),console.log("Failed to submit position request!",e.t0);case 18:case"end":return e.stop()}}),e,null,[[3,15]])}))),[b,j,u,$,V,h,s,r,w,P]);return(0,k.jsx)(Me.Z,{open:t,onClose:n,children:(0,k.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,k.jsx)("div",{className:"p-6 font-semibold text-lg text-v2-lily",children:"tp"===r?c.ag._("Remove Take Profit"):c.ag._("Remove Stop Loss")}),(0,k.jsx)("button",{type:"button",disabled:f,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:P,children:(0,k.jsx)(se.Z,{width:12,height:12})}),(0,k.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,k.jsxs)("div",{className:"px-6",children:[(0,k.jsx)("div",{className:"flex text-sm whitespace-nowrap flex-wrap text-v2-lily/50",children:(0,k.jsx)(F.cC,{id:"<0>{0}</0><1>{1}?</1>",values:{0:c.ag._("Are you sure you want to remove your"),1:"tp"===r?c.ag._("take profit"):c.ag._("stop loss")},components:{0:(0,k.jsx)("p",{}),1:(0,k.jsx)("p",{className:"mx-1"})}})}),"tp"===r?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Take Profit Price:")}),U?(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,k.jsx)(Ee,{changePct:U.pnlRate,pnl:U.pnl})}):null]})}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"tpPrice",control:D,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsx)(te.Z,{disabled:!0,decimals:6,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,k.jsx)("div",{className:"mt-1 space-y-1",children:U?(0,k.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._("Expected position value: ${0}",{0:U.positionValue.div(1e6).toFixed(2)})}):null})]}):null,"sl"===r?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Stop Loss Price:")}),q?(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,k.jsx)(Ee,{changePct:q.pnlRate,pnl:q.pnl})}):null]})}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"slPrice",control:D,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsx)(te.Z,{disabled:!0,decimals:6,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,k.jsx)("div",{className:"mt-1 space-y-1",children:q?(0,k.jsx)("span",{className:"text-xs text-v2-lily/30",children:c.ag._("Expected position value: ${0}",{0:q.positionValue.div(1e6).toFixed(2)})}):null})]}):null]}),(0,k.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[L.isSubmitting?null:(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":L.isSubmitting}),disabled:L.isSubmitting,onClick:P,children:(0,k.jsx)("span",{children:c.ag._("Cancel")})}),(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":L.isSubmitting||H}),disabled:H,onClick:E(W),children:L.isSubmitting?(0,k.jsxs)("span",{className:"flex justify-center items-center",children:[(0,k.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,k.jsx)("div",{className:"mr-2"}),"tp"===r?c.ag._("Removing Take Profit"):c.ag._("Removing Stop Loss")]}):(0,k.jsx)("span",{className:"text-center",children:c.ag._("Confirm")})})]})]})]})})},Ue=n(67768),Ke=function(e,t){var n=N.uf.format(e.abs().div(1e6),t);return e.gt(0)?"+$".concat(n):"-$".concat(n)},Ve=function(e){var t=e.positionAccount,n=(0,_.tc)().showPnlWithFees;if(!t.accounting)return(0,k.jsx)(j.O,{className:"!w-24 !h-9"});var i=t.accounting,s=i.unrealizedPNL,r=i.unrealizedPNLPct,o=i.positionValue,l=i.initialCollateral,a=i.fundingFeeUsd,u=i.openPositionFeeUsd,d=i.closePositionFeeUsd,x=i.pnlAfterFeesUsd,p=i.pnlAfterFeesPct,f=t.pool,h=(0,Ue.y_)(o);return(0,k.jsxs)("div",{className:(0,y.cn)("text-sm text-v2-lily"),children:[(0,k.jsx)("div",{className:"flex",children:(0,k.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,k.jsxs)("div",{className:"flex flex-col text-white cursor-help",children:[(0,k.jsx)("p",{children:c.ag._("Net Value:")}),(0,k.jsx)("p",{className:"mb-4",children:c.ag._("Initial collateral + PnL - Fees")}),(0,k.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,k.jsx)("span",{className:"text-white/50",children:c.ag._("Initial Collateral:")}),(0,k.jsxs)("span",{children:["$",l.add(u).div(1e6).toFixed(h)]})]}),(0,k.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,k.jsx)("span",{className:"text-white/50",children:c.ag._("PnL:")}),(0,k.jsx)("span",{children:Ke(s,h)})]}),(0,k.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,k.jsx)("span",{className:"text-white/50",children:c.ag._("Borrow Fee:")}),(0,k.jsxs)("span",{children:["-$",a.div(1e6).toFixed(h)]})]}),(0,k.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,k.jsx)("span",{className:"text-white/50",children:c.ag._("Open Fee ({0}%):",{0:new m.Z(f.fees.increasePositionBps.toString()).div(100).toDP(2).toString()})}),(0,k.jsxs)("span",{children:["-$",u.div(1e6).toFixed(h)]})]}),(0,k.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,k.jsx)("span",{className:"text-white/50",children:c.ag._("Close Fee ({0}%):",{0:new m.Z(f.fees.decreasePositionBps.toString()).div(100).toDP(2).toString()})}),(0,k.jsxs)("span",{children:["-$",d.div(1e6).toFixed(h)]})]}),(0,k.jsxs)("div",{className:"flex justify-between",children:[(0,k.jsx)("span",{className:"text-white/50",children:c.ag._("PnL After Fees:")}),(0,k.jsx)("span",{children:Ke(x,h)})]}),(0,k.jsx)("p",{className:"mt-2 text-white/50 !w-[180px]",children:c.ag._("Calculated Pnl is an estimate and does not include price impact.")})]}),children:(0,k.jsxs)("span",{className:"underline decoration-dashed decoration-1 underline-offset-[3px] decoration-white/50 cursor-help",children:["$",N.uf.format(o.div(1e6),h)]})})}),(0,k.jsx)(Ee,{changePct:n?p:r,pnl:n?x:s})]})},Be=function(e){var t,n,s,o,l,a,u,x,p,f,v,g,b,w,P,S,O,T,Z,D=e.positionAccount,E=e.onSelectMarket,M=(0,_.tc)(),L=M.oraclePrices,A=M.userPositionsLoading,I=M.isAnyFormSubmitting,R=M.showPnlWithFees,q=M.setShowPnlWithFees,U=(0,C.y)(),K=U.showEditCollateralDialog,J=U.showEditTPSLDialog,ee=U.showClosePositionDialog,te=U.showSharePositionDialog,ne=(0,d.Bn)().getTokenInfo,ie=(0,i.useMemo)((function(){return ne(D.custody.account.mint.toString())}),[ne,D.custody.account.mint]),se=(0,h.KO)(X.isClosingAllPositions),re=(0,r.Z)(se,1)[0],oe=(0,i.useCallback)((function(){D&&!re&&ee({positionAccountPubkey:D.publicKey})}),[re,D,ee]),le=null!==(t=D.accounting)&&void 0!==t&&t.unrealizedPNL.abs().gt(100)?2:4,ae=(0,i.useState)(!1),ce=ae[0],ue=ae[1],de=(0,i.useMemo)((function(){return L&&L[D.custody.account.mint.toString()]}),[L,D.custody.account.mint]),xe=(0,Ue.y_)(de),pe=(0,i.useCallback)((function(){ie&&de&&D.accounting&&te({symbol:null===ie||void 0===ie?void 0:ie.symbol,leverage:D.leverage.toFixed(2),side:D.side,entryPrice:N.uf.format(D.price.div(1e6),xe),markPrice:N.uf.format(de,xe),openedDate:(0,V.Z)(new Date(1e3*D.position.openTime.toNumber()),"MMM dd, kk:mm O"),pnlPercentage:D.accounting.unrealizedPNL.gt(0)?D.accounting.unrealizedPNLPct.toDP(2):D.accounting.unrealizedPNLPct.toDP(2).mul(-1)})}),[de,D.accounting,D.leverage,D.position.openTime,D.price,D.side,xe,te,ie]),fe=(0,i.useMemo)((function(){return D?D.sizeUsd.div(D.price):null}),[D]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:(0,y.cn)("hidden 2xl:flex","justify-between items-center rounded-lg h-[72px] min-w-[1092px] border-b border-b-v2-lily/[0.02] overflow-hidden"),children:[(0,k.jsxs)("div",{onClick:function(){return E(D)},className:"cursor-pointer pl-2 py-3 flex text-white/[.75] items-center text-xs w-[130px]",children:[(0,k.jsx)(W.Z,{info:ie}),(0,k.jsxs)("div",{className:"ml-2",children:[(0,k.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,k.jsxs)("div",{className:"leading-none space-y-2",children:[(0,k.jsx)("p",{className:"text-xs",children:(0,k.jsx)(F.cC,{id:"Click on a row to select the position's market, then use the trade box to increase your position size if needed."})}),(0,k.jsx)("p",{className:"text-xs",children:(0,k.jsx)(F.cC,{id:'Use the "Close" button to reduce your position size, or to set stop-loss / take-profit orders.'})})]}),children:(0,k.jsx)("p",{className:"underline font-semibold decoration-dashed decoration-1 underline-offset-[3px] decoration-white/50 text-sm text-v2-lily",children:null===ie||void 0===ie?void 0:ie.symbol})}),(0,k.jsxs)("p",{className:"text-xs text-white/75",children:[D.leverage.toFixed(2),"x ",D.side]})]})]}),(0,k.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center text-xs w-[128px]",children:(0,k.jsx)(Ve,{positionAccount:D})}),(0,k.jsxs)("div",{className:"pl-2 py-3 flex flex-col text-xs w-[70px]",children:[(0,k.jsx)("span",{className:"text-white/[.75]",children:D.sizeUsd?"$"+D.sizeUsd.div(1e6).toFixed(2):(0,k.jsx)(j.O,{className:"!h-4 !w-10"})}),(0,k.jsx)("span",{className:"text-v2-lily/40 whitespace-nowrap flex",children:fe?(0,k.jsxs)(k.Fragment,{children:[(0,z.M)({value:fe.toDP(null===ie||void 0===ie?void 0:ie.decimals).toNumber()}),(0,k.jsx)("span",{className:"ml-0.5",children:null===ie||void 0===ie?void 0:ie.symbol})]}):(0,k.jsx)(j.O,{className:"!h-4 !w-10"})})]}),(0,k.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center text-xs w-[120px] space-x-2",children:(0,k.jsx)("div",{className:"flex items-center cursor-help text-xs space-x-2",children:null!==(n=D.accounting)&&void 0!==n&&n.initialCollateral.gt(0)?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,k.jsxs)("div",{className:"leading-none",children:[(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("div",{className:"text-white/75",children:c.ag._("Initial Collateral:")}),(0,k.jsxs)("div",{children:["$",null===(s=D.accounting)||void 0===s?void 0:s.initialCollateral.div(1e6).toFixed(le)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,k.jsx)("div",{className:"text-white/75",children:c.ag._("Borrow Fee:")}),(0,k.jsxs)("div",{children:["-$",null===(o=D.accounting)||void 0===o?void 0:o.fundingFeeUsd.div(1e6).toFixed(le)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,k.jsx)("div",{className:"text-white/75",children:c.ag._("Borrow Fee / Hour:")}),(0,k.jsxs)("div",{children:["-$",null===(l=D.accounting)||void 0===l?void 0:l.borrowFeePerHourForPosition.div(1e6).toFixed(le)]})]}),(0,k.jsx)("div",{className:"mt-4",children:(0,k.jsx)("p",{className:"text-xs",children:(0,k.jsx)(F.cC,{id:"Use the Edit Collateral icon to deposit or withdraw collateral."})})})]}),children:(0,k.jsx)("span",{children:"$"+(null===(a=D.accounting)||void 0===a?void 0:a.initialCollateral.div(1e6).toFixed(2))})}),(0,k.jsx)("button",{type:"button",onClick:function(){return K({positionAccountPubkey:D.publicKey})},disabled:I,className:(0,y.cn)("rounded-lg px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10",{"opacity-50 cursor-not-allowed":I}),children:c.ag._("Edit")})]}):(0,k.jsx)(j.O,{className:"!h-4 !w-12"})})}),(0,k.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[144px]",children:D.price?(0,k.jsxs)("div",{className:"flex space-x-1",children:[(0,k.jsx)("span",{children:"$"+N.uf.format(D.price.div(1e6),xe)}),(0,k.jsx)("span",{className:"text-v2-lily/40",children:"/"}),(0,k.jsx)("span",{className:"text-v2-lily/40",children:de?N.uf.format(de,xe):(0,k.jsx)(j.O,{className:"!h-4 !w-12"})})]}):(0,k.jsx)(j.O,{className:"!h-4 !w-12"})}),(0,k.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,k.jsx)("div",{className:"leading-none",children:(0,k.jsxs)("div",{className:"text-xs",children:[(0,k.jsx)("div",{children:c.ag._("Liquidation Price calculation:")}),(0,k.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,k.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px] cursor-help text-perps-warning justify-center",children:null!==(u=D.accounting)&&void 0!==u&&u.liquidationPrice?"$".concat(N.uf.format(null===(x=D.accounting)||void 0===x?void 0:x.liquidationPrice.div(1e6),xe)):null})}),ce?(0,k.jsx)(qe,{open:"tp"===ce||"sl"===ce,onClose:function(){return ue(!1)},positionAccount:D,type:ce}):null,(0,k.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[95px] decoration-white/30 space-x-2 relative",children:null!==(p=D.takeProfitPositionRequest)&&void 0!==p&&p.account.triggerPrice?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(new m.Z(D.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,k.jsx)("div",{onClick:function(){return J({positionAccountPubkey:D.publicKey,focusOn:"tp"})},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,k.jsx)(G,{width:16,height:16})}),(0,k.jsx)("div",{onClick:function(){return ue("tp")},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,k.jsx)(Y,{width:16,height:16})})]}):(0,k.jsx)("div",{className:"w-full flex justify-center",children:(0,k.jsx)("button",{type:"button",onClick:function(){return J({positionAccountPubkey:D.publicKey,focusOn:"tp"})},disabled:I,className:(0,y.cn)("text-xs rounded-lg px-2 py-1.5 border border-v2-lily/5 text-perps-green bg-perps-green/5 hover:bg-perps-green/20",{"opacity-50 cursor-not-allowed":I}),children:c.ag._("Add TP")})})}),(0,k.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[95px] decoration-white/30 space-x-2",children:null!==(f=D.stopLossPositionRequest)&&void 0!==f&&f.account.triggerPrice?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(new m.Z(D.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,k.jsx)("div",{onClick:function(){return J({positionAccountPubkey:D.publicKey,focusOn:"sl"})},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,k.jsx)(G,{width:16,height:16})}),(0,k.jsx)("div",{onClick:function(){return ue("sl")},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,k.jsx)(Y,{width:16,height:16})})]}):(0,k.jsx)("div",{className:"w-full flex justify-center",children:(0,k.jsx)("button",{type:"button",onClick:function(){return J({positionAccountPubkey:D.publicKey,focusOn:"sl"})},disabled:I,className:(0,y.cn)("text-xs rounded-lg px-2 py-1.5 border border-v2-lily/5 text-perps-red bg-perps-red/5 hover:bg-perps-red/20",{"opacity-50 cursor-not-allowed":I}),children:c.ag._("Add SL")})})}),(0,k.jsxs)("div",{className:"flex justify-center text-xs w-[100px] pl-4 xl:pl-0 pr-4",children:[(0,k.jsx)("button",{type:"button",onClick:pe,className:"rounded-lg px-2 py-1.5 text-white/50 fill-current text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10",children:(0,k.jsx)(Q.Z,{width:12,height:12})}),(0,k.jsx)("button",{type:"button",className:(0,y.cn)("ml-1 rounded-lg px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",{"opacity-50 cursor-not-allowed":re||I}),onClick:oe,disabled:re||I,children:c.ag._("Close")})]})]}),(0,k.jsxs)("div",{className:(0,y.cn)("block 2xl:hidden","mt-5 px-3 pb-5 border-b border-b-v2-lily/5 overflow-x-hidden"),children:[(0,k.jsxs)("div",{onClick:function(){return E(D)},className:"cursor-pointer flex text-white/[.75] items-center text-xs",children:[(0,k.jsx)("div",{className:"flex lg:hidden",children:(0,k.jsx)(W.Z,{info:ie,width:16,height:16})}),(0,k.jsx)("div",{className:"hidden lg:flex",children:(0,k.jsx)(W.Z,{info:ie,width:32,height:32})}),(0,k.jsxs)("span",{className:"ml-2 font-semibold text-sm text-v2-lily",children:[null===ie||void 0===ie?void 0:ie.symbol,"-PERP"]}),(0,k.jsxs)("span",{className:"ml-2 text-xs text-v2-lily/40",children:[D.leverage.toFixed(2),"x ",D.side]}),A?(0,k.jsx)($.Z,{}):null,(0,k.jsxs)("button",{type:"button",onClick:pe,className:"ml-auto rounded-full border border-labs/10  p-1 fill-current space-x-1 flex items-center px-2 py-1.5 bg-labs/10 text-labs hover:bg-labs/20",children:[(0,k.jsx)(Q.Z,{width:12,height:12}),(0,k.jsx)("span",{children:c.ag._("Share")})]})]}),(0,k.jsxs)("div",{className:"mt-3 flex justify-between",children:[(0,k.jsxs)("div",{className:"basis-5/12 flex flex-col space-y-1",children:[(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsx)("div",{className:"flex items-center space-x-1",children:(0,k.jsx)("span",{children:c.ag._("Value")})}),(0,k.jsxs)("div",{className:"flex gap-x-1 items-center",children:[(0,k.jsxs)("span",{className:"text-v2-lily/30",children:["(",R?c.ag._("after fees"):c.ag._("before fees"),")"]}),(0,k.jsx)(H.ToggleV2Mini,{active:R,onClick:function(){q((function(e){return!e}))}})]})]}),(0,k.jsx)("span",{className:"text-sm font-semibold",children:(0,k.jsx)(Ve,{positionAccount:D})})]}),(0,k.jsxs)("div",{className:"basis-3/12 flex flex-col mt-1",children:[(0,k.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._("Size")}),(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsx)("span",{className:"text-white/[.75]",children:D.sizeUsd?"$"+D.sizeUsd.div(1e6).toFixed(2):(0,k.jsx)(j.O,{className:"!h-4 !w-10"})}),(0,k.jsx)("span",{className:"text-v2-lily/40",children:fe?(0,k.jsxs)(k.Fragment,{children:[(0,z.M)({value:fe.toDP(null===ie||void 0===ie?void 0:ie.decimals).toNumber()}),(0,k.jsx)("span",{className:"ml-0.5",children:null===ie||void 0===ie?void 0:ie.symbol})]}):(0,k.jsx)(j.O,{className:"!h-4 !w-10"})})]})]}),(0,k.jsxs)("div",{className:"basis-4/12 flex flex-col items-end",children:[(0,k.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._("Collateral")}),(0,k.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:null!==(v=D.accounting)&&void 0!==v&&v.initialCollateral.gt(0)?(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,k.jsxs)("div",{className:"leading-none",children:[(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("div",{className:"text-white/75",children:c.ag._("Initial Collateral:")}),(0,k.jsxs)("div",{children:["$",null===(g=D.accounting)||void 0===g?void 0:g.initialCollateral.div(1e6).toFixed(le)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,k.jsx)("div",{className:"text-white/75",children:c.ag._("Borrow Fee:")}),(0,k.jsxs)("div",{children:["-$",null===(b=D.accounting)||void 0===b?void 0:b.fundingFeeUsd.div(1e6).toFixed(le)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,k.jsx)("div",{className:"text-white/75",children:c.ag._("Borrow Fee / Hour:")}),(0,k.jsxs)("div",{children:["-$",null===(w=D.accounting)||void 0===w?void 0:w.borrowFeePerHourForPosition.div(1e6).toFixed(le)]})]}),(0,k.jsx)("div",{className:"mt-4",children:(0,k.jsx)("p",{className:"text-xs",children:(0,k.jsx)(F.cC,{id:"Use the Edit Collateral icon to deposit or withdraw collateral."})})})]}),children:(0,k.jsx)("span",{children:"$"+(null===(P=D.accounting)||void 0===P?void 0:P.initialCollateral.div(1e6).toFixed(2))})})}):(0,k.jsx)(j.O,{className:"!h-4 !w-12"})})]})]}),(0,k.jsxs)("div",{className:"mt-3 flex w-full justify-between",children:[(0,k.jsxs)("div",{className:"basis-5/12 flex flex-col",children:[(0,k.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._("Entry Price")}),(0,k.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:D.price?(0,k.jsx)("div",{className:"flex space-x-1",children:(0,k.jsx)("span",{children:"$"+N.uf.format(D.price.div(1e6),xe)})}):(0,k.jsx)(j.O,{className:"!h-4 !w-12"})})]}),(0,k.jsxs)("div",{className:"basis-3/12 flex flex-col",children:[(0,k.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._("Mark Price")}),(0,k.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:de?N.uf.format(de,xe):(0,k.jsx)(j.O,{className:"!h-4 !w-12"})})]}),(0,k.jsxs)("div",{className:"basis-4/12 flex flex-col items-end",children:[(0,k.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._("Liq. Price")}),(0,k.jsx)("span",{className:"text-xs font-semibold",children:(0,k.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,k.jsx)("div",{className:"leading-none",children:(0,k.jsxs)("div",{className:"text-xs",children:[(0,k.jsx)("div",{children:c.ag._("Liquidation Price calculation:")}),(0,k.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,k.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,k.jsx)("div",{className:"flex items-center text-xs cursor-help text-perps-warning/75",children:null!==(S=D.accounting)&&void 0!==S&&S.liquidationPrice?"$".concat(N.uf.format(null===(O=D.accounting)||void 0===O?void 0:O.liquidationPrice.div(1e6),xe)):null})})})]})]}),(0,k.jsxs)("div",{className:"w-full mt-3 py-2 flex justify-between items-center lg:justify-start bg-black/50 rounded-lg",children:[(0,k.jsxs)("div",{className:"basis-6/12 md:basis-5/12",children:[(0,k.jsx)("span",{className:"text-v2-lily/40 pl-4",children:c.ag._("Take Profit")}),null!==(T=D.takeProfitPositionRequest)&&void 0!==T&&T.account.triggerPrice?(0,k.jsxs)("span",{className:"ml-3 text-perps-green",children:["$",N.uf.format(new m.Z(D.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,k.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,k.jsxs)("div",{className:"basis-6/12 md:basis-3/12",children:[(0,k.jsx)("span",{className:"text-v2-lily/40",children:c.ag._("Stop Loss")}),null!==(Z=D.stopLossPositionRequest)&&void 0!==Z&&Z.account.triggerPrice?(0,k.jsxs)("span",{className:"ml-3 text-perps-red",children:["$",N.uf.format(new m.Z(D.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,k.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,k.jsx)("div",{className:"hidden min-w-[400px]:basis-4/12"})]}),(0,k.jsxs)("div",{className:"w-full mt-3 flex justify-between space-x-2",children:[(0,k.jsx)("button",{type:"button",onClick:function(){return J({positionAccountPubkey:D.publicKey})},disabled:I,className:(0,y.cn)("flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5",{"opacity-50 cursor-not-allowed":I}),children:c.ag._("TP/SL")}),(0,k.jsx)("button",{type:"button",onClick:function(){return K({positionAccountPubkey:D.publicKey})},disabled:I,className:(0,y.cn)("flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5",{"opacity-50 cursor-not-allowed":I}),children:c.ag._("Edit Collateral")}),(0,k.jsx)("button",{type:"button",onClick:oe,disabled:re||I,className:(0,y.cn)("flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5 disabled:opacity-50 disabled:cursor-not-allowed",{"opacity-50 cursor-not-allowed":re||I}),children:c.ag._("Market Close")})]})]})]})},ze=function(){var e=(0,d.Os)().wallet,t=(0,_.tc)(),n=t.userPositions,s=t.refreshPositionInfo,l=t.isAnyFormSubmitting,u=(0,d.Bn)().connection,x=(0,ie.Z)().promptKeeperCloseAllPositionNotification,p=(0,h.KO)(X.isClosingAllPositions),f=(0,r.Z)(p,2),m=f[0],v=f[1],g=(0,i.useCallback)((0,o.Z)(a().mark((function t(){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!==(null===n||void 0===n?void 0:n.length)){t.next=2;break}return t.abrupt("return");case 2:if(e){t.next=4;break}throw new Error("Wallet not connected");case 4:return v(!0),t.prev=5,t.next=8,Promise.all(n.map((function(t){return we(e,u,t)})));case 8:return i=t.sent,t.next=11,x(i.filter(Boolean));case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),console.log("Failed to close all positions!",t.t0);case 16:return t.prev=16,s(),v(!1),t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[5,13,16,20]])}))),[u,x,s,v,n,e]);return(0,k.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:m||0===(null===n||void 0===n?void 0:n.length)||l,onClick:g,children:m?(0,k.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,k.jsx)(ne.Z,{width:8,height:8}),(0,k.jsx)("span",{children:c.ag._("Closing...")})]}):c.ag._("Close All")})},$e=function(e){var t=e.setPositionDirection,n=(0,d.Os)().wallet,s=(0,_.tc)(),r=s.userPositions,o=s.userPositionsFetched,l=s.oraclePrices,a=s.showPnlWithFees,u=s.setShowPnlWithFees,x=(0,d.Bn)().getTokenInfo,p=(0,i.useMemo)((function(){return r?r.sort((function(e,t){return e.sizeUsd.gt(t.sizeUsd)?-1:1})):null}),[r]),f=p&&Object.keys(p).length>0,m=(0,R.Ne)(),h=(0,i.useCallback)((function(e){var n=x(e.custody.account.mint.toString()),i=x(e.custody.account.mint.toString());n&&i&&(m(n,i,e.side),t(e.side))}),[m,x,t]),v=(0,i.useMemo)((function(){return!o||0===Object.keys(l||{}).length}),[l,o]);return(0,k.jsx)("div",{className:"flex-1 w-full min-w-[300px] overflow-hidden bg-[#16202B] pb-20",children:(0,k.jsxs)("div",{className:"w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar",children:[null!==n&&void 0!==n&&n.adapter.publicKey?(0,k.jsxs)("div",{className:(0,y.cn)("text-xs dark:text-white-50 justify-between font-semibold dark:font-normal border-y border-[rgba(255,255,255,0.02)]","hidden 2xl:flex w-full"),children:[(0,k.jsx)("div",{className:"pl-4 py-3 flex items-center text-xs w-[130px]",children:"Position"}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[128px] space-x-1",children:(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsx)("span",{children:c.ag._("Value")}),(0,k.jsxs)("div",{className:"flex gap-x-1 items-center",children:[(0,k.jsxs)("span",{className:"text-v2-lily/30 !w-[76px]",children:["(",a?c.ag._("after fees"):c.ag._("before fees"),")"]}),(0,k.jsx)(H.ToggleV2Mini,{active:a,onClick:function(){u((function(e){return!e}))}})]})]})}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px]",children:"Size"}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[120px]",children:"Collateral"}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[144px] justify-center",children:"Entry / Mark Price"}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px] justify-center",children:"Liq. Price"}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[95px] justify-center",children:"Take Profit"}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[95px] justify-center",children:"Stop Loss"}),(0,k.jsx)("div",{className:"py-3 flex items-center justify-end pr-4 text-xs w-[100px]",children:(0,k.jsx)(ze,{})})]}):null,f?null:(0,k.jsx)(K,{loading:v,emptyText:(0,k.jsx)(F.cC,{id:"No positions"})}),f?(0,k.jsx)("div",{className:"overflow-auto webkit-scrollbar bg-[#16202B]",children:p.map((function(e,t){return(0,k.jsx)(Be,{id:e.publicKey.toString(),positionAccount:e,onSelectMarket:h},t)}))}):null]})})},He=b()((function(){return Promise.resolve().then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),We=function(e){var t=e.title,n=e.active,i=e.onClick;return(0,k.jsx)("button",{type:"button",onClick:i,className:(0,y.cn)("leading-none flex items-center font-semibold text-xs text-white/20 whitespace-nowrap","hover:!text-v2-lily",{"!text-v2-lily":n}),children:t})},Ge=function(e){var t=e.activeTab,n=e.setActiveTab,s=e.className,o=e.showPositions,l=e.setShowPositions,a=e.children,u=(0,_.tc)().userPositions,d=(0,i.useMemo)((function(){return(null===u||void 0===u?void 0:u.length)||0}),[null===u||void 0===u?void 0:u.length]),p=(0,x.XA)(),f=i.useState(!1),m=(0,r.Z)(f,2),h=m[0],v=m[1],g=(0,i.useRef)(null),b=(0,i.useRef)(null);return(0,i.useEffect)((function(){function e(){var e,t=(null===(e=b.current)||void 0===e?void 0:e.offsetTop)||0;g.current&&p&&window.scrollY>t?v(!0):v(!1)}return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[p]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{ref:b,className:"w-full"}),(0,k.jsx)("div",{className:(0,y.cn)(h?"pt-[44px]":"")}),(0,k.jsx)("div",{ref:g,className:(0,y.cn)("flex w-full lg:mx-auto bg-[#16202B] relative",s,h?"fixed top-0 w-full z-50":""),children:(0,k.jsx)("div",{className:"w-full max-w-full overflow-hidden",children:(0,k.jsxs)("div",{className:"lg:flex flex-row justify-between w-full border-b border-v2-lily/5",children:[(0,k.jsxs)("div",{className:"flex justify-between",children:[(0,k.jsxs)("div",{className:"flex space-x-6 justify-start items-center overflow-y-auto p-3 w-full",children:[(0,k.jsx)(We,{title:d>0?c.ag._("Positions ({0})",{0:null===u||void 0===u?void 0:u.length}):c.ag._("Positions"),active:"Positions"===t,onClick:function(){return n("Positions")}}),(0,k.jsx)(We,{title:c.ag._("Trade History"),active:"Trade History"===t,onClick:function(){return n("Trade History")}}),(0,k.jsx)(We,{title:c.ag._("Expired Orders"),active:"Expired Orders"===t,onClick:function(){return n("Expired Orders")}})]}),(0,k.jsx)("div",{className:"flex 2xl:hidden items-center pr-2",children:(0,k.jsx)(ze,{})})]}),(0,k.jsxs)("div",{className:"hidden lg:flex whitespace-nowrap px-4 space-x-2 items-center text-xs text-v2-lily/50",children:[(0,k.jsx)(He,{active:o,onClick:function(){return l((function(e){return!e}))}}),(0,k.jsx)("span",{children:c.ag._("Show Positions on Chart")})]})]})})}),a]})},Qe=n(47338),Ye=n(55540),Xe=function(){var e=(0,o.Z)(a().mark((function e(t,n,i){var s,o,l,c,u,d,x,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],o=n.account.mint.equals(xe.NATIVE_MINT),l=re.PublicKey.findProgramAddressSync([n.publicKey.toBuffer(),xe.TOKEN_PROGRAM_ID.toBuffer(),n.account.mint.toBuffer()],xe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],e.next=5,(0,fe.c1)(n.account.mint,n.account.owner,i);case 5:return c=e.sent,u=(0,r.Z)(c,2),d=u[0],x=u[1],!o&&x&&s.push(x),e.next=12,t.methods.closePositionRequest({}).accounts({keeper:null,owner:n.account.owner,ownerAta:o?null:d,pool:_.FW,positionRequest:n.publicKey,positionRequestAta:l,position:n.account.position}).instruction();case 12:return p=e.sent,s.push(p),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),Je=n(90342),et=n(24628),tt=n(33130),nt=n(11711),it=function(e){var t,n,s=e.id,l=e.data,u=(0,_.tc)().program,x=(0,nt.NL)(),p=(0,d.Bn)(),f=p.connection,v=p.getTokenInfo,g=(0,d.oP)().getExplorer,b=(0,d.Os)().publicKey,w=(0,tt.R3)(),j=(0,h.KO)(D.yz),N=(0,r.Z)(j,1)[0],P=(0,Je.gs)().priorityLevel,S=(0,i.useMemo)((function(){return v(l.account.mint.toString())}),[l.account.mint,v]),O=(0,i.useState)(!1),C=O[0],T=O[1],Z=(0,i.useCallback)((0,o.Z)(a().mark((function e(){var t,n,i,s,r,o,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.publicKey){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,T(!0),e.next=6,f.getLatestBlockhash("confirmed");case 6:return n=e.sent,i=n.blockhash,s=n.lastValidBlockHeight,e.next=11,Xe(u,l,f);case 11:return r=e.sent,o=(t=new re.Transaction({blockhash:i,lastValidBlockHeight:s,feePayer:b})).add.apply(t,(0,oe.Z)(r)),e.next=15,w(o,{blockhash:i,idl:Ye.x,idlProgramId:_.KX,lastValidBlockHeight:s},{successMessage:c.ag._("Pending order closed"),submittingMessage:c.ag._("Closing pending order..."),errorMessage:c.ag._("Failed to close pending order"),referenceFee:"MEDIUM"===P?N.perps.m:"HIGH"===P?N.perps.h:"VERY_HIGH"===P?N.perps.vh:void 0,minimumFee:D.uo,requestComputeBudgetLimit:3e5});case 15:if(!("error"in(d=e.sent))){e.next=18;break}throw d.error;case 18:x.setQueryData(["perps-pending-refunds",null===b||void 0===b?void 0:b.toString()],(function(e){return e?e.filter((function(e){return!e.publicKey.equals(l.publicKey)})):e})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),console.log("Failed to close pending order",e.t0);case 24:return e.prev=24,T(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[2,21,24,27]])}))),[f,l,w,P,u,b,x,N.perps.h,N.perps.m,N.perps.vh]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(s),className:"flex lg:hidden w-full px-3 py-4 bg-[#16202B] border-t border-cyan-50 border-opacity-5 flex-col justify-center items-start gap-3",children:[(0,k.jsxs)("div",{className:"flex justify-between items-center w-full gap-2",children:[(0,k.jsxs)("div",{className:"items-center gap-2 flex",children:[(0,k.jsx)("div",{className:"relative",children:S&&(0,k.jsx)(W.Z,{info:S,width:16,height:16})}),(0,k.jsx)("div",{className:"items-center gap-1 flex",children:(0,k.jsxs)("div",{translate:"no",className:"text-v2-lily text-sm font-semibold",children:[null===S||void 0===S?void 0:S.symbol,"-PERP"]})}),(0,k.jsx)("div",{className:"px-2 py-0.5 bg-perps-red bg-opacity-20 rounded-2xl border border-perps-red border-opacity-20 items-center flex",children:(0,k.jsxs)("div",{className:"text-center text-perps-red text-[11px] font-medium",children:[l.account.requestChange.increase?c.ag._("Increase"):c.ag._("Decrease")," ",l.account.side.long?c.ag._("Long"):c.ag._("Short")]})})]}),(0,k.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,k.jsx)("a",{href:g(l.publicKey.toString()),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,k.jsx)(et.Z,{})})})]}),(0,k.jsxs)("div",{className:"w-full items-start justify-between gap-x-2 flex",children:[(0,k.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("Collateral")}),(0,k.jsxs)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:[new m.Z((null===(t=l.account.collateralDelta)||void 0===t?void 0:t.toString())||0).div(Math.pow(10,(null===S||void 0===S?void 0:S.decimals)||0)).toString()," ",null===S||void 0===S?void 0:S.symbol]})]}),(0,k.jsx)("div",{className:(0,y.cn)("flex items-center text-xs text-white/[.75]"),children:(0,k.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:C,onClick:Z,children:C?(0,k.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,k.jsx)(ne.Z,{width:8,height:8}),(0,k.jsx)("span",{children:c.ag._("Closing...")})]}):c.ag._("Close")})})]}),(0,k.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(l.account.openTime.muln(1e3).toNumber(),"H:mm dd/MM/yyyy (x)")})]}),(0,k.jsxs)("div",{id:"jupiter-perps-order-".concat(s),className:(0,y.cn)("hidden lg:flex justify-between items-center h-[62px] w-full min-w-[762px]"),children:[(0,k.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,k.jsxs)("div",{className:"pl-2 py-3 flex flex-col items-start text-xs min-w-[150px]",children:[(0,k.jsxs)("span",{className:"font-semibold",children:[null===S||void 0===S?void 0:S.symbol,"-PERP"]}),(0,k.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(l.account.openTime.muln(1e3).toNumber(),"H:mm dd/MM/yyyy (x)")})]}),(0,k.jsxs)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:[l.account.requestChange.increase?c.ag._("Increase"):c.ag._("Decrease")," ",l.account.side.long?c.ag._("Long"):c.ag._("Short")]})]}),(0,k.jsxs)("div",{className:"w-[60%] flex justify-evenly",children:[(0,k.jsx)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center justify-center text-xs min-w-[90px] text-white/[.75]"),children:l.account.requestChange.decrease?"-":"\n              ".concat(new m.Z((null===(n=l.account.collateralDelta)||void 0===n?void 0:n.toString())||0).div(Math.pow(10,(null===S||void 0===S?void 0:S.decimals)||0)).toString()," ").concat(null===S||void 0===S?void 0:S.symbol,"\n             ")}),(0,k.jsx)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center text-xs min-w-[84px] text-white/[.75]"),children:(0,k.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:C,onClick:Z,children:C?(0,k.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,k.jsx)(ne.Z,{width:8,height:8}),(0,k.jsx)("span",{children:c.ag._("Closing...")})]}):c.ag._("Close")})})]}),(0,k.jsx)("div",{className:"w-[10%] flex justify-between",children:(0,k.jsx)("div",{className:"min-w-[42px] pl-2 py-3 flex items-center text-white/50 fill-current dark:text-white/50",children:(0,k.jsx)("a",{href:g(l.publicKey.toString(),"account"),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,k.jsx)(et.Z,{})})})})]})]})},st=function(e){(0,Qe.Z)(e);var t=(0,d.Os)().wallet,n=(0,_.tc)(),i=n.pendingRefund,s=n.pendingRefundLoading;return(0,k.jsx)("div",{className:"flex-1 w-full min-w-[300px] bg-[#16202B]",children:(0,k.jsxs)("div",{className:"w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar rounded-lg relative",children:[null!==t&&void 0!==t&&t.adapter.publicKey?(0,k.jsxs)("div",{className:(0,y.cn)("hidden lg:flex text-xs dark:text-white-50 font-semibold dark:font-normal border-b border-v2-lily/5","w-full min-w-[762px]"),children:[(0,k.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px]",children:c.ag._("Position")}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:c.ag._("Action")})]}),(0,k.jsxs)("div",{className:"w-[60%] flex justify-evenly",children:[(0,k.jsx)("div",{className:"pl-2 py-3 flex justify-center items-center text-xs min-w-[90px]",children:c.ag._("Collateral")}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:c.ag._("Close")})]}),(0,k.jsx)("div",{className:"w-[10%] flex justify-between",children:(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:c.ag._("Account")})})]}):null,(0,k.jsxs)("div",{children:[0===i.length?(0,k.jsx)(K,{loading:Boolean(s),emptyText:(0,k.jsx)(F.cC,{id:"No expired orders"})}):null,i.length>0?i.map((function(e,t){return(0,k.jsx)(it,{id:e.publicKey.toString(),data:e},t)})):null]})]})})},rt=n(32529),ot=n(30825),lt=function(e){var t=e.width,n=void 0===t?16:t,i=e.height,s=void 0===i?16:i,r=e.className;return(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:s,viewBox:"0 0 24 24",className:r,children:(0,k.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2",d:"M20 4H4v2l6 6v8.5l4-2.5v-6l6-6z"})})},at=function(e){var t=e.width,n=void 0===t?10:t,i=e.height,s=void 0===i?10:i,r=e.stroke,o=void 0===r?"#768222":r;return(0,k.jsx)("svg",{width:n,height:s,viewBox:"0 0 10 10",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,k.jsx)("path",{d:"M8.33329 2.5L3.74996 7.08333L1.66663 5",stroke:o,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})},ct=function(){return(0,k.jsx)("div",{className:"h-4"})},ut=function(e){var t=e.item,n=t.label,i=t.onClick,s=t.selected,r=void 0!==s&&s,o=t.separator,l=void 0!==o&&o,a=t.className,c=Boolean(i);return(0,k.jsxs)("li",{className:"flex flex-col cursor-default",children:[(0,k.jsxs)("div",{className:(0,p.cn)("w-full flex items-center justify-between text-left text-sm text-white/50 bg-transparent space-x-2 pl-2 pr-4 fill-current",c?"hover:bg-white/10 cursor-pointer":"cursor-default",a),onClick:function(e){e.stopPropagation(),null===i||void 0===i||i()},children:[(0,k.jsx)("div",{className:"w-full",children:n}),r&&(0,k.jsx)(at,{stroke:"rgba(199, 242, 132, 1)"})]}),l&&(0,k.jsx)(ct,{})]})},dt=function(e){var t=e.items,n=e.filterOn,s=(0,i.useRef)(null),r=(0,i.useState)(!1),o=r[0],l=r[1];return(0,i.useEffect)((function(){var e=function(e){s.current&&!s.current.contains(e.target)&&l(!1)};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[]),(0,k.jsxs)("button",{className:(0,p.cn)("relative fill-current",n?"text-v2-lily":"hover:text-v2-lily text-v2-lily/50"),onClick:function(){l((function(e){return!e}))},ref:s,children:[(0,k.jsx)(lt,{width:12,height:12}),(0,k.jsx)("div",{className:(0,p.cn)("absolute top-2 left-full min-w-[15rem] transition-all overflow-hidden","bg-v3 shadow-header-settings rounded-xl border border-v2-lily/10",o?"opacity-100 z-50":"opacity-0 pointer-events-none"),children:(0,k.jsx)("ul",{children:t.map((function(e,t){return(0,k.jsx)(ut,{item:e},t)}))})})]})},xt=function(e){var t=e.id,n=e.data,s=e.setPositionDirection,r=(0,C.y)().showShareHistoryDialog,o=(0,d.Bn)().getTokenInfo,l=(0,d.oP)().getExplorer,a=(0,i.useMemo)((function(){return o(n.mint.toString())}),[o,n.mint]),u=n.pnlUsd?new m.Z(n.pnlUsd.toString()).div(1e6).toDP(2):null,x=(0,R.Ne)(),p=(0,i.useCallback)((function(){if(n.inOutTokenMint&&a){var e=o(n.inOutTokenMint.toString());e&&a&&(x(e,a,"Long"===n.side?"long":"short"),s("Long"===n.side?"long":"short"))}}),[n.inOutTokenMint,n.side,a,o,x,s]),f=function(){r(n)};return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(t),className:"flex lg:hidden w-full px-3 py-4 bg-[#16202B] border-t border-cyan-50 border-opacity-5 flex-col justify-center items-start gap-3",children:[(0,k.jsxs)("div",{className:"flex justify-between items-center w-full gap-2",onClick:function(){return p()},children:[(0,k.jsxs)("div",{className:"items-center gap-2 flex",children:[(0,k.jsx)("div",{className:"relative",children:(0,k.jsx)(W.Z,{info:a,width:16,height:16})}),(0,k.jsx)("div",{className:"items-center gap-1 flex",children:(0,k.jsxs)("div",{translate:"no",className:"text-v2-lily text-sm font-semibold",children:[null===a||void 0===a?void 0:a.symbol,"-PERP"]})}),(0,k.jsx)("div",{className:"px-2 py-0.5 bg-perps-red bg-opacity-20 rounded-2xl border border-perps-red border-opacity-20 items-center flex",children:(0,k.jsxs)("div",{className:"text-center text-perps-red text-[11px] font-medium",children:[n.requestChange," ",n.side]})})]}),(0,k.jsxs)("div",{className:"flex space-x-2",children:[(0,k.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,k.jsx)("a",{href:l(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,k.jsx)(et.Z,{})})}),(0,k.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,k.jsx)("button",{className:"fill-current text-white/50",onClick:f,children:(0,k.jsx)(Q.Z,{width:12,height:12})})})]})]}),(0,k.jsxs)("div",{className:"w-full items-start gap-3 flex",children:[(0,k.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("Order Type")}),(0,k.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:n.requestType})]}),(0,k.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("Deposit/Withdraw")}),(0,k.jsxs)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:["Increase"===n.requestChange?"-$":"+$",new m.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]})]}),(0,k.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("Price")}),(0,k.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new m.Z(n.price.toString()).div(1e6).toFixed(2).toString()})]})]}),(0,k.jsxs)("div",{className:"w-full items-start gap-3 flex",children:[(0,k.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("Size")}),(0,k.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new m.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,k.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("Fee")}),(0,k.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new m.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,k.jsxs)("div",{className:(0,y.cn)("grow shrink basis-0 flex-col items-start flex",u?"":"invisible"),children:[(0,k.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:c.ag._("PnL")}),(0,k.jsx)("div",{className:(0,y.cn)("text-v2-lily/75 text-xs font-semibold",{"text-[rgba(39,174,96,1)]":null===u||void 0===u?void 0:u.gt(0),"text-[#EB5757]":null===u||void 0===u?void 0:u.lt(0),"text-v2-lily/50":null===u||void 0===u?void 0:u.eq(0)}),children:u?"$"+u.toFixed(2).toString():""})]})]}),(0,k.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,k.jsxs)("div",{id:"jupiter-perps-order-".concat(t),className:(0,y.cn)("hidden lg:flex justify-between items-center h-[62px] w-full min-w-[1092px]"),children:[(0,k.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,k.jsxs)("div",{onClick:function(){return p()},className:"pl-2 py-3 flex flex-col items-start text-xs min-w-[150px]",children:[(0,k.jsxs)("span",{className:"font-semibold",children:[null===a||void 0===a?void 0:a.symbol,"-PERP"]}),(0,k.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,k.jsxs)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:[n.requestChange," ",n.side]}),(0,k.jsx)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:n.requestType})]}),(0,k.jsxs)("div",{className:"w-[65%] flex justify-evenly",children:[(0,k.jsxs)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center text-xs min-w-[150px] text-white/[.75]"),children:["Increase"===n.requestChange?"-$":"+$",new m.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]}),(0,k.jsx)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center text-xs min-w-[90px] text-white/[.75]"),children:"$"+new m.Z(n.price.toString()).div(1e6).toFixed(2).toString()}),(0,k.jsx)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center text-xs min-w-[90px] text-white/[.75]"),children:"$"+new m.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()}),(0,k.jsx)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center text-xs min-w-[120px]",{"text-[rgba(39,174,96,1)]":null===u||void 0===u?void 0:u.gt(0),"text-[#EB5757]":null===u||void 0===u?void 0:u.lt(0),"text-v2-lily/50":null===u||void 0===u?void 0:u.eq(0)}),children:u?"$"+u.toFixed(2).toString():""}),(0,k.jsx)("div",{className:(0,y.cn)("pl-2 py-3 flex items-center text-xs min-w-[84px] text-white/[.75]"),children:"$"+new m.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,k.jsxs)("div",{className:"w-[5%] flex justify-between",children:[(0,k.jsx)("div",{className:"min-w-[42px] pl-2 py-3 flex items-center text-white/50 fill-current dark:text-white/50",children:(0,k.jsx)("a",{href:l(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,k.jsx)(et.Z,{})})}),(0,k.jsx)("div",{className:"min-w-[42px] pl-2 pr-2 py-3 flex items-center text-white/50 fill-current dark:text-white/50",children:(0,k.jsx)("button",{onClick:f,className:"space-x-2",children:(0,k.jsx)(Q.Z,{})})})]})]})]})},pt=function(e){var t=e.header;return(0,k.jsx)("span",{className:"text-xs font-semibold text-v2-lily border-b border-b-v2-lily/20 block w-full pt-3 pb-2",children:t})},ft=function(e){var t=e.tokenInfo;return(0,k.jsxs)("div",{className:"flex items-center space-x-2 text-xs font-semibold text-v2-lily/80 py-2",children:[(0,k.jsx)(W.Z,{info:t,width:18,height:18}),(0,k.jsxs)("span",{children:[t.symbol,"-PERP"]})]})};function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vt=b()((function(){return Promise.all([n.e(1732),n.e(8275)]).then(n.bind(n,88275))}),{ssr:!1,loadableGenerated:{webpack:function(){return[88275]}}}),gt=function(e){var t=e.children;return(0,k.jsx)("div",{className:"text-xs font-semibold text-v2-lily/80 py-2",children:t})},bt=function(e){var t,n,s,r,o,l,a,u,x=e.setPositionDirection,p=(0,d.Os)(),f=p.wallet,m=p.connected,h=(0,_.tc)().tradeHistory,v=function(){var e=(0,_.tc)(),t=e.perpsTokens.nonStableTokens,n=e.tradeHistory,i=n.filter,s=n.setFilter,r=function(){s(ht(ht({},i),{},{requestChange:void 0}))},o=function(){s(ht(ht({},i),{},{side:void 0}))},l=t.map((function(e){var t=(null===i||void 0===i?void 0:i.mint)===e.address;return{label:(0,k.jsx)(ft,{tokenInfo:e}),selected:t,onClick:function(){s(ht(ht({},i),{},t?{mint:void 0}:{mint:e.address}))}}})),a=[{label:(0,k.jsx)(pt,{header:c.ag._("Token")})}].concat((0,oe.Z)(l),[{label:(0,k.jsx)(pt,{header:c.ag._("Date")})},{label:(0,k.jsx)(vt,{}),className:"px-0"}]);return{actionFilterMenuItems:[{label:(0,k.jsx)(pt,{header:c.ag._("Action")})},{label:(0,k.jsx)(gt,{children:c.ag._("Increase")}),selected:"Increase"===(null===i||void 0===i?void 0:i.requestChange),onClick:function(){"Increase"!==(null===i||void 0===i?void 0:i.requestChange)?s(ht(ht({},i),{},{requestChange:"Increase"})):r()}},{label:(0,k.jsx)(gt,{children:c.ag._("Decrease")}),selected:"Decrease"===(null===i||void 0===i?void 0:i.requestChange),onClick:function(){"Decrease"!==(null===i||void 0===i?void 0:i.requestChange)?s(ht(ht({},i),{},{requestChange:"Decrease"})):r()}},{label:(0,k.jsx)(pt,{header:c.ag._("Side")})},{label:(0,k.jsx)(gt,{children:c.ag._("Long")}),selected:"Long"===(null===i||void 0===i?void 0:i.side),onClick:function(){"Long"!==(null===i||void 0===i?void 0:i.side)?s(ht(ht({},i),{},{side:"Long"})):o()}},{label:(0,k.jsx)(gt,{children:c.ag._("Short")}),selected:"Short"===(null===i||void 0===i?void 0:i.side),onClick:function(){"Short"!==(null===i||void 0===i?void 0:i.side)?s(ht(ht({},i),{},{side:"Short"})):o()}}],positionFilterMenuItems:a}}(),g=v.positionFilterMenuItems,b=v.actionFilterMenuItems,w=(0,rt.Y)({pageIndex:h.pageIndex,pageCount:h.pageCount,setPageIndex:h.setPageIndex}),j=w.pager,N=w.canPreviousPage,P=w.canNextPage,S=w.gotoPage,O=(0,i.useMemo)((function(){var e,t,n,i;return null!==(e=h.data)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.trades&&m?null===(n=h.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.trades:[]}),[m,null===(t=h.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.trades]),C=Boolean((null===(s=h.filter)||void 0===s?void 0:s.mint)||(null===(r=h.filter)||void 0===r?void 0:r.createdAtAfter)),T=Boolean((null===(o=h.filter)||void 0===o?void 0:o.requestChange)||(null===(l=h.filter)||void 0===l?void 0:l.side));return(0,k.jsxs)("div",{className:"flex-1 w-full min-w-[300px] bg-[#16202B]",children:[(0,k.jsxs)("div",{className:"flex flex-col  w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar rounded-lg relative min-h-[350px]",children:[null!==f&&void 0!==f&&f.adapter.publicKey?(0,k.jsxs)("div",{className:(0,y.cn)("hidden lg:flex text-xs dark:text-white-50 font-semibold dark:font-normal border-b border-v2-lily/5","w-full min-w-[1092px]"),children:[(0,k.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,k.jsxs)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px] space-x-2",children:[(0,k.jsx)("p",{children:c.ag._("Position")}),(0,k.jsx)(dt,{items:g,filterOn:C})]}),(0,k.jsxs)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px] space-x-2",children:[(0,k.jsx)("p",{children:c.ag._("Action")}),(0,k.jsx)(dt,{items:b,filterOn:T})]}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:c.ag._("Order Type")})]}),(0,k.jsxs)("div",{className:"w-[65%] flex justify-evenly",children:[(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px]",children:c.ag._("Deposit / Withdraw")}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[90px]",children:c.ag._("Price")}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[90px]",children:c.ag._("Size")}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:c.ag._("PNL")}),(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:c.ag._("Fee")})]}),(0,k.jsx)("div",{className:"w-[5%] flex justify-between",children:(0,k.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[42px]",children:c.ag._("Tx")})})]}):null,(0,k.jsx)("div",{children:O.length>0?O.map((function(e,t){return(0,k.jsx)(xt,{id:e.id,data:e,setPositionDirection:x},t)})):null}),(0,k.jsx)("div",{className:"flex flex-1",children:0===O.length?(0,k.jsx)(K,{loading:Boolean(null===(a=h.data)||void 0===a?void 0:a.isLoading),emptyText:(0,k.jsx)(F.cC,{id:"No trade history"}),className:"flex-1"}):null}),O.length>0&&null!==(u=h.data)&&void 0!==u&&u.isFetching?(0,k.jsx)("div",{className:"absolute top-0 left-0 bg-black/10 backdrop-blur-sm w-full h-full"}):null]}),h.pageCount>0?(0,k.jsx)(ot.Z,{canPreviousPage:N,gotoPage:S,pageIndex:h.pageIndex,pager:j,canNextPage:P}):null]})},wt=n(65558),jt=n.n(wt),yt=n(9319),Nt=n.n(yt),Pt=n(54566),kt=n(71130),St=n(94660),Ot=n(80989),_t=n(50944),Ct=["position"];function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dt=new m.Z(100),Et=function(e){var t,n,s,r,l,u=e.positionAccount,x=(0,_.tc)(),h=x.viewClient,v=x.slippage,g=x.oraclePrices,b=x.refreshPositionInfo,w=x.poolInfo,P=x.isAnyFormSubmitting,S=x.setIsAnyFormSubmitting,T=(0,C.y)(),Z=T.isClosePositionDialogOpen,D=T.dismissClosePositionDialog,E=(0,d.Bn)(),M=E.connection,L=E.getTokenInfo,A=E.tokenMap,I=(0,d.Os)().wallet,R=(0,ie.Z)().promptKeeperClosePositionNotification,q=(0,i.useMemo)((function(){var e;return null!==(e=L(u.custody.account.mint.toString()))&&void 0!==e?e:O.mq}),[L,u.custody.account.mint]),U=(0,i.useMemo)((function(){return L(u.collateralCustody.account.mint.toString())}),[L,u.collateralCustody.account.mint]),K=(0,i.useState)(!0),V=K[0],B=(K[1],(0,i.useMemo)((function(){return u.sizeUsd.div(1e6).toNearest(1e-4,m.Z.ROUND_DOWN).toString()}),[u.sizeUsd])),$=(0,ee.cI)({defaultValues:{amount:B}}),H=$.control,G=$.handleSubmit,Q=$.watch,Y=$.setValue,X=$.formState,oe=Q("amount"),le=(0,i.useCallback)((function(e){var t=new m.Z(B).mul(e).div(100).toString();Y("amount",t)}),[B,Y]),ae=(0,i.useMemo)((function(){if((0,p.Hd)(oe)&&B)return new m.Z(oe).gt(B)}),[oe,B]),ce=(0,i.useMemo)((function(){return Boolean(u.accounting)}),[u.accounting]),ue=(0,i.useMemo)((function(){if(!(0,p.Hd)(oe)||!u.accounting)return[!1,null,null];var e=new m.Z(0),t=u.sizeUsd.sub(new m.Z(oe).mul(1e6)).lt(Dt),n=t?u.sizeUsd:new m.Z(oe).mul(1e6),i=u.accounting.unrealizedPNL;if(t)e=new m.Z(0);else if(V&&n&&!t){var s=n.div(u.sizeUsd);if(e=u.accounting.initialCollateral.mul(s).toDP(0),u.accounting.pnlAfterFeesUsd.lt(0)){var r=i.mul(-1).add(u.accounting.closePositionFeeUsd).mul(s).add(u.accounting.fundingFeeUsd);e=e.gt(r)?e.sub(r).toDP(0):new m.Z(0)}}return[t,e,n]}),[oe,u.accounting,u.sizeUsd,V]),de=ue[0],xe=ue[1],pe=ue[2],fe=(0,f.a)([oe,V,B,null===U||void 0===U?void 0:U.address,u.publicKey.toString()],(0,o.Z)(a().mark((function e(){var t,n,i,s,r,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xe&&pe&&(0,p.Hd)(oe)&&!pe.lte(0)&&U&&h&&Ke&&Ve&&null!==w&&void 0!==w&&w.pool){e.next=2;break}return e.abrupt("return",null);case 2:if(!new m.Z(oe).gt(B)){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,h.getDecreasePosition({position:u,collateralUsdDelta:new(jt())(xe.round().toFixed()),sizeUsdDelta:new(jt())(pe.round().toFixed()),tokenPrice:null===Ke||void 0===Ke?void 0:Ke.toNumber(),collateralTokenPrice:null===Ve||void 0===Ve?void 0:Ve.toNumber(),pool:w.pool});case 6:if(t=e.sent){e.next=9;break}throw new Error("Failed to get decrease position");case 9:return n=new m.Z(t.liquidationPrice.toString()),i=u.sizeUsd.sub(pe),s=new m.Z(t.collateralUsd.toString()),r=m.Z.max(0,new m.Z(t.impactFeeUsd.toString()).div(1e6)),o=(0,p.y_)(r),l=r?"".concat(N.uf.format(r,o)," USD"):"-",e.abrupt("return",{liquidationPrice:de?null:n,size:i,collateralUsd:s.div(1e6),fees:new m.Z(t.feeUsd.toString()).div(1e6),leverage:i.div(s).toNearest(.01,m.Z.ROUND_DOWN),transferToken:new m.Z(t.transferToken.toString()).div(Math.pow(10,U.decimals)),transferAmountUsd:new m.Z(t.transferAmountUsd.toString()).div(1e6).toDP(2),closeFee:new m.Z(t.closeBaseFeeUsd.toString()).div(1e6),impactFee:m.Z.max(0,new m.Z(t.impactFeeUsd.toString()).div(1e6)),impactPct:new m.Z(t.impactFeeBps.toString()).div(100),impactFeeUsdText:l,borrowFee:new m.Z(t.fundingFeeUsd.toString()).div(1e6)});case 16:case"end":return e.stop()}}),e)}))),{enabled:Boolean(h&&U),retry:3,retryDelay:500,refetchInterval:5e3}),me=fe.data,he=fe.isLoading,ve=fe.isLoadingError,ge=(0,i.useMemo)((function(){return!!me&&(!de&&!V&&new m.Z(me.leverage).lt(1))}),[me,de,V]),be=(0,i.useMemo)((function(){var e=[];return ae&&e.push(c.ag._("Max close amount exceeded")),ge&&e.push(c.ag._("Minimum 1x leverage")),e}),[ae,ge]),we=(0,i.useState)(U||null),je=we[0],Ne=we[1],Pe=(0,i.useState)(null),ke=Pe[0],Se=Pe[1];(0,i.useEffect)((function(){!je&&U&&me&&Se(me.transferToken)}),[U,me,null===me||void 0===me?void 0:me.transferAmountUsd,null===me||void 0===me?void 0:me.transferToken,je]);var Oe=(0,i.useState)(!1),_e=Oe[0],Ce=Oe[1],Te=i.useCallback((function(e){Ce(!1),Ne(e)}),[]),Ze=(0,i.useMemo)((function(){return Array.from(A.keys())}),[A]),De=(0,i.useMemo)((function(){return{isTokenSwapRequired:(null===U||void 0===U?void 0:U.address)!==(null===je||void 0===je?void 0:je.address),amount:ke&&je&&U&&me?Nt().BigInt(me.transferToken.mul(Math.pow(10,U.decimals)).toFixed()):Nt().BigInt(0),fromTokenInfo:U}}),[U,me,ke,je]),Ae=(0,Ot.Z)({disabled:!De.isTokenSwapRequired,amount:De.amount,fromTokenInfo:De.fromTokenInfo,toTokenInfo:je,slippage:v}),Ie=Ae.outAmount,Re=Ae.otherAmountThreshold,Fe=Ae.isLoading,qe=(0,i.useMemo)((function(){return ae||X.isSubmitting||ge||De.isTokenSwapRequired&&Fe||!(0,p.Hd)(oe)||Number(oe)<=0}),[ae,X.isSubmitting,ge,De.isTokenSwapRequired,Fe,oe]),Ue=(0,i.useMemo)((function(){return g&&U?[g[q.address],g[U.address]]:[null,null]}),[g,U,q.address]),Ke=Ue[0],Ve=Ue[1],Be=(0,i.useCallback)(function(){var e=(0,o.Z)(a().mark((function e(t){var n,i,s,r,l,c,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!qe&&I){e.next=2;break}return e.abrupt("return");case 2:return S(!0),n=ce&&xe?new(jt())(xe.round().toFixed()):new(jt())(0),i=ce&&pe?new(jt())(pe.round().toFixed()):new(jt())(u.sizeUsd.round().toFixed()),s="long"===u.side?new(jt())(0):new(jt())("18446744073709551615"),e.prev=6,r={position:u,priceSlippage:s,collateralUsdDelta:n,sizeUsdDelta:i,desiredMint:De.isTokenSwapRequired&&je?new re.PublicKey(je.address):u.collateralCustody.account.mint,jupiterMinimumOut:De.isTokenSwapRequired&&Re?new(jt())(Re.toString()):null},e.next=10,ye(Zt({wallet:I,connection:M},r));case 10:return l=e.sent,c=l.instructions,d=l.positionRequestKey,e.next=15,new Promise(function(){var e=(0,o.Z)(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(c,d,(function(e){D(),b(),t(e)}),(function(e){n(e)}),function(){var e=r.position,t=(0,J.Z)(r,Ct);return Zt({wallet:I.adapter.name,position:e.publicKey.toString()},(0,Le.w_)(t))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 15:return e.abrupt("return",e.sent);case 18:e.prev=18,e.t0=e.catch(6),console.log("Failed to close position!",e.t0);case 21:return e.prev=21,S(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[6,18,21,24]])})));return function(t){return e.apply(this,arguments)}}(),[xe,M,D,qe,ce,Re,u,R,je,b,S,pe,De.isTokenSwapRequired,I]),ze=(0,i.useMemo)((function(){if(je&&me)return De.isTokenSwapRequired?Ie?new m.Z(Ie.toString()||0).div(Math.pow(10,je.decimals)).toString():void 0:me.transferToken.toString()}),[me,Ie,je,De.isTokenSwapRequired]);return(0,k.jsx)(Me.Z,{open:Z,onClose:D,children:(0,k.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,k.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:c.ag._("Close Position")}),(0,k.jsx)("button",{type:"button",disabled:P,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:D,children:(0,k.jsx)(se.Z,{width:12,height:12})}),_e?(0,k.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,k.jsx)(St.ZP,{onSubmit:Te,onClose:function(){return Ce(!1)},mintsList:Ze,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,k.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,k.jsxs)("div",{className:"px-4 lg:px-6",children:[(0,k.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-4 lg:p-5",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between text-sm font-semibold",children:[(0,k.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,k.jsx)(W.Z,{info:q,width:24,height:24}),(0,k.jsx)(F.cC,{id:"<0>{0} Price:</0>",values:{0:q.symbol},components:{0:(0,k.jsx)("span",{})}})]}),(0,k.jsxs)("span",{className:"text-sm font-semibold",children:[null===Ke||void 0===Ke?void 0:Ke.toFixed(2).toString()," USD"]})]}),(0,k.jsx)("div",{className:"border-b border-v2-lily/5 my-3 lg:my-4"}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Current Position Size")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",u.sizeUsd.div(1e6).toFixed(2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Entry Price")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",u.price.div(1e6).toFixed(2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Liquidation Price")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",null===(t=u.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Current Leverage")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:[u.leverage.toFixed(2),"x"]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Current P&L")}),(0,k.jsx)(Ee,{changePct:null===(n=u.accounting)||void 0===n?void 0:n.unrealizedPNLPct,pnl:null===(s=u.accounting)||void 0===s?void 0:s.unrealizedPNL})]})]})]}),(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Close size:")}),ce?(0,k.jsxs)("div",{className:"flex space-x-1",children:[(0,k.jsx)("button",{type:"button",onClick:function(){return le(25)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"25%"}),(0,k.jsx)("button",{type:"button",onClick:function(){return le(50)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"50%"}),(0,k.jsx)("button",{type:"button",onClick:function(){return le(75)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"75%"}),(0,k.jsx)("button",{type:"button",onClick:function(){return le(100)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"100%"})]}):(0,k.jsx)("div",{className:"text-v2-lily text-xs font-semibold",children:c.ag._("Only full close possible")})]})}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"amount",control:H,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsx)(te.Z,{disabled:new m.Z(B).lte(0)&&!ce,decimals:6,onChange:function(e){var t=e.value;e.floatValue&&new m.Z(t).greaterThan(B)?n(B):n(t)},value:ce?i:B,className:(0,y.cn)("!outline-none !text-right !text-sm w-full",ce?"":"cursor-not-allowed"),placeholder:"0.00",suffix:" USD"})}})}),be.length>0?be.map((function(e,t){return(0,k.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Receive in:")})}),(0,k.jsxs)("div",{className:"mt-2 rounded-lg bg-v2-perps-input p-4 text-md text-right flex h-18",children:[(0,k.jsxs)("div",{className:(0,y.cn)("  px-2 py-1.5 rounded-lg  flex items-center"),children:[je?(0,k.jsx)(W.Z,{info:je,width:28,height:28}):null,(0,k.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===je||void 0===je?void 0:je.symbol})]}),(0,p.Hd)(oe)&&0!==Number(oe)?(0,k.jsxs)("div",{className:"flex flex-col w-full relative",children:[je?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(te.Z,{className:"!text-base disabled:cursor-not-allowed !outline-none !text-right",disabled:!0,decimals:je.decimals,value:ze||void 0,suffix:" "+je.symbol}),(0,k.jsx)("div",{className:(0,y.cn)("!text-xs text-black-35 dark:text-white-35 relative"),children:(0,k.jsx)(Pt.default,{tokenInfo:je,amount:Number(ze)})})]}):null,he||ve?(0,k.jsx)(j.O,{className:"absolute right-0 top-0 !h-full"}):null]}):(0,k.jsx)("div",{className:"w-full flex items-center justify-end text-xs text-white/50 cursor-not-allowed",children:c.ag._("Please enter close size")})]}),ve?(0,k.jsx)(kt.Z,{iconSize:14,className:"!text-warning !p-2 mt-2 rounded-lg bg-warning/10",message:(0,k.jsx)(F.cC,{id:"<0>Failed to simulate output amount, you can still attempt to close your position.</0>",components:{0:(0,k.jsx)("p",{})}})}):null,(0,k.jsxs)("div",{className:"mt-5 space-y-2",children:[(0,k.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,k.jsx)("span",{children:c.ag._("Size")}),(0,k.jsx)("div",{children:null!==me&&void 0!==me&&me.size?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("span",{children:["$",u.sizeUsd.div(1e6).toFixed(2)]}),(0,k.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",me.size.div(1e6).toFixed(2)]})]}):(0,k.jsxs)("span",{children:["$",u.sizeUsd.div(1e6).toFixed(2)]})})]}),(0,k.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,k.jsx)("span",{children:c.ag._("Collateral")}),(0,k.jsx)("div",{children:null!==me&&void 0!==me&&me.collateralUsd?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("span",{children:["$",null===(r=u.accounting)||void 0===r?void 0:r.initialCollateral.div(1e6).toFixed(2)]}),(0,k.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",me.collateralUsd.toFixed(2)]})]}):(0,k.jsxs)("span",{children:["$",null===(l=u.accounting)||void 0===l?void 0:l.initialCollateral.div(1e6).toFixed(2)]})})]}),V?null:(0,k.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,k.jsx)("span",{children:c.ag._("Leverage")}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:[u.leverage.toFixed(2),"x"]}),(0,k.jsx)("span",{className:"px-1 text-white",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white",children:[null===me||void 0===me?void 0:me.leverage.toFixed(2),"x"]})]})]}),(0,k.jsxs)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:[(0,k.jsx)("span",{children:c.ag._("Close Base Fees")}),(0,k.jsxs)("span",{className:"flex items-center",children:["$",(0,k.jsx)(z.ZP,{value:(null===me||void 0===me?void 0:me.closeFee.toNumber())||0})]})]}),(0,k.jsx)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:(0,k.jsx)(_t.hb,{impactPct:(null===me||void 0===me?void 0:me.impactPct)||null,impactFeeUsdText:(null===me||void 0===me?void 0:me.impactFeeUsdText)||"",orderInfoLoading:he})}),(0,k.jsxs)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:[(0,k.jsx)("span",{children:c.ag._("Borrow Fees")}),(0,k.jsxs)("span",{className:"flex items-center",children:["$",(0,k.jsx)(z.ZP,{value:(null===me||void 0===me?void 0:me.borrowFee.toNumber())||0})]})]})]})]}),(0,k.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[X.isSubmitting?null:(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":X.isSubmitting}),disabled:X.isSubmitting,onClick:D,children:(0,k.jsx)("span",{children:c.ag._("Cancel")})}),(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":X.isSubmitting||qe}),disabled:qe,onClick:G(Be),children:X.isSubmitting?(0,k.jsxs)("span",{className:"flex justify-center items-center",children:[(0,k.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,k.jsx)("div",{className:"mr-2"}),c.ag._("Closing position")]}):(0,k.jsx)("span",{className:"text-center",children:c.ag._("Confirm")})})]})]})]})})},Mt=function(){var e=(0,_.tc)().userPositions,t=(0,C.y)().closePositionDialogData,n=(0,i.useMemo)((function(){return t&&(null===e||void 0===e?void 0:e.find((function(e){return e.publicKey.equals(t.positionAccountPubkey)})))}),[t,e]);return n?(0,k.jsx)(Et,{positionAccount:n}):null},Lt=n(94223),At=n(38756),It=n(13020),Rt=n(56720),Ft=n(69667),qt=n(50269),Ut=["collateralCustody","positionCustody"];function Kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bt=function(e){var t,n,s=e.positionAccount,r=e.onClose,l=(0,d.y6)().tokenPriceMap,u=(0,_.tc)(),x=u.viewClient,f=u.oraclePrices,h=u.setIsAnyFormSubmitting,v=(0,ie.Z)().promptKeeperIncreaseCollateralNotification,g=s.collateralCustody,b=s.custody,w=s.side,j=s.sizeUsd,P=s.accounting,S=s.leverage,O=(0,d.Bn)(),C=O.connection,T=O.getTokenInfo,Z=(O.tokenMap,(0,d.Os)().wallet),D=(0,ee.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}}),E=D.control,M=D.handleSubmit,L=D.watch,A=D.setValue,I=D.formState,R=L("amount"),F=(0,i.useMemo)((function(){return T(g.account.mint.toString())}),[T,g.account.mint]),q=(0,i.useMemo)((function(){if(!f||!F)return[null,null];var e=f[b.account.mint.toString()],t=f[F.address];return e&&t?[e,t]:[null,null]}),[f,F,b.account.mint]),U=q[0],K=q[1],V=(0,i.useState)(F||null),z=V[0],$=V[1],H=(0,i.useState)(!1),G=H[0],Q=H[1],Y=i.useCallback((function(e){Q(!1),$(e),A("amount",{formattedValue:"",value:"",floatValue:0})}),[A]),X=(0,d.FB)((null===z||void 0===z?void 0:z.address)||"").balance,se=(0,It.Z)({fromPairTokenInfo:z,toPairTokenInfo:F,fromPairValue:R.value}),le=se.isLoading,ae=se.isTokenSwapRequired,ce=se.outAmount,ue=se.otherAmountThreshold,de=(se.quoteResponseMeta,(0,i.useMemo)((function(){var e,t,n=null===(e=l[(null===z||void 0===z?void 0:z.address)||""])||void 0===e?void 0:e.usd,i=null===(t=l[(null===F||void 0===F?void 0:F.address)||""])||void 0===t?void 0:t.usd;return n&&i?{inTokenPrice:n,outTokenPrice:i,selectedTokenRate:i/n}:{inTokenPrice:null,outTokenPrice:null,selectedTokenRate:null}}),[z,F,l])),xe=de.inTokenPrice,fe=(de.outTokenPrice,de.selectedTokenRate),me=(0,i.useMemo)((function(){if(!P||!U||!K||!z)return new m.Z(0);if(ae){if(!fe)return new m.Z(0);var e=P.fundingFeeUsd.div(1e6).gte(50)?1.01:1.005;return P.fundingFeeUsd.div(1e6).mul(e).div(xe).toDP(z.decimals)}return P.fundingFeeUsd.div(1e6).div(K).toDP(z.decimals)}),[P,K,xe,ae,z,fe,U]),he=(0,i.useMemo)((function(){return U&&K&&P&&F?j.div(_.aY).sub(P.initialCollateral).add(P.fundingFeeUsd).div(K).toDP(F.decimals):new m.Z(0)}),[P,F,K,j,U]),ve=(0,i.useMemo)((function(){if(!U||!K||!P||!F||!z)return new m.Z(0);var e=ae&&fe,t=e?he.div(1e6).mul(fe):he.div(1e6);return e?t.mul(.999).toDP(z.decimals):t.toDP(F.decimals)}),[U,K,P,F,z,ae,fe,he]),ge=(0,i.useCallback)((function(){A("amount",{formattedValue:me.toFixed(),value:me.toFixed(),floatValue:me.toNumber()})}),[me,A]),be=(0,i.useCallback)((function(){A("amount",{formattedValue:ve.toFixed(),value:ve.toFixed(),floatValue:ve.toNumber()})}),[ve,A]),we=(0,i.useMemo)((function(){if(null===Z||void 0===Z||!Z.adapter.connected)return!1;if((null===z||void 0===z?void 0:z.address)!==pe.W4.toBase58())return!1;var e=new m.Z(X).minus(Rt.WO);return new m.Z(R.floatValue||0).gt(e)}),[X,R.floatValue,null===z||void 0===z?void 0:z.address,null===Z||void 0===Z?void 0:Z.adapter.connected]),je=(0,i.useMemo)((function(){return new m.Z(me).gt(X)}),[X,me]),ye=(0,i.useMemo)((function(){return!!R.floatValue&&new m.Z(R.floatValue).gt(X)}),[R,X]),Ne=(0,i.useMemo)((function(){if(R.floatValue){if(ae&&fe){var e=he.div(1e6).mul(fe);return new m.Z(R.floatValue).gt(e)}return R.floatValue&&he?new m.Z(R.floatValue).gt(he.div(1e6)):void 0}}),[R.floatValue,ae,he,fe]),Pe=(0,i.useMemo)((function(){if(R.floatValue&&ve)return new m.Z(R.floatValue).gt(ve)}),[R,ve]),ke=(0,i.useMemo)((function(){return S.lte(_.aY)}),[S]),Se=(0,i.useMemo)((function(){if(R.floatValue&&me)return new m.Z(R.floatValue).lt(me.mul(.999))}),[me,R.floatValue]),Oe=(0,i.useMemo)((function(){var e=[];return je?(e.push(c.ag._("Minimum deposit required is greater than your balance.")),e):(ye&&e.push(c.ag._("Insufficient balance.")),Ne&&e.push(c.ag._("Minimum leverage of {MINIMUM_LEVERAGE}x is required",{MINIMUM_LEVERAGE:_.aY})),Pe&&e.push(c.ag._("Over allowed amount of {allowedMaxAmount} {0}",{0:null===z||void 0===z?void 0:z.symbol,allowedMaxAmount:ve})),Se&&e.push(c.ag._("Minimum deposit of {0} {1} is required.",{0:N.uf.format(me),1:null===z||void 0===z?void 0:z.symbol})),we&&e.push(c.ag._("We recommend having at least {MINIMUM_SOL_BALANCE} SOL for any transaction",{MINIMUM_SOL_BALANCE:Rt.WO})),e)}),[ve,ye,Se,Ne,me,je,Pe,we,null===z||void 0===z?void 0:z.symbol]),_e=(0,i.useMemo)((function(){return je||ye||I.isSubmitting||Pe||ve.lte(0)||Oe.length>0||ke||Se}),[je,ye,I.isSubmitting,Pe,ve,Oe.length,ke,Se]),Ce=(0,i.useState)(null),Te=Ce[0],Ze=Ce[1];(0,i.useEffect)((function(){!z&&F&&$(F)}),[F,z]),(0,i.useEffect)((function(){(0,o.Z)(a().mark((function e(){var t,n,i,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P&&R.floatValue&&F&&x&&!(Oe.length>0)&&U){e.next=3;break}return Ze(null),e.abrupt("return");case 3:if(!ae||!le){e.next=5;break}return e.abrupt("return");case 5:if(!new m.Z(R.floatValue).gt(ve)){e.next=7;break}return e.abrupt("return");case 7:return n=z&&ue?new(jt())(ue.toString()):new(jt())((0,p.ks)(R.floatValue,F.decimals)),e.next=10,x.getIncreasePosition({collateral:n,sizeUsdDelta:new(jt())(0),side:w,custody:b,positionAccount:s,collateralCustody:g,collateralTokenPrice:K.toNumber(),pool:s.pool,tokenPrice:U.toNumber()});case 10:if(t=e.sent){e.next=13;break}return e.abrupt("return");case 13:i=new m.Z(t.liquidationPrice.toString()),r=new m.Z(t.collateralUsd.toString()),o=function(){var e=new m.Z(t.collateralUsd.toString()).minus(P.initialCollateral.toString()).div(1e6);return new m.Z(P.positionValue.toString()).add(e)}(),Ze({liquidationPrice:new m.Z(i.toString()).div(1e6),collateralUsd:r.div(1e6),leverage:new m.Z(j).div(r).toNearest(.01,m.Z.ROUND_DOWN),transferToken:new m.Z(0),transferAmountUsd:new m.Z(0),fundingFeeUsd:m.Z.max(0,new m.Z(P.fundingFeeUsd).minus(new m.Z(n.toString()).div(Math.pow(10,F.decimals)).mul(1e6).mul(U))),positionValue:o});case 17:case"end":return e.stop()}}),e)})))()}),[R,x,F,ve,Oe,z,ue,ae,ce,le,s,g.account,b.account,P,w,j,b,g,U,K]);var De=(0,i.useCallback)((0,o.Z)(a().mark((function e(){var t,n,i,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z&&F&&z&&R.floatValue){e.next=2;break}return e.abrupt("return");case 2:return h(!0),t={side:w,collateralCustody:g,positionCustody:b,inputMint:new re.PublicKey(z.address),priceSlippage:new(jt())(0),collateralTokenDelta:new(jt())((0,p.ks)(Number(R.floatValue),z.decimals)),sizeUsdDelta:new(jt())(0),jupiterMinimumOut:ae&&ue?new(jt())(ue.toString()):null},e.prev=4,e.next=7,(0,At.w)(Vt({wallet:Z,connection:C},t));case 7:return n=e.sent,i=n.instructions,l=n.positionRequestKey,e.next=12,new Promise(function(){var e=(0,o.Z)(a().mark((function e(n,o){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(i,l,(function(e){r(),n(e)}),(function(e){o(e)}),function(){var e=t.collateralCustody,n=t.positionCustody,i=(0,J.Z)(t,Ut);return Vt({wallet:Z.adapter.name,position:s.publicKey.toString(),collateralCustody:e.publicKey.toString(),positionCustody:n.publicKey.toString()},(0,Le.w_)(i))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t0=e.catch(4),console.log("Failed to adjust collateral!",e.t0);case 18:return e.prev=18,h(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[4,15,18,21]])}))),[g,F,C,b,R.floatValue,ae,r,ue,s.publicKey,v,z,h,w,Z]),Me=(0,d.gZ)().userAccounts,Ae=(0,i.useMemo)((function(){return[pe.W4.toString()].concat((0,oe.Z)(Array.from(Me.reduce((function(e,t){return t.info.amount.gtn(0)?e.add(t.info.mint.toString()):e}),new Set))))}),[Me]);return(0,k.jsxs)(k.Fragment,{children:[G?(0,k.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,k.jsx)(St.ZP,{onSubmit:Y,onClose:function(){return Q(!1)},mintsList:Ae,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,k.jsxs)("div",{className:"px-6 mt-5",children:[(0,k.jsxs)("div",{className:"w-full flex justify-between text-xs",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Position Value")}),(0,k.jsx)(Ee,{changePct:null===(t=s.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=s.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,k.jsx)("div",{className:"rounded-lg bg-v2-perps-input px-4 py-3.5 text-md font-semibold text-right mt-2 cursor-not-allowed opacity-70",children:(0,k.jsxs)("div",{children:[N.uf.format(null===P||void 0===P?void 0:P.positionValue.div(1e6),2)," USD"]})}),(0,k.jsxs)("div",{className:"mt-5",children:[(0,k.jsx)("div",{className:"flex items-end leading-none",children:(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Deposit Collateral")})}),(0,k.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:ge,children:me.lte(0)?"":c.ag._("Min: {0} {1}",{0:N.uf.format(me),1:null===z||void 0===z?void 0:z.symbol})}),(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:be,children:c.ag._("Max: {0} {1}",{0:N.uf.format(ve),1:null===z||void 0===z?void 0:z.symbol})})]}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"amount",control:E,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsxs)("div",{className:"flex items-center justify-between text-md w-full",children:[(0,k.jsxs)("div",{className:(0,y.cn)("bg-white/10 px-2 py-1.5 rounded-lg flex items-center","hover:bg-black/10 cursor-pointer"),onClick:function(){return Q(!0)},children:[z?(0,k.jsx)(W.Z,{info:z,width:28,height:28}):null,(0,k.jsx)("span",{className:"ml-3",children:null===z||void 0===z?void 0:z.symbol}),(0,k.jsx)("div",{className:"ml-4 text-white/50 fill-current",children:(0,k.jsx)(Ft.Z,{})})]}),(0,k.jsx)("div",{className:"flex flex-col",children:z?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(te.Z,{decimals:z.decimals,onChange:n,value:i.value,className:"!text-xl disabled:cursor-not-allowed !outline-none",placeholder:"0.00"}),(0,k.jsx)("div",{className:(0,y.cn)("text-xs text-v2-lily/[.25] font-normal"),children:(0,k.jsx)(Pt.default,{tokenInfo:z,amount:i.floatValue})})]}):null})]})}})})]}),ke?(0,k.jsx)("span",{className:"my-2 text-v2-lily/50 text-xs",children:c.ag._("You're already at a minimum leverage of 1.10x, and cannot deposit more collateral.")}):(0,k.jsxs)("div",{className:"mt-2 flex whitespace-nowrap text-v2-lily/[.25] leading-none text-xs items-end",children:[(0,k.jsx)(Lt.Z,{width:14,height:14}),(0,k.jsxs)("span",{className:"ml-1",children:[N.uf.format(new m.Z(X))," ",null===z||void 0===z?void 0:z.symbol]})]}),Oe.length>0?Oe.map((function(e,t){return(0,k.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,k.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,k.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,k.jsx)("span",{children:c.ag._("Leverage")}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:[S.toFixed(2),"x"]}),(0,k.jsx)("span",{children:Te?(0,k.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),Te.leverage.toFixed(2),"x"]}):""})]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,k.jsx)("span",{children:c.ag._("Liq. price")}),Te?(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.liquidationPrice.div(1e6),2)]}),Te.liquidationPrice?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(Te.liquidationPrice,2)]})]}):null]}):(0,k.jsxs)("div",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.liquidationPrice.div(1e6),2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,k.jsx)("span",{children:c.ag._("Collateral")}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.initialCollateral.div(1e6),2)]}),Te?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(Te.collateralUsd,2)]})]}):null]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50 fill-current",children:[(0,k.jsx)(B.Z,{content:c.ag._("Borrow fees due are settled when depositing or withdrawing collateral."),children:(0,k.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,k.jsx)("span",{children:c.ag._("Borrow fees due")}),(0,k.jsx)(qt.Z,{width:14,height:14})]})}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.fundingFeeUsd.div(1e6),2)]}),Te?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(Te.fundingFeeUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,k.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[I.isSubmitting?null:(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":I.isSubmitting}),disabled:I.isSubmitting,onClick:r,children:(0,k.jsx)("span",{children:c.ag._("Cancel")})}),(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":I.isSubmitting||_e}),disabled:_e,onClick:M(De),children:I.isSubmitting?(0,k.jsxs)("span",{className:"flex justify-center items-center",children:[(0,k.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,k.jsx)("div",{className:"mr-2"}),c.ag._("Adding collateral")]}):(0,k.jsx)("span",{children:c.ag._("Deposit")})})]})]})},zt=n(70006),$t=["position"];function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Gt=function(e){var t,n,s,r,l,u,x=e.positionAccount,p=e.onClose,f=(0,_.tc)(),h=f.viewClient,v=f.oraclePrices,g=f.slippage,b=f.poolInfo,w=f.refreshPositionInfo,j=f.setIsAnyFormSubmitting,P=(0,ie.Z)().promptKeeperPartialClosePositionNotification,S=(0,d.Bn)(),O=S.connection,C=S.getTokenInfo,T=S.tokens,Z=(0,d.Os)().wallet,D=(0,zt.JT)().closeModal,E=x.custody,M=x.collateralCustody,L=(x.side,(0,ee.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}})),A=L.control,I=L.handleSubmit,R=L.watch,F=L.setValue,q=L.formState,U=R("amount"),K=(0,i.useMemo)((function(){return C(M.account.mint.toString())}),[C,M.account.mint]),V=(0,i.useMemo)((function(){return v&&K?[v[E.account.mint.toString()],v[K.address]]:[null,null]}),[v,E.account.mint,K]),B=V[0],z=V[1],$=(0,i.useState)(K||null),H=$[0],G=$[1],Q=(0,i.useState)(!1),Y=Q[0],X=Q[1],se=i.useCallback((function(e){X(!1),G(e)}),[]),oe=(0,d.FB)((null===H||void 0===H?void 0:H.address)||"").balance,le=(0,i.useMemo)((function(){return B&&z&&x.accounting?function(){var e=m.Z.max(new m.Z(x.sizeUsd).div(_.jG),_.IH);if("long"===x.side){var t=new m.Z(x.accounting.initialCollateral).sub(e);return x.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(x.accounting.pnlAfterFeesUsd)),new m.Z(t)}var n=new m.Z(x.accounting.initialCollateral).sub(e);return x.accounting.pnlAfterFeesUsd.lt(0)&&(n=n.add(x.accounting.pnlAfterFeesUsd)),new m.Z(n)}().div(1e6).toDP(4,m.Z.ROUND_DOWN):new m.Z(0)}),[B,z,x.accounting,x.sizeUsd,x.side]),ae=(0,i.useCallback)((function(){F("amount",{formattedValue:le.toString(),value:le.toString(),floatValue:le.toNumber()})}),[le,F]),ce=(0,i.useMemo)((function(){if(U.floatValue&&le)return new m.Z(U.floatValue).gt(le)}),[U,le]),ue=(0,i.useMemo)((function(){if(!U.floatValue||!x.accounting)return!1;var e=new m.Z(x.accounting.fundingFeeUsd.toString()).div(1e6),t=new m.Z(x.accounting.initialCollateral).sub(U.floatValue).sub(e);return x.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(x.accounting.pnlAfterFeesUsd)),t.lt(_.IH)}),[U.floatValue,x.accounting]),de=(0,i.useMemo)((function(){var e=[];return le.lt(0)&&e.push(c.ag._("No more collateral can be withdrawn")),ue&&e.push(c.ag._("Minimum collateral of {MINIMUM_COLLATERAL_SIZE_USD} USD is required",{MINIMUM_COLLATERAL_SIZE_USD:_.IH})),ce&&e.push(c.ag._("Withdrawal amount too close to liquidation price")),e}),[ce,ue,le]),xe=(0,i.useMemo)((function(){return q.isSubmitting||ce||le.lte(0)||de.length>0}),[q.isSubmitting,ce,le,de]),pe=(0,i.useState)(null),fe=pe[0],me=pe[1];(0,i.useEffect)((function(){!H&&K&&G(K)}),[K,fe,null===fe||void 0===fe?void 0:fe.transferAmountUsd,null===fe||void 0===fe?void 0:fe.transferToken,H]);var he=(0,i.useMemo)((function(){return{isTokenSwapRequired:(null===K||void 0===K?void 0:K.address)!==(null===H||void 0===H?void 0:H.address),amount:H&&K&&fe?Nt().BigInt(fe.transferToken.mul(Math.pow(10,K.decimals)).toFixed()):Nt().BigInt(0),fromTokenInfo:K}}),[K,fe,H]),ve=(0,Ot.Z)({disabled:!he.isTokenSwapRequired,amount:he.amount,fromTokenInfo:he.fromTokenInfo,toTokenInfo:H,slippage:g}),ge=ve.outAmount,be=ve.otherAmountThreshold,we=(0,i.useMemo)((function(){if(H&&fe)return he.isTokenSwapRequired&&ge?{floatValue:new m.Z(ge.toString()||0).div(Math.pow(10,H.decimals)).toNumber(),formattedValue:new m.Z(ge.toString()||0).div(Math.pow(10,H.decimals)).toFixed(),value:new m.Z(ge.toString()||0).div(Math.pow(10,H.decimals)).toFixed()}:{floatValue:fe.transferToken.toNumber(),formattedValue:fe.transferToken.toFixed(),value:fe.transferToken.toFixed()}}),[fe,ge,H,he.isTokenSwapRequired]);(0,i.useEffect)((function(){(0,o.Z)(a().mark((function e(){var t,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U.floatValue&&K&&h&&x.accounting&&!(de.length>0)&&B&&z&&null!==b&&void 0!==b&&b.pool){e.next=3;break}return me(null),e.abrupt("return");case 3:if(!new m.Z(U.floatValue).gt(le)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,h.getDecreasePosition({position:x,collateralUsdDelta:new(jt())(new m.Z(U.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(jt())(0),tokenPrice:null===B||void 0===B?void 0:B.toNumber(),collateralTokenPrice:null===z||void 0===z?void 0:z.toNumber(),pool:b.pool});case 7:if(t=e.sent){e.next=10;break}return e.abrupt("return");case 10:n=new m.Z(t.liquidationPrice.toString()),i=new m.Z(t.collateralUsd.toString()),s=function(){var e,n=new m.Z(t.collateralUsd.toString()).minus(null===(e=x.accounting)||void 0===e?void 0:e.initialCollateral).div(1e6);return new m.Z(x.accounting.positionValue.toString()).add(n)}(),me({liquidationPrice:n,collateralUsd:i,fees:new m.Z(t.feeUsd.toString()),leverage:new m.Z(x.sizeUsd.toString()).div(i).toNearest(.01,m.Z.ROUND_DOWN),transferToken:new m.Z(t.transferToken.toString()).div(Math.pow(10,K.decimals)),transferAmountUsd:new m.Z(t.transferAmountUsd.toString()),positionValue:s});case 14:case"end":return e.stop()}}),e)})))()}),[U,x,h,K,le,de,B,z,null===b||void 0===b?void 0:b.pool]);var je=(0,i.useCallback)(function(){var e=(0,o.Z)(a().mark((function e(t){var n,i,s,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h&&Z&&Z.adapter.publicKey&&h&&K&&U.floatValue){e.next=2;break}return e.abrupt("return");case 2:return j(!0),n={position:x,collateralUsdDelta:new(jt())(new m.Z(U.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(jt())(0),desiredMint:he.isTokenSwapRequired&&H?new re.PublicKey(H.address):x.collateralCustody.account.mint,priceSlippage:new(jt())(0),jupiterMinimumOut:he.isTokenSwapRequired&&be?new(jt())(be.toString()):null},e.prev=4,e.next=7,ye(Wt({wallet:Z,connection:O},n));case 7:return i=e.sent,s=i.instructions,r=i.positionRequestKey,D(),e.next=13,new Promise(function(){var e=(0,o.Z)(a().mark((function e(t,i){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(s,r,(function(e){p(),t(e),w()}),(function(e){i(e)}),function(){n.position;var e=(0,J.Z)(n,$t);return Wt({wallet:Z.adapter.name,position:x.publicKey.toString()},(0,Le.w_)(e))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 13:return e.abrupt("return",e.sent);case 16:e.prev=16,e.t0=e.catch(4),console.log("Failed to adjust collateral!",e.t0);case 19:return e.prev=19,j(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[4,16,19,22]])})));return function(t){return e.apply(this,arguments)}}(),[D,K,O,U.floatValue,p,be,x,P,H,w,j,he.isTokenSwapRequired,h,Z]),Ne=(0,i.useMemo)((function(){return Array.from(T.map((function(e){return e.address})))}),[T]);return(0,k.jsxs)(k.Fragment,{children:[Y?(0,k.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,k.jsx)(St.ZP,{onSubmit:se,onClose:function(){return X(!1)},mintsList:Ne,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,k.jsxs)("div",{className:"px-6 mt-5",children:[(0,k.jsxs)("div",{className:"w-full flex justify-between text-xs",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Position Value")}),(0,k.jsx)(Ee,{changePct:null===(t=x.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=x.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,k.jsx)("div",{className:"rounded-lg bg-v2-perps-input px-4 py-3.5 text-md font-semibold text-right mt-2 cursor-not-allowed opacity-70",children:(0,k.jsxs)("div",{children:[null===(s=x.accounting)||void 0===s?void 0:s.positionValue.div(1e6).toFixed(2)," USD"]})}),(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Withdraw collateral in:")}),(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:ae,children:le.lte(0)?"":c.ag._("Max: {allowedMaxAmount} USD",{allowedMaxAmount:le})})]})}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"amount",control:A,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsxs)("div",{className:"flex items-center justify-between text-md w-full",children:[(0,k.jsxs)("div",{className:"pl-2 py-1.5 rounded-lg flex items-center",children:[H?(0,k.jsx)(W.Z,{info:H,width:28,height:28}):null,(0,k.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===H||void 0===H?void 0:H.symbol})]}),(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsx)(te.Z,{disabled:le.lte(0),decimals:6,onChange:n,value:i.value,className:"!text-xl disabled:cursor-not-allowed !outline-none",placeholder:"0.00",suffix:" USD"}),H&&(0,k.jsx)(te.Z,{className:"!text-xs !text-v2-lily/[.25] !font-normal",disabled:!0,decimals:H.decimals,value:null===we||void 0===we?void 0:we.value,suffix:" "+H.symbol})]})]})}})}),(0,k.jsxs)("div",{className:"mt-2 flex whitespace-nowrap text-v2-lily/[.25] leading-none text-xs items-end",children:[(0,k.jsx)(Lt.Z,{width:14,height:14}),(0,k.jsxs)("span",{className:"ml-1",children:[oe," ",null===H||void 0===H?void 0:H.symbol]})]}),de.length>0?de.map((function(e,t){return(0,k.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,k.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,k.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,k.jsx)("span",{children:c.ag._("Leverage")}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:[x.leverage.toFixed(2),"x"]}),(0,k.jsx)("span",{children:fe?(0,k.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),fe.leverage.toFixed(2),"x"]}):""})]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,k.jsx)("span",{children:c.ag._("Liq. Price")}),fe?(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(null===(l=x.accounting)||void 0===l?void 0:l.liquidationPrice.div(1e6),2)]}),fe.liquidationPrice?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(fe.liquidationPrice.div(1e6),2)]})]}):null]}):(0,k.jsxs)("div",{children:["$",N.uf.format(null===(r=x.accounting)||void 0===r?void 0:r.liquidationPrice.div(1e6),2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,k.jsx)("span",{children:c.ag._("Collateral")}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{children:["$",N.uf.format(null===(u=x.accounting)||void 0===u?void 0:u.initialCollateral.div(1e6),2)]}),fe?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(fe.collateralUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,k.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[q.isSubmitting?null:(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":q.isSubmitting}),disabled:q.isSubmitting,onClick:p,children:(0,k.jsx)("span",{children:c.ag._("Cancel")})}),(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":q.isSubmitting||xe}),disabled:xe,onClick:I(je),children:q.isSubmitting?(0,k.jsxs)("span",{className:"flex justify-center items-center",children:[(0,k.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,k.jsx)("div",{className:"mr-2"}),c.ag._("Withdrawing collateral")]}):(0,k.jsx)("span",{children:c.ag._("Withdraw")})})]})]})},Qt=function(e){var t=e.positionAccount,n=(0,d.Bn)().getTokenInfo,s=(0,C.y)(),r=s.isEditCollateralDialogOpen,o=s.dismissEditCollateralDialog,l=(0,_.tc)(),a=l.oraclePrices,u=l.isAnyFormSubmitting,x=(0,i.useMemo)((function(){var e;return null!==(e=n(t.custody.account.mint.toString()))&&void 0!==e?e:O.mq}),[n,t.custody.account.mint]),p=(0,i.useState)("deposit"),f=p[0],m=p[1],h=(0,i.useMemo)((function(){return a&&a[x.address]}),[a,x.address]);return(0,k.jsx)(Me.Z,{open:r,onClose:o,children:(0,k.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,k.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:c.ag._("Edit Collateral")}),(0,k.jsx)("button",{type:"button",disabled:u,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:o,children:(0,k.jsx)(se.Z,{width:12,height:12})}),(0,k.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,k.jsx)("div",{className:"px-6",children:(0,k.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-5",children:[(0,k.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,k.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,k.jsx)(W.Z,{info:x,width:24,height:24}),(0,k.jsx)(F.cC,{id:"<0>{0} Price:</0>",values:{0:x.symbol},components:{0:(0,k.jsx)("span",{})}})]}),(0,k.jsxs)("span",{className:"text-sm font-semibold",children:[N.uf.format(h||void 0,2)," USD"]})]}),(0,k.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Current Position Size")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(t.sizeUsd.div(1e6),2)]})]})]})}),(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"flex flex-row items-center justify-between space-x-4 px-4 border-b-white/5 border-b h-[56px]",children:(0,k.jsxs)("div",{className:"flex flex-row w-full",children:[(0,k.jsx)("button",{type:"button",onClick:function(){return m("deposit")},className:(0,y.cn)("flex flex-row items-center justify-center px-3 pt-6 pb-4 font-semibold !outline-none","deposit"===f?"border-b border-b-labs text-labs":""),children:(0,k.jsx)("span",{className:"text-sm",children:c.ag._("Deposit")})}),(0,k.jsx)("button",{type:"button",onClick:function(){return m("withdraw")},className:(0,y.cn)("flex flex-row items-center justify-center px-3 pt-6 pb-4 font-semibold !outline-none","withdraw"===f?"border-b border-b-labs text-labs":""),children:(0,k.jsx)("span",{className:"text-sm",children:c.ag._("Withdraw")})})]})}),"deposit"===f?(0,k.jsx)(Bt,{positionAccount:t,onClose:o}):(0,k.jsx)(Gt,{positionAccount:t,onClose:o})]})]})]})})},Yt=function(){var e=(0,_.tc)().userPositions,t=(0,C.y)().editCollateralDialogData,n=(0,i.useMemo)((function(){return t&&(null===e||void 0===e?void 0:e.find((function(e){return e.publicKey.equals(t.positionAccountPubkey)})))}),[t,e]);return n?(0,k.jsx)(Qt,{positionAccount:n}):null},Xt=["wallet","connection","positionAccount","custody","updateTPPrice","updateSLPrice","cancelTP","cancelSL"];function Jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tn(e){var t,n,i;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(i=null===e||void 0===e?void 0:e.toString())&&void 0!==i?i:""}:{floatValue:void 0,formattedValue:"",value:""}}var nn=function(e){var t,n,s,r,l,u,x=e.positionAccount,p=(0,_.tc)(),f=p.viewClient,h=p.oraclePrices,v=p.setIsAnyFormSubmitting,g=p.isAnyFormSubmitting,b=(0,C.y)(),w=b.isEditTPSLDialogOpen,P=b.editTPSLDialogData,S=b.dismissEditTPSLDialog,T=(0,d.Bn)(),Z=T.connection,D=T.getTokenInfo,E=T.tokenMap,M=(0,d.Os)().wallet,L=(0,ie.Z)().promptKeeperCreateTPSLNotification,A=(0,i.useMemo)((function(){var e;return null!==(e=D(x.custody.account.mint.toString()))&&void 0!==e?e:O.mq}),[D,x.custody.account.mint]),I=(0,i.useMemo)((function(){return D(x.collateralCustody.account.mint.toString())}),[D,x.collateralCustody.account.mint]),R=Ze(x),q=R.hasTp,U=R.hasSl,K=(0,ee.cI)({defaultValues:{tpPrice:tn(q),slPrice:tn(U)}}),V=K.control,B=K.handleSubmit,z=K.watch,$=K.setValue,H=K.formState,G=z("tpPrice"),Q=z("slPrice"),Y=De({positionAccount:x,tpPrice:G,slPrice:Q}),X=Y.showTPChanged,oe=Y.showTPRemoved,le=Y.showSLChanged,ae=Y.showSLRemoved,ce=Y.minimumTPPrice,ue=Y.minimumSLPrice,de=Y.maximumSLPrice,xe=Y.isWithinTPRange,pe=Y.isWithinSLRange,fe=Y.expectedPositionValueAtSL,me=Y.expectedPositionValueAtTP,he=(0,i.useState)(null),ve=he[0],ge=he[1],be=(0,i.useMemo)((function(){var e=x.takeProfitPositionRequest||x.stopLossPositionRequest;if(e)return e}),[x.stopLossPositionRequest,x.takeProfitPositionRequest]);(0,i.useEffect)((function(){be&&ge(E.get(be.account.mint.toString())||null),!ve&&I&&ge(I)}),[I,be,ve,E]);var we=(0,i.useState)(!1),je=we[0],ye=we[1],Ne=i.useCallback((function(e){ye(!1),ge(e)}),[]),Pe=(0,i.useMemo)((function(){return Array.from(E.keys())}),[E]),ke=(0,i.useMemo)((function(){return h&&h[A.address]?h[A.address]:null}),[h,A.address]),Se=(0,i.useMemo)((function(){return!H.isDirty||(!(!G.floatValue||xe)||(!(!Q.floatValue||pe)||H.isSubmitting))}),[H.isDirty,H.isSubmitting,pe,xe,Q.floatValue,G.floatValue]),Oe=(0,i.useCallback)(function(){var e=(0,o.Z)(a().mark((function e(t){var n,i,s,r,l,u,d,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Se&&M&&M.adapter.publicKey&&A&&f&&ke&&ve){e.next=2;break}return e.abrupt("return");case 2:return v(!0),n=t.tpPrice.floatValue?new(jt())(new m.Z(t.tpPrice.floatValue).mul(1e6).round().toFixed()):null,i=t.slPrice.floatValue?new(jt())(new m.Z(t.slPrice.floatValue).mul(1e6).round().toFixed()):null,s=X&&x.takeProfitPositionRequest&&n?{triggerPrice:n,positionRequestAccount:x.takeProfitPositionRequest.publicKey}:null,r=le&&x.stopLossPositionRequest&&i?{triggerPrice:i,positionRequestAccount:x.stopLossPositionRequest.publicKey}:null,l=oe&&x.takeProfitPositionRequest?{positionPubkey:x.publicKey,positionRequestPubkey:x.takeProfitPositionRequest.publicKey,positionRequestMint:x.takeProfitPositionRequest.account.mint}:null,u=ae&&x.stopLossPositionRequest?{positionPubkey:x.publicKey,positionRequestPubkey:x.stopLossPositionRequest.publicKey,positionRequestMint:x.stopLossPositionRequest.account.mint}:null,d={wallet:M,connection:Z,positionAccount:x,custody:x.custody.account,desiredMint:new re.PublicKey(ve.address),tpPrice:q?null:n,slPrice:U?null:i,updateTPPrice:s,updateSLPrice:r,cancelTP:l,cancelSL:u},e.prev=10,e.next=13,_e(d);case 13:return p=e.sent,e.next=16,new Promise(function(){var e=(0,o.Z)(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L({doveInstructions:p},(function(e){S(),t(e)}),(function(e){n(e)}),c.ag._("Adjusting Take Profit & Stop Loss..."),function(){var e=d.wallet,t=(d.connection,d.positionAccount),n=(d.custody,d.updateTPPrice),i=d.updateSLPrice,s=(d.cancelTP,d.cancelSL,(0,J.Z)(d,Xt));return en({wallet:e.adapter.name,positionAccount:t.publicKey.toString(),updateTPPrice:(null===n||void 0===n?void 0:n.triggerPrice.toString())||"",updateTPPricePositionRequestAccount:(null===n||void 0===n?void 0:n.positionRequestAccount.toString())||"",updateSLPrice:(null===i||void 0===i?void 0:i.triggerPrice.toString())||"",updateSLPricePositionRequestAccount:(null===i||void 0===i?void 0:i.positionRequestAccount.toString())||""},(0,Le.w_)(s))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 16:return e.abrupt("return",e.sent);case 19:e.prev=19,e.t0=e.catch(10),console.log("Failed to submit TPSL!",e.t0);case 22:return e.prev=22,v(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[10,19,22,25]])})));return function(t){return e.apply(this,arguments)}}(),[Z,S,U,q,Se,ke,x,L,ve,v,le,ae,X,oe,A,f,M]),Ce=(0,i.useMemo)((function(){return[]}),[]),Te=(0,i.useCallback)((function(){ce&&$("tpPrice",{floatValue:ce.toNumber(),formattedValue:ce.toFixed(2),value:ce.toFixed(2)})}),[ce,$]),Ae=(0,i.useCallback)((function(){ue&&$("slPrice",{floatValue:ue.toNumber(),formattedValue:ue.toFixed(2),value:ue.toFixed(2)})}),[ue,$]),Ie=(0,i.useCallback)((function(){de&&$("slPrice",{floatValue:de.toNumber(),formattedValue:de.toFixed(2),value:de.toFixed(2)})}),[de,$]),Re=(0,i.useRef)(),Fe=(0,i.useRef)();return(0,i.useEffect)((function(){var e,t;"tp"===(null===P||void 0===P?void 0:P.focusOn)&&(null===(e=Re.current)||void 0===e||e.focus()),"sl"===(null===P||void 0===P?void 0:P.focusOn)&&(null===(t=Fe.current)||void 0===t||t.focus())}),[null===P||void 0===P?void 0:P.focusOn]),(0,k.jsx)(Me.Z,{open:w,onClose:S,children:(0,k.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,k.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:c.ag._("Take Profit & Stop Loss")}),(0,k.jsx)("button",{type:"button",disabled:g,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:S,children:(0,k.jsx)(se.Z,{width:12,height:12})}),je?(0,k.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,k.jsx)(St.ZP,{onSubmit:Ne,onClose:function(){return ye(!1)},mintsList:Pe,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,k.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,k.jsxs)("div",{className:"px-6",children:[(0,k.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-5",children:[(0,k.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,k.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,k.jsx)(W.Z,{info:A,width:24,height:24}),(0,k.jsx)("span",{children:(0,k.jsx)(F.cC,{id:"Current Price:"})})]}),ke?(0,k.jsxs)("span",{className:"text-sm font-semibold",children:[N.uf.format(ke,2)," USD"]}):(0,k.jsx)(j.O,{className:"w-20 h-6"})]}),(0,k.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Current Position Size")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(x.sizeUsd.div(1e6),2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Entry Price")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(x.price.div(1e6),2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Liquidation Price")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(null===(t=x.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6),2)]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Leverage")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:[N.uf.format(x.leverage,2),"x"]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Current P&L")}),x.accounting?(0,k.jsx)(Ee,{changePct:x.accounting.unrealizedPNLPct,pnl:x.accounting.unrealizedPNL}):null]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Total Fees")}),(0,k.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(null===(n=x.accounting)||void 0===n?void 0:n.totalFeeUsd.div(1e6))]})]}),(0,k.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,k.jsx)("span",{className:"text-white/40",children:c.ag._("Net P&L")}),(0,k.jsx)("span",{className:"text-white/[.75]",children:(0,k.jsx)(Ee,{changePct:null===(s=x.accounting)||void 0===s?void 0:s.pnlAfterFeesPct,pnl:null===(r=x.accounting)||void 0===r?void 0:r.pnlAfterFeesUsd})})]})]})]}),(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Take Profit Price:")}),me?(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,k.jsx)(Ee,{changePct:me.pnlRate,pnl:me.pnl})}):null]})}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"tpPrice",control:V,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsx)(te.Z,{ref:Re,decimals:2,max:O.wN,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,k.jsxs)("div",{className:"mt-1 space-y-1",children:[me?(0,k.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._("Expected position value: ${0}",{0:me.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})})}):null,X?(0,k.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._("Your existing Take Profit of ${hasTp} will be changed to ${0}",{0:null===(l=G.floatValue)||void 0===l?void 0:l.toLocaleString(void 0,{compactDisplay:"short"}),hasTp:q})}):null,oe?(0,k.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._("Your will be removing your existing Take Profit at ${hasTp}.",{hasTp:q})}):null]}),G.floatValue&&!xe&&ce?(0,k.jsx)("div",{className:"text-xs mt-2 text-warning",children:(0,k.jsx)(F.cC,{id:"<0>Minimum Take Profit price is</0><1>${0}</1><2>.</2>",values:{0:null===ce||void 0===ce?void 0:ce.toFixed(2)},components:{0:(0,k.jsx)("span",{}),1:(0,k.jsx)("button",{type:"button",onClick:Te,className:"ml-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),2:(0,k.jsx)("span",{})}})}):null,(0,k.jsx)("div",{className:"mt-5",children:(0,k.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,k.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:c.ag._("Stop Loss Price:")}),fe?(0,k.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,k.jsx)(Ee,{changePct:fe.pnlRate,pnl:fe.pnl})}):null]})}),(0,k.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,k.jsx)(ee.Qr,{name:"slPrice",control:V,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,k.jsx)(te.Z,{ref:Fe,decimals:2,max:O.wN,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,k.jsxs)("div",{className:"mt-1 space-y-1",children:[fe?(0,k.jsx)("span",{className:"text-xs text-v2-lily/30",children:c.ag._("Expected position value: ${0}",{0:fe.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})})}):null,le?(0,k.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._("Your existing Stop Loss of ${hasSl} will be changed to ${0}",{0:null===(u=Q.floatValue)||void 0===u?void 0:u.toLocaleString(void 0,{compactDisplay:"short"}),hasSl:U})}):null,ae?(0,k.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._("Your will be removing your existing Stop Loss at ${hasSl}.",{hasSl:U})}):null]}),Q.floatValue&&!pe&&ue&&de?(0,k.jsx)("div",{className:"text-xs mt-2 text-warning",children:(0,k.jsx)(F.cC,{id:"<0>Allowed Stop Loss price is between</0><1>${0}</1><2>and</2><3>${1}</3><4>.</4>",values:{0:N.uf.format(ue,2),1:N.uf.format(de,2)},components:{0:(0,k.jsx)("span",{}),1:(0,k.jsx)("button",{type:"button",onClick:Ae,className:"mx-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),2:(0,k.jsx)("span",{}),3:(0,k.jsx)("button",{type:"button",onClick:Ie,className:"ml-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),4:(0,k.jsx)("span",{})}})}):null,Ce.length>0?Ce.map((function(e,t){return(0,k.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,k.jsx)("div",{children:(0,k.jsxs)("div",{className:"mt-5 pr-2 flex justify-between items-center",children:[(0,k.jsx)("div",{className:"flex-1 first-letter:text-v2-lily text-sm font-semibold h-full",children:c.ag._("Close position in:")}),(0,k.jsxs)("div",{className:"rounded-lg flex items-center",children:[ve?(0,k.jsx)(W.Z,{info:ve,width:28,height:28}):null,(0,k.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===ve||void 0===ve?void 0:ve.symbol})]})]})})]}),(0,k.jsx)("div",{className:"px-6",children:(0,k.jsx)("div",{className:"border-b border-v2-lily/5 my-3"})}),(0,k.jsx)("p",{className:"mt-2 mb-3 px-6 text-xs text-v2-lily/30",children:c.ag._("Take Profit and Stop Loss orders will remain in effect regardless of any changes to your collateral or position size.")}),(0,k.jsx)("p",{className:"mb-4 px-6 text-xs text-v2-lily/30",children:c.ag._("TP/SL will not be triggered if you close your ${0} Associated Token Account.",{0:null===I||void 0===I?void 0:I.symbol})}),(0,k.jsxs)("div",{className:"w-full text-xs flex pb-6 px-6 space-x-3",children:[H.isSubmitting?null:(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":H.isSubmitting}),disabled:H.isSubmitting,onClick:S,children:(0,k.jsx)("span",{children:c.ag._("Cancel")})}),(0,k.jsx)("button",{type:"button",className:(0,y.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":H.isSubmitting||Se}),disabled:Se,onClick:B(Oe),children:H.isSubmitting?(0,k.jsxs)("span",{className:"flex justify-center items-center",children:[(0,k.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,k.jsx)("div",{className:"mr-2"}),c.ag._("Setting up TP & SL")]}):(0,k.jsx)("span",{className:"text-center",children:c.ag._("Confirm")})})]})]})]})})},sn=function(){var e=(0,_.tc)().userPositions,t=(0,C.y)().editTPSLDialogData,n=(0,i.useMemo)((function(){return t&&(null===e||void 0===e?void 0:e.find((function(e){return e.publicKey.equals(t.positionAccountPubkey)})))}),[t,e]);return n?(0,k.jsx)(nn,{positionAccount:n}):null},rn=n(3082),on=function(){var e=(0,d.Bn)(),t=e.getTokenInfo,n=e.getTokenInfoFromSymbol,s=(0,rn.useRouter)(),r=(0,i.useMemo)((function(){return s.query.inOut?s.query.inOut:O.yM}),[s.query.inOut]),o=(0,i.useMemo)((function(){return r.split("-")}),[r]),l=o[0],a=o[1],c=(0,i.useMemo)((function(){return n(l)||t(l)||O.mq}),[l,t,n]),u=(0,i.useMemo)((function(){return n(a)||O.mq}),[a,n]),x=(0,i.useMemo)((function(){return c.name&&u.name&&s.isReady}),[s.isReady,c,u]);return{inOut:r,fromPairTokenInfo:c,toPairTokenInfo:u,isReady:x}},ln=function(){var e=(0,rn.useRouter)();return(0,i.useMemo)((function(){if(e.isReady){var t=e.query.direction;if("long"!==t&&"short"!==t)return e.replace("/perps/long/SOL-SOL"),"long"}return e.query.direction}),[e])},an=n(53024),cn=n(64508),un=n.n(cn),dn=function(){return(0,k.jsx)(un(),{shallow:!0,suppressHydrationWarning:!0,href:"/perps-earn",children:(0,k.jsx)("button",{className:"mr-2 flex text-right px-4 py-2 rounded-lg drop-shadow-sm text-sm font-semibold bg-v2-primary/10 border border-v2-primary/10 text-v2-primary hover:opacity-80",children:(0,k.jsx)(F.cC,{id:"Earn"})})})},xn=n(92956),pn=["position"];function fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fn(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var hn=function(e){var t=e.selectToPair,n=e.selected,s=(0,_.tc)(),r=s.perpsTokens,o=s.isAnyFormSubmitting,l=(0,i.useState)([]),a=l[0],c=l[1];return(0,i.useEffect)((function(){0===a.length&&c(r.nonStableTokens)}),[r.nonStableTokens,a.length]),(0,k.jsx)("div",{className:"flex space-x-2 overflow-x-scroll hideScrollbar border-r border-r-v2-lily/10 h-full items-center px-2",children:a.map((function(e,i){var s=n.address===e.address,r=o;return(0,k.jsxs)("button",{type:"button",onClick:function(){return t(e)},disabled:r,className:(0,y.cn)("h-9 lg:h-10","flex items-center cursor-pointer fill-current font-semibold space-x-3 rounded-full pl-1.5 pr-2 text-sm border lg:border-2 border-transparent whitespace-nowrap text-white",{"hover:border-labs/50":!s&&!r,"cursor-not-allowed opacity-50":!s&&r,"border-labs bg-labs/10 text-labs":s}),children:[(0,k.jsx)(W.Z,{info:e,width:24,height:24}),(0,k.jsx)("span",{children:e.symbol})]},i)}))})},vn=b()((function(){return Promise.all([n.e(6981),n.e(3439)]).then(n.bind(n,23439))}),{ssr:!1,loadableGenerated:{webpack:function(){return[23439]}}}),gn=b()((function(){return Promise.resolve().then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),bn=b()((function(){return Promise.resolve().then(n.bind(n,7763)).then((function(e){return e.AdvancedTradingView}))}),{ssr:!1,loadableGenerated:{webpack:function(){return[7763]}}}),wn=b()((function(){return n.e(6959).then(n.bind(n,76959))}),{ssr:!1,loadableGenerated:{webpack:function(){return[76959]}}}),jn=b()((function(){return Promise.all([n.e(2628),n.e(3337)]).then(n.bind(n,53337))}),{ssr:!1,loading:function(){return null},loadableGenerated:{webpack:function(){return[53337]}}}),yn=b()((function(){return Promise.all([n.e(2628),n.e(6647)]).then(n.bind(n,16647))}),{ssr:!1,loading:function(){return null},loadableGenerated:{webpack:function(){return[16647]}}}),Nn=function(e){var t=e.lastPrice,n=on(),s=n.fromPairTokenInfo,r=n.toPairTokenInfo,l=(0,_.tc)().oraclePrices,u=ln(),d=(0,R.Ne)(O.yM),x=(0,i.useMemo)((function(){return l?l[r.address]:null}),[l,r.address]),h=(0,p.y_)(x),v=(0,f.a)(["ohclvData-24h",r.address,h],(0,o.Z)(a().mark((function e(){var t,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.address){e.next=2;break}return e.abrupt("return",null);case 2:return t=Math.round(Date.now()/1e3),new URLSearchParams({address:r.address,address_type:"token",type:"30m",time_from:String(t-86400),time_to:String(t)}),e.prev=4,e.next=7,fetch("https://worker.jup.ag/perps-tokens-stats");case 7:return n=e.sent,e.next=10,n.json();case 10:if(i=e.sent,s=i[r.address]){e.next=14;break}return e.abrupt("return",null);case 14:return e.abrupt("return",{lruPrice:s.lruPrice.toFixed(h),high24H:new m.Z(s.high24H),low24H:new m.Z(s.low24H)});case 17:return e.prev=17,e.t0=e.catch(4),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[4,17]])}))),{refetchInterval:6e4,initialData:null}).data,g=(0,i.useMemo)((function(){if(!v||!v.lruPrice||!x)return null;var e=function(){var e=v.lruPrice;return new m.Z(x).minus(e).div(e).mul(100)}();return{color:e.gt(0)?"rgba(39, 174, 96, 1)":"rgba(255, 87, 87, 1)",text:e.toFixed(2)+"%"}}),[v,x]),b=P.SX.tradeVolume.useQuery({mint:r.address}).data,w=(0,i.useMemo)((function(){return null!==t&&void 0!==t?t:x}),[t,x]),C=(0,i.useMemo)((function(){return w?"$"+N.uf.format(String(w),h):""}),[h,w]),T=i.useCallback((function(e){d(s,e,u)}),[d,s,u]);return(0,k.jsxs)("div",{className:(0,y.cn)("flex flex-col lg:flex-row lg:items-center justify-between bg-[#131B24] lg:h-[64px] w-full","border-b border-b-v2-lily/10"),children:[(0,k.jsxs)("div",{className:(0,y.cn)("flex flex-col justify-between  h-full overflow-x-scroll hideScrollbar pt-2 lg:pt-0"),children:[(0,k.jsxs)("div",{className:"h-full flex items-center justify-between lg:justify-normal space-x-4",children:[(0,k.jsx)(hn,{selectToPair:T,selected:r}),(0,k.jsx)(dn,{})]}),(0,k.jsxs)("div",{className:"mt-2 flex items-center justify-between space-x-3 px-3 py-2 h-10 lg:hidden w-full border-t border-t-v2-lily/5",children:[(0,k.jsx)("div",{className:"flex lg:hidden text-xl text-white font-semibold",children:C&&w?(0,k.jsx)(S,{price:new m.Z(w),precision:h,children:C}):(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})}),(0,k.jsxs)("div",{className:"flex gap-3",children:[(0,k.jsxs)("div",{className:"flex flex-col text-center",children:[(0,k.jsx)("p",{className:"text-xxs md:text-xs text-white/30 whitespace-nowrap",children:c.ag._("24h Change")}),(0,k.jsx)("div",{className:"text-xs text-white",style:{color:null===g||void 0===g?void 0:g.color},children:null!==g&&void 0!==g&&g.text?g.text:(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})]}),(0,k.jsxs)("div",{className:"flex flex-col text-center",children:[(0,k.jsx)("p",{className:"text-xxs md:text-xs text-white/30 whitespace-nowrap",children:c.ag._("24h Vol")}),(0,k.jsx)("div",{className:"text-xs text-white",children:b?(0,N.dN)(b.volume,2):(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})]})]})]})]}),(0,k.jsxs)("div",{className:(0,y.cn)("h-full hidden lg:flex min-w-[260px] lg:px-3 gap-3 xl:gap-7 pr-3","mt-3 justify-between 2xl:justify-end hideScrollbar","pt-3 lg:mt-0 lg:pt-0 lg:ml-auto border-t border-t-v2-lily/5 lg:border-none"),children:[(0,k.jsx)("div",{className:"hidden lg:flex items-center text-center leading-none font-semibold",children:(0,k.jsx)("div",{className:"text-lg text-white",children:C&&w?(0,k.jsx)(S,{price:new m.Z(w),precision:h,children:C}):(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})}),(0,k.jsxs)("div",{className:"flex items-center gap-3 xl:gap-7",children:[(0,k.jsxs)("div",{className:"flex flex-col text-center",children:[(0,k.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:c.ag._("24h Change")}),(0,k.jsx)("div",{className:"text-xs text-white",style:{color:null===g||void 0===g?void 0:g.color},children:null!==g&&void 0!==g&&g.text?g.text:(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})]}),(0,k.jsxs)("div",{className:"flex flex-col text-center",children:[(0,k.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:c.ag._("24h Vol")}),(0,k.jsx)("div",{className:"text-xs text-white",children:b?"$".concat((0,N.dN)(b.volume,2)):(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})]}),(0,k.jsxs)("div",{className:"hidden xl:flex flex-col text-center",children:[(0,k.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:c.ag._("24h High")}),(0,k.jsx)("div",{className:"text-xs text-white",children:null!==v&&void 0!==v&&v.high24H?"$"+N.uf.format(v.high24H,h):(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})]}),(0,k.jsxs)("div",{className:"hidden xl:flex flex-col text-center",children:[(0,k.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:c.ag._("24h Low")}),(0,k.jsx)("div",{className:"text-xs text-white",children:null!==v&&void 0!==v&&v.low24H?"$"+N.uf.format(v.low24H,h):(0,k.jsx)(j.O,{className:"w-10 h-4 rounded-md"})})]})]})]})]})};function Pn(){return(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{stroke:"rgb(86, 84, 82)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M 12 20.696 V 14.12 m 0 -10.817 V 9.88 m 3.478 -4.4 L 12 2 L 8.522 5.478 m 0 13.044 L 12 22 l 3.478 -3.478"})})}var kn=function(){var e=(0,_.tc)(),t=e.perpsTokens,n=e.bottomTab,s=e.setBottomTab,l=e.oraclePrices,f=e.userPositions,g=(0,C.y)(),b=g.isEditCollateralDialogOpen,j=g.isEditTPSLDialogOpen,y=g.isClosePositionDialogOpen,N=g.isSharePositionDialogOpen,P=g.isShareHistoryDialogOpen,S=(0,d.Bn)().getTokenInfo,T=on(),D=T.fromPairTokenInfo,E=T.toPairTokenInfo,M=T.isReady,L=ln(),A=(0,R.Ne)(O.yM),F=(0,d.C9)(),q=(0,d.gZ)().fetchTokenAccounts;(0,i.useEffect)((function(){D&&E&&q([D.address,E.address])}),[D,E,q,F]);var U=(0,i.useCallback)((function(e){A(D,E,e)}),[D,A,E]),K=(0,R.QY)(),V=(0,x.Fm)();I(V),(0,i.useEffect)((function(){if(0!==t.stableTokens.length&&0!==t.nonStableTokens.length)if(K.find((function(e){return e===D.address}))){var e=t.nonStableTokens.find((function(e){return e.address===E.address}));D.address&&e||A(D.address?D:t.nonStableTokens[0],t.nonStableTokens[0],L)}else A(t.nonStableTokens[0],t.nonStableTokens[0],L)}),[t,E,D,A,L,K]);var B=(0,p.Gc)(),z=(0,i.useMemo)((function(){return"lg"===B||"xl"===B}),[B]),$=(0,i.useMemo)((function(){return"xs"===B||"sm"===B||"md"===B}),[B]),H=(0,i.useMemo)((function(){return l?l[E.address]:null}),[l,E.address]),W=(0,p.y_)(H),G=(0,h.Dv)((0,i.useMemo)((function(){return(0,an.o_)(Z.CHAOS_IDS[E.address])}),[E])),Q=(0,i.useMemo)((function(){return Z.CHAOS_IDS[E.address]&&z&&M&&W>0}),[z,M,W,E.address]),Y=(0,i.useMemo)((function(){return Z.CHAOS_IDS[E.address]&&$&&M&&W>0}),[$,M,W,E.address]),ee=(0,i.useRef)(null),te=(0,i.useRef)(null),ne=(0,i.useMemo)((function(){return Q?ee:Y?te:void 0}),[Q,Y]),se=(0,u._)("jupiter-labs-perps-render-position-on-tv",!0),re=(0,r.Z)(se,2),oe=re[0],le=re[1],ae=function(){var e=(0,xn.O)().wallet,t=(0,d.Bn)().connection,n=(0,_.tc)(),s=n.userPositions,l=n.refreshPositionInfo,c=(0,ie.Z)().promptKeeperClosePositionNotification,u=(0,h.KO)(X.isClosingAllPositions),x=(0,r.Z)(u,2),p=x[0],f=x[1];return(0,i.useCallback)(function(){var n=(0,o.Z)(a().mark((function n(i){var r,u,d,x,m;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s&&0!==(null===s||void 0===s?void 0:s.length)&&!p){n.next=2;break}return n.abrupt("return");case 2:if(e){n.next=4;break}throw new Error("Wallet not connected");case 4:if(f(!0),n.prev=5,r=null===s||void 0===s?void 0:s.find((function(e){return e.publicKey.toString()===i.publicKey}))){n.next=9;break}throw new Error("Cannot find position ".concat(i.id));case 9:return n.next=11,we(e,t,r);case 11:if(u=n.sent){n.next=14;break}throw new Error("Cannot find market close instruction");case 14:return d=u.instructions,x=u.positionRequestKey,m={wallet:e.adapter.name,position:r,priceSlippage:"long"===r.side?new(jt())(0):new(jt())("18446744073709551615").toNumber(),collateralUsdDelta:new(jt())(0).toNumber(),sizeUsdDelta:new(jt())(r.sizeUsd.toFixed(0)).toNumber(),desiredMint:r.collateralCustody.account.mint},n.next=18,new Promise(function(){var t=(0,o.Z)(a().mark((function t(n,i){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c(d,x,(function(e){l(),n(e)}),(function(e){i(e)}),function(){var t=m.position,n=(0,J.Z)(m,pn);return mn({wallet:e.adapter.name,position:t.publicKey.toString()},(0,Le.w_)(n))}());case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());case 18:return n.abrupt("return",n.sent);case 21:n.prev=21,n.t0=n.catch(5),console.log("Failed to close all positions!",n.t0);case 24:return n.prev=24,l(),f(!1),n.finish(24);case 28:case"end":return n.stop()}}),n,null,[[5,21,24,28]])})));return function(e){return n.apply(this,arguments)}}(),[t,p,c,l,f,s,e])}(),ce=(0,i.useMemo)((function(){return f&&oe?f.map((function(e){var t,n=S(e.custody.account.mint.toString());if((null===n||void 0===n?void 0:n.address)!==E.address)return null;var i=new m.Z(e.price).div(1e6).toFixed(W),s="long"===e.side?c.ag._("Long"):c.ag._("Short"),r=[],o=Ze(e),l=o.hasTp,a=o.hasSl;return l&&r.push({id:"tp-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-TP"),price:Number(l.toFixed(W)),action:"tp",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),a&&r.push({id:"sl-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-SL"),price:Number(a.toFixed(W)),action:"sl",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),r.push({id:"lq-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(s,"-Liq."),price:Number(null===(t=e.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(W)),action:"lq",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),r.push({id:"".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(s),price:Number(i),action:e.side,sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString(),onCloseAction:ae}),r})).flat().filter(Boolean):[]}),[S,ae,W,oe,E.address,f]),ue=(0,i.useMemo)((function(){var e=V?null===G||void 0===G?void 0:G.price:H;return null!==G&&void 0!==G&&G.price&&E&&e?c.ag._("{0} - {1}",{0:new m.Z(e).toFixed(W),1:E.symbol}):c.ag._("Jupiter Perps")}),[V,null===G||void 0===G?void 0:G.price,H,E,W]),de=function(e){var t=e.resizeComponentRef,n=e.minHeight,s=void 0===n?0:n,r=e.maxHeight,o=void 0===r?1/0:r,l=(0,i.useCallback)((function(e,n,i){if(t&&t.current&&window){var r=window.getComputedStyle(t.current).height,l=parseInt(r,10);document.body.style.userSelect="none",document.body.style.pointerEvents="none";var a=function(n){n.preventDefault();var i="clientY"in n?n.clientY:n.touches[0].clientY,r=l+(i-e);t.current&&r>=s&&r<=o&&(t.current.style.height="".concat(r,"px"))};document.addEventListener(n,a,"touchmove"===n?{passive:!1}:void 0),document.addEventListener(i,(function e(){document.removeEventListener(n,a),document.removeEventListener(i,e),document.body.style.userSelect="",document.body.style.pointerEvents=""}))}}),[o,s,t]);return{onMouseDown:(0,i.useCallback)((function(e){l(e.clientY,"mousemove","mouseup")}),[l]),onTouchStart:(0,i.useCallback)((function(e){l(e.touches[0].clientY,"touchmove","touchend")}),[l])}}({resizeComponentRef:ne,minHeight:200,maxHeight:.7*window.innerHeight}),xe=de.onTouchStart,pe=de.onMouseDown;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(v.PB,{title:ue}),b&&(0,k.jsx)(Yt,{}),j&&(0,k.jsx)(sn,{}),y&&(0,k.jsx)(Mt,{}),N&&(0,k.jsx)(jn,{}),P&&(0,k.jsx)(yn,{}),(0,k.jsx)(wn,{}),(0,k.jsxs)("div",{className:"hidden lg:flex flex-1 min-h-full min-w-full",children:[(0,k.jsxs)("div",{className:"flex flex-col w-[calc(100vw-360px)]",children:[(0,k.jsx)(Nn,{lastPrice:null===G||void 0===G?void 0:G.price}),ne&&ne.current?(0,w.createPortal)((0,k.jsx)(bn,{renderingId:"perps",shadesClassName:"!bg-[#131B24]",datafeedObject:{feedId:Z.CHAOS_IDS[E.address]},opt:{enableVolumeStudy:!1,showVolume:!1,showPriceSource:!1,showBarChange:!1},style:{background:"#131B24"},positions:ce,hasFocus:V,favoriteIntervals:["5","15","1H"]}),ne.current):null,(0,k.jsx)("div",{ref:ee,className:"z-10 h-[50vh] bg-[#131B24] relative",children:(0,k.jsx)("div",{onMouseDown:pe,className:"w-4 h-4 flex justify-center items-center absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 z-50 cursor-row-resize",children:(0,k.jsx)(Pn,{})})}),(0,k.jsxs)(Ge,{activeTab:n,setActiveTab:s,showPositions:oe,setShowPositions:le,children:["Positions"===n?(0,k.jsx)($e,{setPositionDirection:U}):null,"Trade History"===n?(0,k.jsx)(bt,{setPositionDirection:U}):null,"Expired Orders"===n?(0,k.jsx)(st,{}):null]})]}),(0,k.jsx)("div",{className:"flex-1 w-[360px] min-w-[360px] lg:max-w-[360px]",children:z&&(0,k.jsx)(vn,{positionDirection:L,setPositionDirection:U,fromPairTokenInfo:D,toPairTokenInfo:E})})]}),(0,k.jsxs)("div",{className:"flex w-full lg:hidden flex-col",children:[(0,k.jsx)(Nn,{lastPrice:null===G||void 0===G?void 0:G.price}),(0,k.jsx)("div",{ref:te,className:"h-[30vh] bg-[#131B24]"}),(0,k.jsxs)("div",{className:"flex lg:hidden items-center justify-between w-full bg-[#16202B] px-2 py-2 relative",children:[(0,k.jsx)("div",{onTouchStart:xe,className:"z-10 w-4 h-4 flex justify-center items-center absolute top-[-8px] left-1/2 transform -translate-x-1/2 touch-none",children:(0,k.jsx)(Pn,{})}),(0,k.jsxs)("div",{className:"flex whitespace-nowrap space-x-2 items-center text-xs text-v2-lily/50",children:[(0,k.jsx)(gn,{active:oe,onClick:function(){return le((function(e){return!e}))}}),(0,k.jsx)("span",{children:c.ag._("Show Positions on Chart")})]})]}),(0,k.jsx)("div",{className:"w-full",children:$&&(0,k.jsx)(vn,{positionDirection:L,setPositionDirection:U,fromPairTokenInfo:D,toPairTokenInfo:E})}),(0,k.jsx)("div",{children:(0,k.jsxs)(Ge,{activeTab:n,setActiveTab:s,showPositions:oe,setShowPositions:le,children:["Positions"===n?(0,k.jsx)($e,{setPositionDirection:U}):null,"Trade History"===n?(0,k.jsx)(bt,{setPositionDirection:U}):null,"Expired Orders"===n?(0,k.jsx)(st,{}):null]})})]})]})},Sn=!0,On=function(){return(0,k.jsx)(s.Z,{children:(0,k.jsx)(kn,{})})}},31157:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/perps/[direction]/[inOut]",function(){return n(56769)}])}},function(e){e.O(0,[3215,4518,1963,7763,9774,2888,179],(function(){return t=31157,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[inOut]-e517176be77bc036.js.map